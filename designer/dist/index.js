var Kt=Object.defineProperty;var Jt=(m,e,n)=>e in m?Kt(m,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):m[e]=n;var R=(m,e,n)=>(Jt(m,typeof e!="symbol"?e+"":e,n),n);import{L as Rt,E as Tt,a as jt,G as mt,T as Ke,M as T,b as ye,B as K,c as Ae,D as De,V as P,P as fe,C as $t,d as ke,e as Yt,O as at,f as en,g as tn,h as J,i as rt,j as Xt,F as Wt,R as Zt,k as nn,l as gt,Q as le,m as Pt,n as tt,o as ve,S as sn,p as Ye,q as on,r as Fe,s as Ce,t as xt,u as V,W as an,v as rn,w as cn,x as ln,A as dn,y as hn,z as un,H as mn,I as Ge,J as St,K as Ne}from"./vendor.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();window.camerasTypes=null;window.lidarsTypes=null;const Gt=(window==null?void 0:window.designerPath)||"./";function Vt(m,e){var n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("GET",m,!1),n.onreadystatechange=function(){n.readyState===4&&n.status=="200"&&e(n.responseText)},n.send(null)}function we(){if(window.camerasTypes===null){let m;Vt(Gt+"js/camera-data/camera-data.json",function(e){m=JSON.parse(e).sensors.cameras;let t=0;m.forEach(i=>i.id=t++),m.forEach(i=>i.aspectRatio=Math.abs(Math.tan(i.HFov/2*Math.PI/180)/Math.tan(i.VFov/2*Math.PI/180))),window.camerasTypes=m})}return window.camerasTypes}function Ie(){if(window.lidarsTypes===null){let m;Vt(Gt+"js/camera-data/camera-data.json",function(e){m=JSON.parse(e).sensors.lidars;let t=0;m.forEach(i=>i.id=t++),window.lidarsTypes=m})}return window.lidarsTypes}const Ve={meters:{value:1,label:"m",squaredLabel:"mÂ²"},feets:{value:3.28084,label:"ft",squaredLabel:"sqft"}},Je=class Je{constructor(e,n=Ve.meters,t=0,i=G.DEFAULT_WIDTH,r=G.DEFAULT_LENGTH){this.width=i,this.height=r,this.unit=n,this.elevation=t;const a=new Rt(new Tt,new jt({color:0})),o=new mt,s=f(this.width,this.height),c=new mt;function g(h,y,k,A){o.children.forEach(M=>{M.geometry.dispose(),M.material.dispose()}),o.clear();const C=Math.floor(h*A),O=Math.floor(y*A),F=1/A,l=new fe(F,F),D=new Ae({color:1118481,side:De});new T(l,D);const I=h-C*F,b=new fe(I,F),_=y-O*F,p=new fe(F,_),x=new fe(I,_),E=new Ae({side:De,color:3026478}),B=new fe(h+.02,y+.02);B.translate(-h/2,y/2,0);const v=new T(B,E);v.position.set(h/2+.01,-y/2+.01,-.01),o.add(v);for(let M=0;M<O;M++){for(let z=0;z<C;z++)if((M+z)%2===0){const U=l.clone();U.translate(-h/2+(z+.5)*F,y/2-(M+.5)*F,0);const Q=new T(U,D);o.add(Q)}if((M+C)%2===0){const z=b.clone();z.translate(-h/2+C*F+I/2,y/2-(M+.5)*F,0);const U=new T(z,D);o.add(U)}}for(let M=0;M<C;M++)if((O+M)%2===0){const z=p.clone();z.translate(-h/2+(M+.5)*F,y/2-O*F-_/2,0);const U=new T(z,D);o.add(U)}if((C+O)%2===0){const M=x.clone();M.translate(-h/2+C*F+I/2,y/2-O*F-_/2,0);const z=new T(M,D);o.add(z)}S(o,h,y,k)}function f(h,y){const k=new Ke("",{font:G.font,size:Je.SIZE_TEXT_SCENE,height:.01});return new T(k,new ye({color:16777215}))}function L(h,y,k,A){s.geometry.dispose();const C=Math.round(h*A.value*100)/100+A.label+" x "+Math.round(y*A.value*100)/100+A.label;s.geometry=new Ke(C,{font:G.font,size:Je.SIZE_TEXT_SCENE*2/3,height:.01}),S(s,h,y,k);const O=.14*C.length;s.translateX(h/2-.2-O),s.translateY(-(y/2-.2))}function u(h,y,k,A){a.geometry.dispose();const C=new K(Math.round(h*100)/100+.02,Math.round(y*100)/100+.02,0);a.geometry=new Tt(C),S(a,h,y,k),g(h,y,k,A.value),L(h,y,k,A),w(h,y,k)}function w(h,y,k,A){c.clear();const C=new K(1/15,k,1/15),O=new Ae({color:1118481,side:De});let F=new T(C,O);F.position.set(h,k/2,y),c.add(F);let l=new T(C,O);l.position.set(0,k/2,y),c.add(l);let D=new T(C,O);D.position.set(0,k/2,0),c.add(D);let I=new T(C,O);I.position.set(h,k/2,0),c.add(I)}function S(h,y,k,A){const C=new P(1,1,0),O=new P(y/2,k/2,0);h.position.set(0,0,0),C.applyEuler(e.rotation),O.applyEuler(e.rotation),h.position.set(C.x*Math.abs(O.x),C.y*Math.abs(O.y),-C.z*Math.abs(O.z)),h.translateZ(A+.005),h.setRotationFromEuler(e.rotation)}this.addToScene=function(h){h.add(a),h.add(o),h.add(s),h.add(c)},this.toggleUnit=function(h){this.dispose(),this.unit=h,this.width>0&&this.height>0&&u(this.width,this.height,this.elevation,this.unit)},this.setSize=function(h,y){this.dispose(),this.width=h,this.height=y,u(this.width,this.height,this.elevation,this.unit)},this.setSceneElevation=function(h){this.dispose(),this.elevation=h,u(this.width,this.height,this.elevation,this.unit)},this.removeFromScene=function(h){h.remove(a),h.remove(o),h.remove(s),h.remove(c)},this.dispose=function(){o.children.forEach(h=>{h.geometry.dispose(),h.material.dispose()}),o.clear(),a.geometry.dispose(),a.material.dispose(),s.geometry.dispose(),s.material.dispose()},u(this.width,this.height,this.elevation,this.unit)}};R(Je,"SIZE_TEXT_SCENE",.3);let ct=Je;const q=class q{constructor(e,n=document.getElementById("tracking-mode-inspector")?document.getElementById("tracking-mode-inspector").value:"human-tracking",t=q.DEFAULT_CAMERA_TYPE_ID,i=0,r=0,a=q.DEFAULT_NODE_HEIGHT,o=0,s=0,c=0){this.id=e,this.cameraType=we().find(u=>u.id===t),this.xPos=i,this.yPos=r,this.zPos=a,this.xRot=o,this.yRot=s,this.zRot=c,this.cameraPerspective=g(this.cameraType,n,this.xPos,this.yPos,this.zPos,this.xRot,this.yRot,this.zRot),this.cameraPerspectiveHelper=new $t(this.cameraPerspective),this.color=new ke(Math.random(),Math.random(),Math.random()),this.mesh=f(this.color,this.xPos,this.yPos,this.zPos),this.coveredPointsAbove=[],this.areaCoveredFloor=new T,this.areaCoveredAbove=new T,this.areaCoveredWallX=new T,this.areaCoveredWallY=new T,this.areaAppear=!0,this.areaValue=0,this.nameText=L("Node "+(this.id+1),q.SIZE_TEXT_NODE,this.xPos-q.SIZE_TEXT_NODE*2,this.yPos+q.SIZE_TEXT_NODE/2,this.zPos-(this.cameraType.rangeFar-1)),this.areaValueText=L("AREA VALUE",q.SIZE_TEXT_NODE*2/3,this.xPos-q.SIZE_TEXT_NODE*4/3,this.yPos+3*q.SIZE_TEXT_NODE/2,this.zPos-(this.cameraType.rangeFar-1));function g(u,w,S,h,y,k,A,C){let O=0;switch(w){case"hand-tracking":O=u.handFar;break;case"human-tracking":default:O=u.rangeFar;break}const F=new Yt(u.VFov,u.aspectRatio,u.rangeNear,O);return F.position.set(S,y,h),F.rotation.set(k+q.DEFAULT_NODE_ROTATION_X,-A,C),F}function f(u,w,S,h){const y=new ye({color:u,dithering:!0}),k=new K(.2,.2,.2),A=new T(k,y);return A.position.set(w,h,S),A.name="Camera",A}function L(u,w,S,h,y){const k=new Ke(u,{font:Re.font,size:w,height:.01}),A=new T(k,new ye({color:16777215}));return A.position.set(S,y,h),A.rotation.x=-Math.PI/2,A}this.addToScene=function(u){u.add(this.cameraPerspective),u.add(this.cameraPerspectiveHelper),u.add(this.mesh),u.add(this.nameText),u.add(this.areaValueText),this.areaAppear=!0},this.removeFromScene=function(u){this.areaAppear=!1,u.remove(this.cameraPerspective),u.remove(this.cameraPerspectiveHelper),u.remove(this.mesh),u.remove(this.areaCoveredFloor),u.remove(this.areaCoveredAbove),u.remove(this.areaCoveredWallX),u.remove(this.areaCoveredWallY),u.remove(this.nameText),u.remove(this.areaValueText)},this.changeVisibility=function(u=!this.areaAppear){const w=u;this.areaAppear=w,this.cameraPerspective.visible=w,this.cameraPerspectiveHelper.visible=w,this.nameText.visible=w,this.areaValueText.visible=w,this.uiElement&&this.uiElement.changeVisibility(w)},this.updatePosition=function(u){this.xPos=this.mesh.position.x,this.yPos=this.mesh.position.z,this.zPos=this.mesh.position.y,this.cameraPerspective.position.set(this.xPos,this.zPos,this.yPos),this.uiElement&&this.uiElement.updatePosition(this.xPos,this.yPos,this.zPos,u)},this.updateAreaText=function(u){this.areaValueText.geometry.dispose(),this.areaValueText.geometry=new Ke(Math.round(this.areaValue*100)/100+u.squaredLabel,{font:Re.font,size:q.SIZE_TEXT_NODE*2/3*Math.sqrt(this.areaValue)/3/u.value,height:.01}),this.nameText.geometry.dispose(),this.nameText.geometry=new Ke("Node "+(this.id+1),{font:Re.font,size:q.SIZE_TEXT_NODE*Math.sqrt(this.areaValue)/3/u.value,height:.01})},this.changeTextPosition=function(u,w){this.nameText.scale.set(1,1,1),this.nameText.position.copy(u.add(new P(-q.SIZE_TEXT_NODE*2*Math.sqrt(this.areaValue)/3/w,.1,0))),this.areaValueText.position.copy(u.add(new P(0,0,1.5*q.SIZE_TEXT_NODE*Math.sqrt(this.areaValue)/3/w))),this.areaValueText.visible=this.areaAppear},this.changeMode=function(u){switch(u){case"hand-tracking":this.cameraPerspective.far=this.cameraType.handFar;break;case"human-tracking":default:this.cameraPerspective.far=this.cameraType.rangeFar;break}this.uiElement&&this.uiElement.changeFar()},this.update=function(){this.cameraPerspective.updateProjectionMatrix(),this.cameraPerspectiveHelper.update()},this.dispose=function(){this.cameraPerspective.children.forEach(u=>{u.isMesh&&(u.geometry.dispose(),u.material.dispose())}),this.cameraPerspective.clear(),this.cameraPerspectiveHelper.children.forEach(u=>{u.isMesh&&(u.geometry.dispose(),u.material.dispose())}),this.cameraPerspectiveHelper.clear(),this.cameraPerspectiveHelper.geometry.dispose(),this.cameraPerspectiveHelper.material.dispose(),this.cameraPerspectiveHelper.dispose(),this.mesh.geometry.dispose(),this.mesh.material.dispose(),this.coveredPointsAbove.length=0,this.areaCoveredFloor.geometry.dispose(),this.areaCoveredFloor.material.dispose(),this.areaCoveredAbove.geometry.dispose(),this.areaCoveredAbove.material.dispose(),this.areaCoveredWallX.geometry.dispose(),this.areaCoveredWallX.material.dispose(),this.areaCoveredWallY.geometry.dispose(),this.areaCoveredWallY.material.dispose(),this.nameText.geometry.dispose(),this.nameText.material.dispose(),this.areaValueText.geometry.dispose(),this.areaValueText.material.dispose(),this.uiElement&&this.uiElement.dispose()}}};R(q,"DEFAULT_CAMERA_TYPE_ID",0),R(q,"DEFAULT_NODE_HEIGHT",5.5),R(q,"DEFAULT_NODE_ROTATION_X",-Math.PI/2),R(q,"SIZE_TEXT_NODE",.4);let ce=q;class pn{constructor(e,n){t(),i();function t(){let s="";we().filter(f=>f.recommended).forEach(f=>{const L='<option value="'+f.niceName+'" '+(e.cameraType.niceName===f.niceName?"selected":"")+">"+f.niceName;s+=L,s+="</option>"});const c=document.createElement("div");c.classList.add("sensorUI"),c.id="node-"+e.id+"-UI",c.innerHTML=`
                <div id="node-`+e.id+`-UI-header" class="row center-x-spaced center-y">
                    <div class="row center-y">
                        <div class="sensor-color" style="background-color: #`+e.color.getHexString()+`;"></div>
                        <p class="main-text">Sensor `+(e.id+1)+`</p>
                    </div>
                    <div class="row center-y">
                        <!-- <div id="node-`+e.id+`-solo-button"><span class="iconify" data-icon="bx:search-alt-2"></span></div> -->
                        <div id="node-`+e.id+`-hide-UI"><span class="iconify" data-icon="bx:minus"></span></div> 
                        <div id="node-`+e.id+`-visible"><span class="iconify" data-icon="akar-icons:eye-open"></span></div>
                        <!-- <div><span class="iconify" data-icon="fluent:lock-open-16-regular"></span></div> -->
                        <div id="node-`+e.id+`-delete"><span class="iconify" data-icon="fluent:delete-16-filled"></span></div>
                    </div>
                </div>
                <div id="node-infos-`+e.id+`-UI" class="column sections-container space-y">
                    <div id="select-camera" class="row center-y">
                        <select title="camType-`+e.id+'" name="camType-'+e.id+'" id="cam-type-'+e.id+`">
                        `+s+`
                        </select>
                    </div>
                    <div class="row sensor-transformations">
                        <p class="main-text">Position</p>
                        <div>
                            <p id="node-x-pos-`+e.id+'" class="draggable">X <strong data-unit='+n.currentUnit.value+">"+Math.round(e.xPos*n.currentUnit.value*100)/100+"</strong><span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        </div>
                        <div>
                            <p id="node-y-pos-`+e.id+'" class="draggable">Y <strong data-unit='+n.currentUnit.value+">"+Math.round(e.yPos*n.currentUnit.value*100)/100+"</strong><span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        </div>
                        <div>
                            <p id="node-z-pos-`+e.id+'" class="draggable">Z <strong data-unit='+n.currentUnit.value+">"+Math.round(e.zPos*n.currentUnit.value*100)/100+"</strong><span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        </div>
                    </div>
                    <div class="row sensor-transformations">
                        <p class="main-text">Rotation</p>
                        <div>
                            <p id="node-x-rot-`+e.id+'" class="draggable">X <strong>'+Math.round(e.xRot*180/Math.PI)+`</strong>Â°</p>
                        </div>
                        <div>
                            <p id="node-y-rot-`+e.id+'" class="draggable">Y <strong>'+Math.round(e.yRot*180/Math.PI)+`</strong>Â°</p>
                        </div>
                        <div>
                            <p id="node-z-rot-`+e.id+'" class="draggable">Z <strong>'+Math.round(e.zRot*180/Math.PI)+`</strong>Â° </p>
                        </div>
                    </div>
                    <div class="row cam-spec">
                        <p class="spec-title main-text">FOV</p>
                        <p>H</p><p id="hfov`+e.id+'">'+e.cameraType.HFov+`Â°</p>
                        <p>V</p><p id="vfov`+e.id+'">'+e.cameraType.VFov+`Â°</p>
                    </div>
                    <div class="row cam-spec">
                        <p class="spec-title main-text">Distance</p>
                        <p>Near</p><p><span id="node-near`+e.id+'" data-unit='+n.currentUnit.value+">"+Math.round(e.cameraPerspective.near*n.currentUnit.value*100)/100+"</span> <span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        <p>Far</p><p><span id="node-far`+e.id+'" data-unit='+n.currentUnit.value+">"+Math.round(e.cameraPerspective.far*n.currentUnit.value*100)/100+"</span> <span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                    </div>
                </div>`,document.getElementById("inspector").appendChild(c)}function i(){r(document.getElementById("node-x-pos-"+e.id)),r(document.getElementById("node-y-pos-"+e.id)),r(document.getElementById("node-z-pos-"+e.id)),r(document.getElementById("node-x-rot-"+e.id)),r(document.getElementById("node-y-rot-"+e.id)),r(document.getElementById("node-z-rot-"+e.id)),document.getElementById("node-"+e.id+"-hide-UI").addEventListener("click",()=>a()),document.getElementById("node-"+e.id+"-visible").addEventListener("click",()=>e.changeVisibility()),document.getElementById("node-"+e.id+"-delete").addEventListener("click",()=>n.objects.removeNode(e)),document.getElementById("cam-type-"+e.id).addEventListener("change",()=>o())}function r(s){let c=s.getElementsByTagName("strong")[0],g=parseFloat(c.innerHTML),f=0,L=0;s.onmousedown=u;function u(h){c=s.getElementsByTagName("strong")[0],g=parseFloat(c.innerHTML),c.classList.add("underlined"),h=h||window.event,h.preventDefault(),f=h.clientX,document.onmouseup=S,document.onmousemove=w}function w(h){h=h||window.event,h.preventDefault(),L=h.clientX-f,f=h.clientX;let y=1;switch(s.id.split("-")[2]){case"pos":y=1/100;break;case"rot":y=1;break;default:y=1;break}switch(g+=L*y,c.innerHTML=Math.round(g*100)/100,s.id.split("-")[1]){case"x":switch(s.id.split("-")[2]){case"pos":e.xPos=g/n.currentUnit.value,e.cameraPerspective.position.x=e.xPos,e.mesh.position.set(e.xPos,e.zPos,e.yPos);break;case"rot":e.xRot=g*(Math.PI/180),e.cameraPerspective.rotation.x=e.xRot+ce.DEFAULT_NODE_ROTATION_X;break}break;case"y":switch(s.id.split("-")[2]){case"pos":e.yPos=g/n.currentUnit.value,e.cameraPerspective.position.z=e.yPos,e.mesh.position.set(e.xPos,e.zPos,e.yPos);break;case"rot":e.yRot=g*(Math.PI/180),e.cameraPerspective.rotation.y=-e.yRot;break}break;case"z":switch(s.id.split("-")[2]){case"pos":e.zPos=g/n.currentUnit.value,e.cameraPerspective.position.y=e.zPos,e.mesh.position.set(e.xPos,e.zPos,e.yPos);break;case"rot":e.zRot=g*(Math.PI/180),e.cameraPerspective.rotation.z=e.zRot;break}break}}function S(){c.classList.contains("underlined")&&c.classList.remove("underlined"),document.onmouseup=null,document.onmousemove=null,n.objects.populateStorage()}}function a(){const s=document.getElementById("node-infos-"+e.id+"-UI");document.getElementById("node-"+e.id+"-UI-header");const c=s.classList.contains("hidden");c?s.classList.remove("hidden"):s.classList.add("hidden");const g=document.getElementById("node-"+e.id+"-hide-UI").firstChild;g.dataset.icon=c?"bx:minus":"bx:plus"}function o(){switch(e.cameraType=we().find(s=>s.niceName===document.getElementById("cam-type-"+e.id).value),e.cameraPerspective.fov=e.cameraType.VFov,e.cameraPerspective.aspect=e.cameraType.aspectRatio,e.cameraPerspective.near=e.cameraType.rangeNear,n.trackingMode){case"hand-tracking":e.cameraPerspective.far=e.cameraType.handFar;break;case"human-tracking":default:e.cameraPerspective.far=e.cameraType.rangeFar;break}document.getElementById("hfov"+e.id).innerHTML=e.cameraType.HFov+"Â°",document.getElementById("vfov"+e.id).innerHTML=e.cameraType.VFov+"Â°",document.getElementById("node-near"+e.id).innerHTML=Math.round(e.cameraPerspective.near*document.getElementById("node-near"+e.id).dataset.unit*100)/100,document.getElementById("node-far"+e.id).innerHTML=Math.round(e.cameraPerspective.far*document.getElementById("node-far"+e.id).dataset.unit*100)/100,n.objects.populateStorage()}this.changeFar=function(){document.getElementById("node-far"+e.id).innerHTML=Math.round(e.cameraPerspective.far*document.getElementById("node-far"+e.id).dataset.unit*100)/100},this.changeVisibility=function(s){const c=document.getElementById("node-"+e.id+"-visible").firstElementChild;c.dataset.icon=s?"akar-icons:eye-open":"akar-icons:eye-slashed",n.objects.updateFrustumIcon()},this.updatePosition=function(s,c,g,f){document.getElementById("node-x-pos-"+e.id).getElementsByTagName("strong")[0].innerHTML=Math.round(s*f*100)/100,document.getElementById("node-y-pos-"+e.id).getElementsByTagName("strong")[0].innerHTML=Math.round(c*f*100)/100,document.getElementById("node-z-pos-"+e.id).getElementsByTagName("strong")[0].innerHTML=Math.round(g*f*100)/100},this.dispose=function(){let s=document.getElementById("node-"+e.id+"-UI");s&&s.remove()}}}class fn{constructor(e,n){t(),i();function t(){let s="";Ie().filter(f=>f.recommended).forEach(f=>{const L='<option value="'+f.name+'" '+(e.lidarType.name===f.name?"selected":"")+">"+f.name;s+=L,s+="</option>"});const c=document.createElement("div");c.classList.add("sensorUI"),c.id="lidar-"+e.id+"-UI",c.innerHTML=`
                <div id="lidar-`+e.id+`-UI-header" class="row center-x-spaced center-y">
                    <div class="row center-y">
                        <div class="sensor-color" style="background-color: #`+e.color.getHexString()+`;"></div>
                        <p class="main-text">Lidar `+(e.id+1)+`</p>
                    </div>
                    <div class="row center-y">
                        <!-- <div id="lidar-`+e.id+`-solo-button"><span class="iconify" data-icon="bx:search-alt-2"></span></div> -->
                        <div id="lidar-`+e.id+`-hide-UI"><span class="iconify" data-icon="bx:minus"></span></div> 
                        <div id="lidar-`+e.id+`-visible"><span class="iconify" data-icon="akar-icons:eye-open"></span></div>
                        <!-- <div><span class="iconify" data-icon="fluent:lock-open-16-regular"></span></div> -->
                        <div id="lidar-`+e.id+`-delete"><span class="iconify" data-icon="fluent:delete-16-filled"></span></div>
                    </div>
                </div>
                <div id="lidar-infos-`+e.id+`-UI" class="column sections-container space-y">
                    <div id="select-lidar-type" class="row center-y">
                        <select title="lidarType-`+e.id+'" name="lidarType-'+e.id+'" id="lidar-type-'+e.id+`">
                        `+s+`
                        </select>
                    </div>
                    <div class="row sensor-transformations">
                        <p class="main-text">Transf.</p>
                        <div>
                            <p id="lidar-x-pos-`+e.id+'" class="draggable">Pos. X <strong data-unit='+n.currentUnit.value+">"+Math.round(e.xPos*n.currentUnit.value*100)/100+"</strong><span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        </div>
                        <div>
                            <p id="lidar-z-pos-`+e.id+'" class="draggable">Pos. Z <strong data-unit='+n.currentUnit.value+">"+Math.round(e.zPos*n.currentUnit.value*100)/100+"</strong><span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        </div>
                        <div>
                            <p id="lidar-y-rot-`+e.id+'" class="draggable">Rot. Y <strong>'+Math.round(e.yRot*180/Math.PI)+`</strong>Â° </p>
                        </div>
                    </div>
                    <div class="row cam-spec">
                        <p class="spec-title main-text">Angular</p>
                        <p>FOV</p><p id="lidar-fov`+e.id+'">'+e.lidarType.fov+`Â°</p>
                        <p>Res</p><p id="lidar-res`+e.id+'">'+e.lidarType.angularResolution+`Â°</p>
                    </div>
                    <div class="row cam-spec">
                        <p class="spec-title main-text">Distance</p>
                        <p>Near</p><p><span id="lidar-near`+e.id+'" data-unit='+n.currentUnit.value+">"+Math.round(e.lidarType.rangeNear*n.currentUnit.value*100)/100+"</span> <span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        <p>Far</p><p><span id="lidar-far`+e.id+'" data-unit='+n.currentUnit.value+">"+Math.round(e.lidarType.rangeFar*n.currentUnit.value*100)/100+"</span> <span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                    </div>
                </div>`,document.getElementById("inspector").appendChild(c)}function i(){r(document.getElementById("lidar-x-pos-"+e.id)),r(document.getElementById("lidar-z-pos-"+e.id)),r(document.getElementById("lidar-y-rot-"+e.id)),document.getElementById("lidar-"+e.id+"-hide-UI").addEventListener("click",()=>a()),document.getElementById("lidar-"+e.id+"-visible").addEventListener("click",()=>e.changeVisibility()),document.getElementById("lidar-"+e.id+"-delete").addEventListener("click",()=>n.objects.removeLidar(e)),document.getElementById("lidar-type-"+e.id).addEventListener("change",()=>o())}function r(s){let c=s.getElementsByTagName("strong")[0],g=parseFloat(c.innerHTML),f=0,L=0;s.onmousedown=u;function u(h){c=s.getElementsByTagName("strong")[0],g=parseFloat(c.innerHTML),c.classList.add("underlined"),h=h||window.event,h.preventDefault(),f=h.clientX,document.onmouseup=S,document.onmousemove=w}function w(h){h=h||window.event,h.preventDefault(),L=h.clientX-f,f=h.clientX;let y=1;switch(s.id.split("-")[2]){case"pos":y=1/100;break;case"rot":y=1;break;default:y=1;break}switch(g+=L*y,c.innerHTML=Math.round(g*100)/100,s.id.split("-")[1]){case"x":switch(s.id.split("-")[2]){case"pos":e.xPos=g/n.currentUnit.value,e.mesh.position.set(e.xPos,e.zPos,e.yPos),e.rays.position.set(e.xPos,e.zPos,e.yPos);break}break;case"z":switch(s.id.split("-")[2]){case"pos":e.zPos=g/n.currentUnit.value,e.mesh.position.set(e.xPos,e.zPos,e.yPos),e.rays.position.set(e.xPos,e.zPos,e.yPos);break}break;case"y":switch(s.id.split("-")[2]){case"rot":e.yRot=g*(Math.PI/180),e.rays.rotation.z=e.yRot;break}break}}function S(){c.classList.contains("underlined")&&c.classList.remove("underlined"),document.onmouseup=null,document.onmousemove=null,n.objects.populateStorage()}}function a(){const s=document.getElementById("lidar-infos-"+e.id+"-UI");document.getElementById("lidar-"+e.id+"-UI-header");const c=s.classList.contains("hidden");c?s.classList.remove("hidden"):s.classList.add("hidden");const g=document.getElementById("lidar-"+e.id+"-hide-UI").firstChild;g.dataset.icon=c?"bx:minus":"bx:plus"}function o(){e.lidarType=Ie().find(s=>s.name===document.getElementById("lidar-type-"+e.id).value),n.scene.remove(e.rays),e.rays.children.forEach(s=>{s.isLineSegments&&(s.geometry.dispose(),s.material.dispose())}),e.rays.clear(),e.buildRays(),n.scene.add(e.rays),document.getElementById("lidar-fov"+e.id).innerHTML=e.lidarType.fov+"Â°",document.getElementById("lidar-res"+e.id).innerHTML=e.lidarType.angularResolution+"Â°",document.getElementById("lidar-near"+e.id).innerHTML=Math.round(e.lidarType.rangeNear*document.getElementById("lidar-near"+e.id).dataset.unit*100)/100,document.getElementById("lidar-far"+e.id).innerHTML=Math.round(e.lidarType.rangeFar*document.getElementById("lidar-far"+e.id).dataset.unit*100)/100,n.objects.populateStorage()}this.changeVisibility=function(s){const c=document.getElementById("lidar-"+e.id+"-visible").firstElementChild;c.dataset.icon=s?"akar-icons:eye-open":"akar-icons:eye-slashed",n.objects.updateRaysIcon()},this.updatePosition=function(s,c,g){document.getElementById("lidar-x-pos-"+e.id).getElementsByTagName("strong")[0].innerHTML=Math.round(s*g*100)/100,document.getElementById("lidar-z-pos-"+e.id).getElementsByTagName("strong")[0].innerHTML=Math.round(c*g*100)/100},this.dispose=function(){let s=document.getElementById("lidar-"+e.id+"-UI");s&&s.remove()}}}const de=class de{constructor(e){this.id=e,this.xPos=0,this.yPos=0,this.zPos=0,this.mesh=n(this.xPos,this.yPos),this.model=t();function n(i,r){const a=new K(.7,de.DEFAULT_DUMMIES_HEIGHT*4/5,.8),o=new ye({color:0});o.transparent=!0,o.opacity=0,o.alphaTest=.5;const s=new T(a,o);return s.position.set(i,de.DEFAULT_DUMMIES_HEIGHT/2,r),s.name="Dummy",s}function t(){const i=new at().copy(Math.random()<.5?de.maleModel:de.femaleModel),r=de.DEFAULT_DUMMIES_HEIGHT/180;return i.scale.set(r,r,r),i}this.addToScene=function(i){i.add(this.model),i.add(this.mesh),this.model.position.clone(this.mesh.position)},this.removeFromScene=function(i){i.remove(this.model),i.remove(this.mesh)},this.updatePosition=function(){this.xPos=this.mesh.position.x,this.yPos=this.mesh.position.z,this.zPos=this.mesh.position.y-de.DEFAULT_DUMMIES_HEIGHT/2,this.model.position.set(this.xPos,this.zPos,this.yPos)},this.dispose=function(){this.mesh.geometry.dispose(),this.mesh.material.dispose(),this.model.children.forEach(i=>{i.isMesh&&(i.geometry.dispose(),i.material.dispose())}),this.model.clear()}}};R(de,"DEFAULT_DUMMIES_HEIGHT",document.getElementById("dummy-height-reference")?document.getElementById("dummy-height-reference").value:2),R(de,"maleModel"),R(de,"femaleModel");let ge=de;function Mt(m,e){const n=function(i){if(i.lengthComputable){const r=i.loaded/i.total*100;console.log(Math.round(r,2)+"% downloaded")}},t=(window==null?void 0:window.designerPath)||"./";new en().setPath(t+"models/"+e+"02/").setRequestHeader({"Content-Type":"model/mtl"}).load(e+"02.mtl",function(i){i.preload(),new tn().setMaterials(i).setPath(t+"models/"+e+"02/").setRequestHeader({"Content-Type":"model/obj"}).load(e+"02.obj",function(r){e==="male"?ge.maleModel=r:e==="female"&&(ge.femaleModel=r)},n)})}const ae=class ae{constructor(e,n=ae.DEFAULT_LIDAR_TYPE_ID,t=0,i=ae.DEFAULT_LIDAR_HOOK_HEIGHT,r=0){this.id=e,this.lidarType=Ie().find(o=>o.id===n),this.xPos=t,this.yPos=ae.DEFAULT_LIDAR_SIZE+.01*this.id,this.zPos=i,this.xRot=0,this.yRot=r,this.zRot=0,this.color=new ke(.5*Math.random(),.5*Math.random(),.5*Math.random()),this.mesh=a(this.color,this.xPos,ae.DEFAULT_LIDAR_SIZE,this.zPos),this.rays=new mt,this.raysAppear=!0;function a(o,s,c,g){const f=new ye({color:o,dithering:!0}),L=new J(ae.DEFAULT_LIDAR_SIZE,ae.DEFAULT_LIDAR_SIZE,2*ae.DEFAULT_LIDAR_SIZE),u=new T(L,f);return u.position.set(s,g,c),u.rotation.set(Math.PI/2,0,0),u.name="Lidar",u}this.buildRays=function(){const o=new Ae({color:this.color,transparent:!0,opacity:.4,alphaTest:.3}),s=-Math.PI/2-this.lidarType.fov/2*Math.PI/180;for(let c=s;c<=s+this.lidarType.fov*Math.PI/180;c+=this.lidarType.angularResolution*Math.PI/180){const g=new rt,f=[];f.push(this.lidarType.rangeNear*Math.cos(c)),f.push(this.lidarType.rangeNear*Math.sin(c)),f.push(0),f.push(this.lidarType.rangeFar*Math.cos(c)),f.push(this.lidarType.rangeFar*Math.sin(c)),f.push(0);const L=new Float32Array(f);g.setAttribute("position",new Xt(L,3));const u=new Rt(g,o);this.rays.add(u)}this.rays.position.set(this.xPos,this.zPos,this.yPos),this.rays.rotation.z=this.yRot},this.addToScene=function(o){o.add(this.mesh),o.add(this.rays)},this.removeFromScene=function(o){o.remove(this.mesh),o.remove(this.rays)},this.changeVisibility=function(o=!this.raysAppear){const s=o;this.raysAppear=s,this.rays.visible=s,this.uiElement&&this.uiElement.changeVisibility(s)},this.updatePosition=function(o){this.xPos=this.mesh.position.x,this.zPos=this.mesh.position.y,this.rays.position.set(this.xPos,this.zPos,this.yPos),this.uiElement&&this.uiElement.updatePosition(this.xPos,this.zPos,o)},this.update=function(){},this.dispose=function(){this.mesh.geometry.dispose(),this.mesh.material.dispose(),this.rays.children.forEach(o=>{o.geometry.dispose(),o.material.dispose()}),this.rays.clear(),this.uiElement&&this.uiElement.dispose()},this.buildRays()}};R(ae,"DEFAULT_LIDAR_TYPE_ID",0),R(ae,"DEFAULT_LIDAR_HOOK_HEIGHT",8),R(ae,"DEFAULT_LIDAR_SIZE",.1),R(ae,"DEFAULT_MIN_ANGLE_TO_AVOID_OBSTRUCTION",Math.PI/180*60),R(ae,"DEFAULT_RATIO_FAR_MINDIST",2);let ie=ae;const Me=class Me{constructor(e,n,t,i,r,a,o){this.id=e,this.xPos=n,this.yPos=t,this.zPos=r/2+a,this.xRot=0,this.yRot=0,this.zRot=0,this.radius=i,this.height=r,this.elevation=a,this.unit=o,this.color=new ke(.5*Math.random(),.5*Math.random(),.5*Math.random()),this.mesh=s(this.color,this.xPos,this.yPos,this.zPos,this.radius,this.height,this.elevation);function s(c,g,f,L,u,w,S){const h=new T(new J(u,u,w,Me.DEFAULT_CYLINDER_SEGMENTS,1,!0),new ye({side:De}));return h.position.set(g,L,f),h.rotation.set(0,0,0),h.name="Cylinder",h}this.addToScene=function(c){c.add(this.mesh)},this.removeFromScene=function(c){c.remove(this.mesh)},this.updatePosition=function(c){this.xPos=this.mesh.position.x,this.yPos=this.mesh.position.y,this.uiElement&&this.uiElement.updatePosition(this.xPos,this.zPos,c)},this.updateSize=function(c,g){this.zPos+=(g-this.height)/2,this.height=g,this.radius=c,this.mesh.geometry=new J(c,c,g,Me.DEFAULT_CYLINDER_SEGMENTS,1,!0),this.mesh.position.set(this.xPos,this.zPos,this.yPos)},this.dispose=function(){this.mesh.geometry.dispose(),this.mesh.material.dispose(),this.uiElement&&this.uiElement.dispose()}}};R(Me,"DEFAULT_CYLINDER_HEIGHT",2),R(Me,"DEFAULT_CYLINDER_radius",1),R(Me,"DEFAULT_CYLINDER_SEGMENTS",16);let pt=Me;class gn{constructor(e,n){t(),i();function t(){const o=document.createElement("div");o.classList.add("sensorUI"),o.id="cylinder-"+e.id+"-UI",o.innerHTML=`
                <div id="cylinder-`+e.id+`-UI-header" class="row center-x-spaced center-y">
                    <div class="row center-y">
                        <div class="sensor-color" style="background-color: #`+e.color.getHexString()+`;"></div>
                        <p class="main-text">Cylinder `+(e.id+1)+`</p>
                    </div>
                    <div class="row center-y">
                        <div id="cylinder-`+e.id+`-hide-UI"><span class="iconify" data-icon="bx:minus"></span></div> 
                        <div id="cylinder-`+e.id+`-delete"><span class="iconify" data-icon="fluent:delete-16-filled"></span></div>
                    </div>
                </div>
                <div id="cylinder-infos-`+e.id+`-UI" class="column sections-container space-y">
                    <div class="row sensor-transformations">
                        <p class="main-text">Position</p>
                        <div>
                            <p id="cylinder-x-pos-`+e.id+'" class="draggable">Pos. X <strong data-unit='+n.currentUnit.value+">"+Math.round(e.xPos*n.currentUnit.value*100)/100+"</strong><span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        </div>
                        <div>
                            <p id="cylinder-y-pos-`+e.id+'" class="draggable">Pos. Y <strong data-unit='+n.currentUnit.value+">"+Math.round(e.yPos*n.currentUnit.value*100)/100+"</strong><span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        </div>
                        <div>
                            <p id="cylinder-z-pos-`+e.id+'" class="draggable">Pos. Z <strong data-unit='+n.currentUnit.value+">"+Math.round(e.zPos*n.currentUnit.value*100)/100+"</strong><span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        </div>
                    </div>
                    <div class="row sensor-transformations">
                        <p class="main-text">Rotation</p>
                        <div>
                            <p id="cylinder-x-rot-`+e.id+'" class="draggable">Rot. X <strong>'+Math.round(e.xRot*180/Math.PI)+`</strong>Â° </p>
                        </div>
                        <div>
                            <p id="cylinder-y-rot-`+e.id+'" class="draggable">Rot. Y <strong>'+Math.round(e.yRot*180/Math.PI)+`</strong>Â° </p>
                        </div>
                        <div>
                            <p id="cylinder-z-rot-`+e.id+'" class="draggable">Rot. Z <strong>'+Math.round(e.zRot*180/Math.PI)+`</strong>Â° </p>
                        </div>
                    </div>
                    <div class="row sensor-transformations">
                        <p class="main-text">Size</p>
                        <div>
                            <p id="cylinder-radius-`+e.id+'" class="draggable">Radius <strong data-unit='+n.currentUnit.value+">"+Math.round(e.radius*n.currentUnit.value*100)/100+"</strong><span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        </div>
                        <div>
                            <p id="cylinder-height-`+e.id+'" class="draggable">Height <strong data-unit='+n.currentUnit.value+">"+Math.round(e.height*n.currentUnit.value*100)/100+"</strong><span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        </div>
                    </div>
                </div>`,document.getElementById("cylinder-section").appendChild(o)}function i(){r(document.getElementById("cylinder-x-pos-"+e.id)),r(document.getElementById("cylinder-y-pos-"+e.id)),r(document.getElementById("cylinder-z-pos-"+e.id)),r(document.getElementById("cylinder-x-rot-"+e.id)),r(document.getElementById("cylinder-y-rot-"+e.id)),r(document.getElementById("cylinder-z-rot-"+e.id)),r(document.getElementById("cylinder-radius-"+e.id)),r(document.getElementById("cylinder-height-"+e.id)),document.getElementById("cylinder-"+e.id+"-hide-UI").addEventListener("click",()=>a()),document.getElementById("cylinder-"+e.id+"-delete").addEventListener("click",()=>n.objects.removeCylinder(e))}function r(o){let s=o.getElementsByTagName("strong")[0],c=parseFloat(s.innerHTML),g=0,f=0;o.onmousedown=L;function L(S){s=o.getElementsByTagName("strong")[0],c=parseFloat(s.innerHTML),s.classList.add("underlined"),S=S||window.event,S.preventDefault(),g=S.clientX,document.onmouseup=w,document.onmousemove=u}function u(S){S=S||window.event,S.preventDefault(),f=S.clientX-g,g=S.clientX;let h=1;switch(o.id.split("-")[1]){case"radius":h=1/100;break;case"height":h=1/10;break}switch(o.id.split("-")[2]){case"pos":h=1/100;break;case"rot":h=1;break}switch(c+=f*h,s.innerHTML=Math.round(c*100)/100,o.id.split("-")[1]){case"x":switch(o.id.split("-")[2]){case"pos":e.xPos=c/n.currentUnit.value,e.mesh.position.set(e.xPos,e.zPos,e.yPos);break;case"rot":e.xRot=c*(Math.PI/180),e.mesh.rotation.set(e.xRot,e.zRot,e.yRot);break}break;case"y":switch(o.id.split("-")[2]){case"pos":e.yPos=c/n.currentUnit.value,e.mesh.position.set(e.xPos,e.zPos,e.yPos);break;case"rot":e.yRot=c*(Math.PI/180),e.mesh.rotation.set(e.xRot,e.zRot,e.yRot);break}break;case"z":switch(o.id.split("-")[2]){case"pos":e.zPos=c/n.currentUnit.value,e.mesh.position.set(e.xPos,e.zPos,e.yPos);break;case"rot":e.zRot=c*(Math.PI/180),e.mesh.rotation.set(e.xRot,e.zRot,e.yRot);break}break;case"radius":e.updateSize(c/n.currentUnit.value,e.height);break;case"height":e.updateSize(e.radius,c/n.currentUnit.value);break}}function w(){s.classList.contains("underlined")&&s.classList.remove("underlined"),document.onmouseup=null,document.onmousemove=null}}function a(){const o=document.getElementById("cylinder-infos-"+e.id+"-UI");document.getElementById("cylinder-"+e.id+"-UI-header");const s=o.classList.contains("hidden");s?o.classList.remove("hidden"):o.classList.add("hidden"),s?e.addToScene(n.scene):e.removeFromScene(n.scene);const c=document.getElementById("cylinder-"+e.id+"-hide-UI").firstChild;c.dataset.icon=s?"bx:minus":"bx:plus"}a(),this.updatePosition=function(o,s,c){document.getElementById("cylinder-x-pos-"+e.id).getElementsByTagName("strong")[0].innerHTML=Math.round(o*c*100)/100,document.getElementById("cylinder-y-pos-"+e.id).getElementsByTagName("strong")[0].innerHTML=Math.round(s*c*100)/100},this.dispose=function(){let o=document.getElementById("cylinder-"+e.id+"-UI");o&&o.remove()}}}const Be=class Be{static loadFont(e,n){const t=(window==null?void 0:window.designerPath)||"./";new Wt().load(t+"fonts/helvetiker_regular.typeface.json",function(i){Be.font=i,n()})}constructor(e,n){let t=[],i=[],r=[];this.nodeMeshes=[],this.lidarsMeshes=[],this.dummiesMeshes=[];const a=[[]];this.initObjects=function(){const s=new URL(document.location.href).searchParams.get("sceneData");if(s){this.parseJson(s),document.getElementById("popup").classList.remove("is-visible"),this.populateStorage();return}else{const c=sessionStorage.getItem("sceneInfos");if(console.log(JSON.parse(c)),c){this.parseJson(c);return}}n||this.addNode(!1,e.trackingMode,ce.DEFAULT_CAMERA_TYPE_ID,2.5,2.5,ce.DEFAULT_NODE_HEIGHT),e.updateFloorAugmentaSceneBorder(G.DEFAULT_WIDTH,G.DEFAULT_LENGTH),this.populateStorage()},this.deleteObject=function(o){e.transformControl&&e.transformControl.object===o.mesh&&e.transformControl.detach(),o.removeFromScene(e.scene),o.dispose()},this.addDummy=function(){if(!ge.maleModel||!ge.femaleModel){console.log("Add Dummy button will work in an instant");return}const o=new ge(r.length);e.trackingMode=="wall-tracking"&&(o.model.rotateY(180),o.mesh.position.set(0,1,1),o.updatePosition());for(let s=0;s<r.length;s++)o.mesh.position.distanceTo(r[s].mesh.position)<1&&(o.mesh.position.x++,s=0);o.updatePosition(),o.addToScene(e.scene),r.push(o),this.dummiesMeshes.push(o.mesh),this.populateStorage()},this.removeDummies=function(){r.forEach(o=>this.deleteObject(o)),r.length=0,this.dummiesMeshes.length=0,this.populateStorage()},this.addNode=function(o=!1,s=e.trackingMode,c=ce.DEFAULT_CAMERA_TYPE_ID,g=0,f=0,L=ce.DEFAULT_NODE_HEIGHT,u=0,w=0,S=0){if(!Be.font){console.log("Add Node button will work in an instant");return}const h=new ce(t.length,s,c,g,f,L,u,w,S);if(n||(h.uiElement=new pn(h,e)),!o)for(let y=0;y<t.length;y++)h.mesh.position.distanceTo(t[y].mesh.position)<.5&&(h.mesh.position.x+=.5,y=0);h.updatePosition(e.currentUnit.value),h.addToScene(e.scene),t.push(h),this.nodeMeshes.push(h.mesh),e.sceneSensorHeight=L,this.populateStorage()},this.addCylinder=function(){const o=new pt(0,e.sceneWidth/2,e.sceneLength/2,4,2,e.sceneElevation,e.currentUnit.value);o.addToScene(e.scene),o.uiElement=new gn(o,e)},this.addCylinder(),this.displayFrustums=function(){const o=t.filter(c=>c.areaAppear);t.forEach(c=>c.changeVisibility(o.length!=t.length));const s=document.getElementById("display-frustums-button-icon");s&&(s.dataset.icon=o.length!=t.length?"akar-icons:eye-open":"akar-icons:eye-slashed")},this.updateFrustumIcon=function(){const o=t.filter(c=>c.areaAppear),s=document.getElementById("display-frustums-button-icon");s&&(s.dataset.icon=o.length!=0?"akar-icons:eye-open":"akar-icons:eye-slashed")},this.removeNodes=function(){t.forEach(o=>this.deleteObject(o)),t.length=0,this.nodeMeshes.length=0,this.populateStorage()},this.removeNode=function(o){this.deleteObject(o),t=t.filter(s=>s!=o),this.nodeMeshes=this.nodeMeshes.filter(s=>s!=o.mesh),this.populateStorage()},this.addLidar=function(o=!1,s=ie.DEFAULT_LIDAR_TYPE_ID,c=0,g=ie.DEFAULT_LIDAR_HEIGHT,f=0){if(!Be.font){console.log("Add Lidar button will work in an instant");return}const L=new ie(i.length,s,c,g,f);if(L.uiElement=new fn(L,e),!o)for(let u=0;u<i.length;u++)L.mesh.position.distanceTo(i[u].mesh.position)<1&&(L.mesh.position.x+=1,u=0);L.updatePosition(e.currentUnit.value),L.addToScene(e.scene),i.push(L),this.lidarsMeshes.push(L.mesh),this.populateStorage()},this.displayRays=function(){const o=i.filter(c=>c.raysAppear);i.forEach(c=>c.changeVisibility(o.length!=i.length));const s=document.getElementById("display-lidars-rays-button-icon");s&&(s.dataset.icon=o.length!=t.length?"akar-icons:eye-open":"akar-icons:eye-slashed")},this.updateRaysIcon=function(){const o=i.filter(c=>c.raysAppear),s=document.getElementById("display-lidars-rays-button-icon");s&&(s.dataset.icon=o.length!=0?"akar-icons:eye-open":"akar-icons:eye-slashed")},this.removeLidars=function(){i.forEach(o=>this.deleteObject(o)),i.length=0,this.lidarsMeshes.length=0,this.populateStorage()},this.removeLidar=function(o){this.deleteObject(o),i=i.filter(s=>s!=o),this.lidarsMeshes=this.lidarsMeshes.filter(s=>s!=o.mesh),this.populateStorage()},this.removeCylinder=function(o){this.deleteObject(o)},this.removeSensors=function(){this.removeNodes(),this.removeLidars()},this.calculateScenePolygon=function(o,s){a[0].length=0,a[0].push([0,0]),a[0].push([o,0]),a[0].push([o,s]),a[0].push([0,s])},this.updateObjectsPosition=function(){t.forEach(o=>o.updatePosition(e.currentUnit.value)),i.forEach(o=>o.updatePosition(e.currentUnit.value)),r.forEach(o=>o.updatePosition())},this.generateLink=function(){const o=new URL(document.location.href.split("?")[0]);return o.searchParams.append("sceneData",sessionStorage.getItem("sceneInfos")),o},this.parseJson=function(o){const s=JSON.parse(o);s.hasOwnProperty("sceneEnvironment")&&(e.sceneEnvironment=s.sceneEnvironment);let c="human-tracking";if(s.hasOwnProperty("trackingMode")&&(c=s.trackingMode,e.trackingMode=c),s.hasOwnProperty("sceneSize")&&s.sceneSize.length===2){const f=s.sceneSize[0],L=s.sceneSize[1];switch(c){case"wall-tracking":{const u=document.getElementById("input-wall-y-scene-width-inspector");u&&(u.value=f);const w=document.getElementById("input-wall-y-scene-height-inspector");w&&(w.value=L),e.updateWallYAugmentaSceneBorder(f,L);break}case"hand-tracking":case"human-tracking":{const u=document.getElementById("input-scene-width-inspector");u&&(u.value=f);const w=document.getElementById("input-scene-length-inspector");w&&(w.value=L),e.updateFloorAugmentaSceneBorder(f,L);break}}}s.hasOwnProperty("unit")&&e.toggleUnit(s.unit);const g=document.getElementById("tracking-mode-selection-inspector");if(g&&(g.value=c,g.dispatchEvent(new Event("change"))),s.hasOwnProperty("heightDetected")){const f=document.getElementById("overlap-height-selection-inspector");f&&(f.value=s.heightDetected,f.dispatchEvent(new Event("change"))),e.heightDetected=s.heightDetected}if(s.hasOwnProperty("sceneSensorHeight")){const f=document.getElementById("input-scene-sensor-height-inspector");f&&(f.value=s.sceneSensorHeight,f.dispatchEvent(new Event("change"))),e.sceneSensorHeight=s.sceneSensorHeight}if(s.hasOwnProperty("objects")&&(s.objects.hasOwnProperty("nodes")&&s.objects.nodes.forEach(f=>this.addNode(!0,s.trackingMode,f.cameraTypeId,f.p_x,f.p_y,f.p_z,f.r_x,f.r_y,f.r_z)),s.objects.hasOwnProperty("lidars")&&s.objects.lidars.forEach(f=>this.addLidar(!0,f.lidarTypeId,f.p_x,f.p_z,f.r_y)),s.objects.hasOwnProperty("dummies"))){if(!ge.maleModel||!ge.femaleModel)return;s.objects.dummies.forEach(f=>{this.addDummy();const L=r[r.length-1];L.mesh.translateX(f.p_x),L.mesh.translateZ(f.p_y),L.updatePosition()})}},this.generateJson=function(){const o={sceneEnvironment:e.sceneEnvironment,sceneSize:[e.sceneWidth,e.sceneLength],unit:e.currentUnit,trackingMode:e.trackingMode,heightDetected:e.heightDetected,sceneSensorHeight:e.sceneSensorHeight,objects:{nodes:[],lidars:[],dummies:[]}};return t.forEach(s=>{const c={id:s.id,cameraTypeId:s.cameraType.id,p_x:s.xPos,p_y:s.yPos,p_z:s.zPos,r_x:s.xRot,r_y:s.yRot,r_z:s.zRot};o.objects.nodes.push(c)}),i.forEach(s=>{const c={id:s.id,lidarTypeId:s.lidarType.id,p_x:s.xPos,p_z:s.zPos,r_y:s.yRot};o.objects.lidars.push(c)}),r.forEach(s=>{const c={id:s.id,p_x:s.xPos,p_y:s.yPos,p_z:s.zPos};o.objects.dummies.push(c)}),JSON.stringify(o)},this.populateStorage=()=>sessionStorage.setItem("sceneInfos",this.generateJson()),this.changeSensorsTrackingMode=function(o){t.forEach(s=>s.changeMode(o))},this.doesCoverArea=function(){let s={regions:[...a],inverted:!0};return t.forEach(c=>{const g={regions:[[]],inverted:!1};c.coveredPointsAbove.forEach(w=>{g.regions[0].push([w.x,w.z])});const f=PolyBool.segments(g),L=PolyBool.segments(s),u=PolyBool.combine(f,L);s=PolyBool.polygon(PolyBool.selectUnion(u))}),s.regions.length===0},this.getNbNodes=()=>t.length,this.getNbLidars=()=>i.length,this.getNbSensors=()=>this.getNbNodes()+this.getNbLidars(),this.debug=function(){console.log(JSON.parse(sessionStorage.getItem("sceneInfos")))},this.update=function(){t.forEach(o=>{o.update(),e.drawProjection(o)})},Be.loadFont(n,()=>G.loadFont(n,()=>e.initAugmentaScene())),Mt(n,"male"),Mt(n,"female")}};R(Be,"font");let Re=Be;class yn{constructor(){this._observers=[]}addObserver(e){return this._observers.push(e),()=>{this._observers=this._observers.filter(n=>n!==e)}}notifyAllObservers(...e){this._observers.forEach(n=>{n(...e)})}notifyObserversExceptOrigin(e,...n){this._observers.filter(t=>t!==e).forEach(t=>{t(...n)})}}const Pe=new Zt,re=new P,be=new P,X=new le,Bt={X:new P(1,0,0),Y:new P(0,1,0),Z:new P(0,0,1)},lt={type:"change"},kt={type:"mouseDown"},At={type:"mouseUp",mode:null},Dt={type:"objectChange"};class En extends at{constructor(e,n){super(),n===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),n=document),this.isTransformControls=!0,this.visible=!1,this.domElement=n,this.domElement.style.touchAction="none";const t=new Tn;this._gizmo=t,this.add(t);const i=new Pn;this._plane=i,this.add(i);const r=this;function a(k,A){let C=A;Object.defineProperty(r,k,{get:function(){return C!==void 0?C:A},set:function(O){C!==O&&(C=O,i[k]=O,t[k]=O,r.dispatchEvent({type:k+"-changed",value:O}),r.dispatchEvent(lt))}}),r[k]=A,i[k]=A,t[k]=A}a("camera",e),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);const o=new P,s=new P,c=new le,g=new le,f=new P,L=new le,u=new P,w=new P,S=new P,h=0,y=new P;a("worldPosition",o),a("worldPositionStart",s),a("worldQuaternion",c),a("worldQuaternionStart",g),a("cameraPosition",f),a("cameraQuaternion",L),a("pointStart",u),a("pointEnd",w),a("rotationAxis",S),a("rotationAngle",h),a("eye",y),this._offset=new P,this._startNorm=new P,this._endNorm=new P,this._cameraScale=new P,this._parentPosition=new P,this._parentQuaternion=new le,this._parentQuaternionInv=new le,this._parentScale=new P,this._worldScaleStart=new P,this._worldQuaternionInv=new le,this._worldScale=new P,this._positionStart=new P,this._quaternionStart=new le,this._scaleStart=new P,this._getPointer=vn.bind(this),this._onPointerDown=wn.bind(this),this._onPointerHover=bn.bind(this),this._onPointerMove=In.bind(this),this._onPointerUp=Ln.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;Pe.setFromCamera(e,this.camera);const n=dt(this._gizmo.picker[this.mode],Pe);n?this.axis=n.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){Pe.setFromCamera(e,this.camera);const n=dt(this._plane,Pe,!0);n&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(n.point).sub(this.worldPositionStart)),this.dragging=!0,kt.mode=this.mode,this.dispatchEvent(kt)}}pointerMove(e){const n=this.axis,t=this.mode,i=this.object;let r=this.space;if(t==="scale"?r="local":(n==="E"||n==="XYZE"||n==="XYZ")&&(r="world"),i===void 0||n===null||this.dragging===!1||e.button!==-1)return;Pe.setFromCamera(e,this.camera);const a=dt(this._plane,Pe,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),t==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&n!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),n.indexOf("X")===-1&&(this._offset.x=0),n.indexOf("Y")===-1&&(this._offset.y=0),n.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&n!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(i.position.applyQuaternion(X.copy(this._quaternionStart).invert()),n.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),n.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),n.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),r==="world"&&(i.parent&&i.position.add(re.setFromMatrixPosition(i.parent.matrixWorld)),n.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),n.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),n.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(re.setFromMatrixPosition(i.parent.matrixWorld))));else if(t==="scale"){if(n.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),be.set(o,o,o)}else re.copy(this.pointStart),be.copy(this.pointEnd),re.applyQuaternion(this._worldQuaternionInv),be.applyQuaternion(this._worldQuaternionInv),be.divide(re),n.search("X")===-1&&(be.x=1),n.search("Y")===-1&&(be.y=1),n.search("Z")===-1&&(be.z=1);i.scale.copy(this._scaleStart).multiply(be),this.scaleSnap&&(n.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),n.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),n.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(t==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(re.setFromMatrixPosition(this.camera.matrixWorld));n==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):n==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(re.copy(this.rotationAxis).cross(this.eye))*o):(n==="X"||n==="Y"||n==="Z")&&(this.rotationAxis.copy(Bt[n]),re.copy(Bt[n]),r==="local"&&re.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(re.cross(this.eye).normalize())*o),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&n!=="E"&&n!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(X.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(X.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(lt),this.dispatchEvent(Dt)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(At.mode=this.mode,this.dispatchEvent(At)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(lt),this.dispatchEvent(Dt),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Pe}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}update(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}}function vn(m){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:m.button};{const e=this.domElement.getBoundingClientRect();return{x:(m.clientX-e.left)/e.width*2-1,y:-(m.clientY-e.top)/e.height*2+1,button:m.button}}}function bn(m){if(this.enabled)switch(m.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(m));break}}function wn(m){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(m.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(m)),this.pointerDown(this._getPointer(m)))}function In(m){this.enabled&&this.pointerMove(this._getPointer(m))}function Ln(m){this.enabled&&(this.domElement.releasePointerCapture(m.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(m)))}function dt(m,e,n){const t=e.intersectObject(m,!0);for(let i=0;i<t.length;i++)if(t[i].object.visible||n)return t[i];return!1}const nt=new nn,j=new P(0,1,0),_t=new P(0,0,0),Ut=new gt,st=new le,ot=new le,he=new P,zt=new gt,Qe=new P(1,0,0),Se=new P(0,1,0),qe=new P(0,0,1),it=new P,Xe=new P,We=new P;class Tn extends at{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Ae({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=new jt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=e.clone();t.opacity=.15;const i=n.clone();i.opacity=.5;const r=e.clone();r.color.setHex(12535623);const a=e.clone();a.color.setHex(3646602);const o=e.clone();o.color.setHex(7376560);const s=e.clone();s.color.setHex(12535623),s.opacity=.5;const c=e.clone();c.color.setHex(3646602),c.opacity=.5;const g=e.clone();g.color.setHex(7376560),g.opacity=.5;const f=e.clone();f.opacity=.25;const L=e.clone();L.color.setHex(16776960),L.opacity=.25,e.clone().color.setHex(16776960);const w=e.clone();w.color.setHex(7895160);const S=new J(0,.04,.1,12);S.translate(0,.05,0);const h=new K(.08,.08,.08);h.translate(0,.04,0);const y=new rt;y.setAttribute("position",new Pt([0,0,0,1,0,0],3));const k=new J(.0075,.0075,.5,3);k.translate(0,.25,0);function A(B,v){const M=new Ye(B,.0075,3,64,v*Math.PI*2);return M.rotateY(Math.PI/2),M.rotateX(Math.PI/2),M}function C(){const B=new rt;return B.setAttribute("position",new Pt([0,0,0,1,1,1],3)),B}const O={X:[[new T(S,r),[.5,0,0],[0,0,-Math.PI/2]],[new T(S,r),[-.5,0,0],[0,0,Math.PI/2]],[new T(k,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new T(S,o),[0,.5,0]],[new T(S,o),[0,-.5,0],[Math.PI,0,0]],[new T(k,o)]],Z:[[new T(S,a),[0,0,.5],[Math.PI/2,0,0]],[new T(S,a),[0,0,-.5],[-Math.PI/2,0,0]],[new T(k,a),null,[Math.PI/2,0,0]]],XYZ:[[new T(new tt(.1,0),f.clone()),[0,0,0]]],XY:[[new T(new K(.15,.15,.01),c.clone()),[.15,.15,0]]],YZ:[[new T(new K(.15,.15,.01),s.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new T(new K(.15,.15,.01),g.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},F={X:[[new T(new J(.2,0,.6,4),t),[.3,0,0],[0,0,-Math.PI/2]],[new T(new J(.2,0,.6,4),t),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new T(new J(.2,0,.6,4),t),[0,.3,0]],[new T(new J(.2,0,.6,4),t),[0,-.3,0],[0,0,Math.PI]]],Z:[[new T(new J(.2,0,.6,4),t),[0,0,.3],[Math.PI/2,0,0]],[new T(new J(.2,0,.6,4),t),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new T(new tt(.2,0),t)]],XY:[[new T(new K(.2,.2,.01),t),[.15,.15,0]]],YZ:[[new T(new K(.2,.2,.01),t),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new T(new K(.2,.2,.01),t),[.15,0,.15],[-Math.PI/2,0,0]]]},l={START:[[new T(new tt(.01,2),i),null,null,null,"helper"]],END:[[new T(new tt(.01,2),i),null,null,null,"helper"]],DELTA:[[new ve(C(),i),null,null,null,"helper"]],X:[[new ve(y,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new ve(y,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new ve(y,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},D={XYZE:[[new T(A(.5,1),w),null,[0,Math.PI/2,0]]],X:[[new T(A(.5,.5),r)]],Y:[[new T(A(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new T(A(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new T(A(.75,1),L),null,[0,Math.PI/2,0]]]},I={AXIS:[[new ve(y,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},b={XYZE:[[new T(new sn(.25,10,8),t)]],X:[[new T(new Ye(.5,.1,4,24),t),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new T(new Ye(.5,.1,4,24),t),[0,0,0],[Math.PI/2,0,0]]],Z:[[new T(new Ye(.5,.1,4,24),t),[0,0,0],[0,0,-Math.PI/2]]],E:[[new T(new Ye(.75,.1,2,24),t)]]},_={X:[[new T(h,r),[.5,0,0],[0,0,-Math.PI/2]],[new T(k,r),[0,0,0],[0,0,-Math.PI/2]],[new T(h,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new T(h,o),[0,.5,0]],[new T(k,o)],[new T(h,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new T(h,a),[0,0,.5],[Math.PI/2,0,0]],[new T(k,a),[0,0,0],[Math.PI/2,0,0]],[new T(h,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new T(new K(.15,.15,.01),c),[.15,.15,0]]],YZ:[[new T(new K(.15,.15,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new T(new K(.15,.15,.01),g),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new T(new K(.1,.1,.1),f.clone())]]},p={X:[[new T(new J(.2,0,.6,4),t),[.3,0,0],[0,0,-Math.PI/2]],[new T(new J(.2,0,.6,4),t),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new T(new J(.2,0,.6,4),t),[0,.3,0]],[new T(new J(.2,0,.6,4),t),[0,-.3,0],[0,0,Math.PI]]],Z:[[new T(new J(.2,0,.6,4),t),[0,0,.3],[Math.PI/2,0,0]],[new T(new J(.2,0,.6,4),t),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new T(new K(.2,.2,.01),t),[.15,.15,0]]],YZ:[[new T(new K(.2,.2,.01),t),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new T(new K(.2,.2,.01),t),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new T(new K(.2,.2,.2),t),[0,0,0]]]},x={X:[[new ve(y,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new ve(y,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new ve(y,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function E(B){const v=new at;for(const M in B)for(let z=B[M].length;z--;){const U=B[M][z][0].clone(),Q=B[M][z][1],ne=B[M][z][2],$=B[M][z][3],_e=B[M][z][4];U.name=M,U.tag=_e,Q&&U.position.set(Q[0],Q[1],Q[2]),ne&&U.rotation.set(ne[0],ne[1],ne[2]),$&&U.scale.set($[0],$[1],$[2]),U.updateMatrix();const ee=U.geometry.clone();ee.applyMatrix4(U.matrix),U.geometry=ee,U.renderOrder=1/0,U.position.set(0,0,0),U.rotation.set(0,0,0),U.scale.set(1,1,1),v.add(U)}return v}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=E(O)),this.add(this.gizmo.rotate=E(D)),this.add(this.gizmo.scale=E(_)),this.add(this.picker.translate=E(F)),this.add(this.picker.rotate=E(b)),this.add(this.picker.scale=E(p)),this.add(this.helper.translate=E(l)),this.add(this.helper.rotate=E(I)),this.add(this.helper.scale=E(x)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:ot;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let r=0;r<i.length;r++){const a=i[r];a.visible=!0,a.rotation.set(0,0,0),a.position.copy(this.worldPosition);let o;if(this.camera.isOrthographicCamera?o=(this.camera.top-this.camera.bottom)/this.camera.zoom:o=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),a.scale.set(1,1,1).multiplyScalar(o*this.size/4),a.tag==="helper"){a.visible=!1,a.name==="AXIS"?(a.position.copy(this.worldPositionStart),a.visible=!!this.axis,this.axis==="X"&&(X.setFromEuler(nt.set(0,0,0)),a.quaternion.copy(t).multiply(X),Math.abs(j.copy(Qe).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="Y"&&(X.setFromEuler(nt.set(0,0,Math.PI/2)),a.quaternion.copy(t).multiply(X),Math.abs(j.copy(Se).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="Z"&&(X.setFromEuler(nt.set(0,Math.PI/2,0)),a.quaternion.copy(t).multiply(X),Math.abs(j.copy(qe).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="XYZE"&&(X.setFromEuler(nt.set(0,Math.PI/2,0)),j.copy(this.rotationAxis),a.quaternion.setFromRotationMatrix(Ut.lookAt(_t,j,Se)),a.quaternion.multiply(X),a.visible=this.dragging),this.axis==="E"&&(a.visible=!1)):a.name==="START"?(a.position.copy(this.worldPositionStart),a.visible=this.dragging):a.name==="END"?(a.position.copy(this.worldPosition),a.visible=this.dragging):a.name==="DELTA"?(a.position.copy(this.worldPositionStart),a.quaternion.copy(this.worldQuaternionStart),re.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),re.applyQuaternion(this.worldQuaternionStart.clone().invert()),a.scale.copy(re),a.visible=this.dragging):(a.quaternion.copy(t),this.dragging?a.position.copy(this.worldPositionStart):a.position.copy(this.worldPosition),this.axis&&(a.visible=this.axis.search(a.name)!==-1));continue}a.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(a.name==="X"&&Math.abs(j.copy(Qe).applyQuaternion(t).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="Y"&&Math.abs(j.copy(Se).applyQuaternion(t).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="Z"&&Math.abs(j.copy(qe).applyQuaternion(t).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="XY"&&Math.abs(j.copy(qe).applyQuaternion(t).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="YZ"&&Math.abs(j.copy(Qe).applyQuaternion(t).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="XZ"&&Math.abs(j.copy(Se).applyQuaternion(t).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1)):this.mode==="rotate"&&(st.copy(t),j.copy(this.eye).applyQuaternion(X.copy(t).invert()),a.name.search("E")!==-1&&a.quaternion.setFromRotationMatrix(Ut.lookAt(this.eye,_t,Se)),a.name==="X"&&(X.setFromAxisAngle(Qe,Math.atan2(-j.y,j.z)),X.multiplyQuaternions(st,X),a.quaternion.copy(X)),a.name==="Y"&&(X.setFromAxisAngle(Se,Math.atan2(j.x,j.z)),X.multiplyQuaternions(st,X),a.quaternion.copy(X)),a.name==="Z"&&(X.setFromAxisAngle(qe,Math.atan2(j.y,j.x)),X.multiplyQuaternions(st,X),a.quaternion.copy(X))),a.visible=a.visible&&(a.name.indexOf("X")===-1||this.showX),a.visible=a.visible&&(a.name.indexOf("Y")===-1||this.showY),a.visible=a.visible&&(a.name.indexOf("Z")===-1||this.showZ),a.visible=a.visible&&(a.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),a.material._color=a.material._color||a.material.color.clone(),a.material._opacity=a.material._opacity||a.material.opacity,a.material.color.copy(a.material._color),a.material.opacity=a.material._opacity,this.enabled&&this.axis&&(a.name===this.axis||this.axis.split("").some(function(s){return a.name===s}))&&(a.material.color.setHex(16776960),a.material.opacity=1)}super.updateMatrixWorld(e)}}class Pn extends T{constructor(){super(new fe(1e5,1e5,2,2),new Ae({visible:!1,wireframe:!0,side:De,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let n=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(n="local"),it.copy(Qe).applyQuaternion(n==="local"?this.worldQuaternion:ot),Xe.copy(Se).applyQuaternion(n==="local"?this.worldQuaternion:ot),We.copy(qe).applyQuaternion(n==="local"?this.worldQuaternion:ot),j.copy(Xe),this.mode){case"translate":case"scale":switch(this.axis){case"X":j.copy(this.eye).cross(it),he.copy(it).cross(j);break;case"Y":j.copy(this.eye).cross(Xe),he.copy(Xe).cross(j);break;case"Z":j.copy(this.eye).cross(We),he.copy(We).cross(j);break;case"XY":he.copy(We);break;case"YZ":he.copy(it);break;case"XZ":j.copy(We),he.copy(Xe);break;case"XYZ":case"E":he.set(0,0,0);break}break;case"rotate":default:he.set(0,0,0)}he.length()===0?this.quaternion.copy(this.cameraQuaternion):(zt.lookAt(re.set(0,0,0),he,j),this.quaternion.setFromRotationMatrix(zt)),super.updateMatrixWorld(e)}}const Ot={type:"change"},ht={type:"start"},ut={type:"end"};class xn extends on{constructor(e,n){super(),n===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=n,this.enabled=!0,this.target=new P,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Fe.ROTATE,MIDDLE:Fe.DOLLY,RIGHT:Fe.PAN},this.touches={ONE:Ce.ROTATE,TWO:Ce.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.listenToKeyEvents=function(d){d.addEventListener("keydown",Et),this._domElementKeyEvents=d},this.saveState=function(){t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=function(){t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(Ot),t.update(),r=i.NONE},this.update=function(){const d=new P,H=new le().setFromUnitVectors(e.up,new P(0,1,0)),Z=H.clone().invert(),te=new P,Te=new le,Oe=2*Math.PI;return function(){const Lt=t.object.position;d.copy(Lt).sub(t.target),d.applyQuaternion(H),o.setFromVector3(d),t.autoRotate&&r===i.NONE&&l(O()),t.enableDamping?(o.theta+=s.theta*t.dampingFactor,o.phi+=s.phi*t.dampingFactor):(o.theta+=s.theta,o.phi+=s.phi);let me=t.minAzimuthAngle,pe=t.maxAzimuthAngle;return isFinite(me)&&isFinite(pe)&&(me<-Math.PI?me+=Oe:me>Math.PI&&(me-=Oe),pe<-Math.PI?pe+=Oe:pe>Math.PI&&(pe-=Oe),me<=pe?o.theta=Math.max(me,Math.min(pe,o.theta)):o.theta=o.theta>(me+pe)/2?Math.max(me,o.theta):Math.min(pe,o.theta)),o.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,o.phi)),o.makeSafe(),o.radius*=c,o.radius=Math.max(t.minDistance,Math.min(t.maxDistance,o.radius)),t.enableDamping===!0?t.target.addScaledVector(g,t.dampingFactor):t.target.add(g),d.setFromSpherical(o),d.applyQuaternion(Z),Lt.copy(t.target).add(d),t.object.lookAt(t.target),t.enableDamping===!0?(s.theta*=1-t.dampingFactor,s.phi*=1-t.dampingFactor,g.multiplyScalar(1-t.dampingFactor)):(s.set(0,0,0),g.set(0,0,0)),c=1,f||te.distanceToSquared(t.object.position)>a||8*(1-Te.dot(t.object.quaternion))>a?(t.dispatchEvent(Ot),te.copy(t.object.position),Te.copy(t.object.quaternion),f=!1,!0):!1}}(),this.dispose=function(){t.domElement.removeEventListener("contextmenu",It),t.domElement.removeEventListener("pointerdown",Le),t.domElement.removeEventListener("wheel",yt),t.domElement.removeEventListener("touchstart",vt),t.domElement.removeEventListener("touchend",wt),t.domElement.removeEventListener("touchmove",bt),t.domElement.ownerDocument.removeEventListener("pointermove",oe),t.domElement.ownerDocument.removeEventListener("pointerup",Y),t._domElementKeyEvents!==null&&t._domElementKeyEvents.removeEventListener("keydown",Et)};const t=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=i.NONE;const a=1e-6,o=new xt,s=new xt;let c=1;const g=new P;let f=!1;const L=new V,u=new V,w=new V,S=new V,h=new V,y=new V,k=new V,A=new V,C=new V;function O(){return 2*Math.PI/60/60*t.autoRotateSpeed}function F(){return Math.pow(.95,t.zoomSpeed)}function l(d){s.theta-=d}function D(d){s.phi-=d}this.rotateLeft=l,this.rotateUp=D;const I=function(){const d=new P;return function(Z,te){d.setFromMatrixColumn(te,0),d.multiplyScalar(-Z),g.add(d)}}(),b=function(){const d=new P;return function(Z,te){t.screenSpacePanning===!0?d.setFromMatrixColumn(te,1):(d.setFromMatrixColumn(te,0),d.crossVectors(t.object.up,d)),d.multiplyScalar(Z),g.add(d)}}(),_=function(){const d=new P;return function(Z,te){const Te=t.domElement;if(t.object.isPerspectiveCamera){const Oe=t.object.position;d.copy(Oe).sub(t.target);let et=d.length();et*=Math.tan(t.object.fov/2*Math.PI/180),I(2*Z*et/Te.clientHeight,t.object.matrix),b(2*te*et/Te.clientHeight,t.object.matrix)}else t.object.isOrthographicCamera?(I(Z*(t.object.right-t.object.left)/t.object.zoom/Te.clientWidth,t.object.matrix),b(te*(t.object.top-t.object.bottom)/t.object.zoom/Te.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}}();function p(d){t.object.isPerspectiveCamera?c/=d:t.object.isOrthographicCamera?(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom*d)),t.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function x(d){t.object.isPerspectiveCamera?c*=d:t.object.isOrthographicCamera?(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/d)),t.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function E(d){L.set(d.clientX,d.clientY)}function B(d){k.set(d.clientX,d.clientY)}function v(d){S.set(d.clientX,d.clientY)}function M(d){u.set(d.clientX,d.clientY),w.subVectors(u,L).multiplyScalar(t.rotateSpeed);const H=t.domElement;l(2*Math.PI*w.x/H.clientHeight),D(2*Math.PI*w.y/H.clientHeight),L.copy(u),t.update()}function z(d){A.set(d.clientX,d.clientY),C.subVectors(A,k),C.y>0?p(F()):C.y<0&&x(F()),k.copy(A),t.update()}function U(d){h.set(d.clientX,d.clientY),y.subVectors(h,S).multiplyScalar(t.panSpeed),_(y.x,y.y),S.copy(h),t.update()}function Q(d){d.deltaY<0?x(F()):d.deltaY>0&&p(F()),t.update()}function ne(d){let H=!1;switch(d.code){case t.keys.UP:_(0,t.keyPanSpeed),H=!0;break;case t.keys.BOTTOM:_(0,-t.keyPanSpeed),H=!0;break;case t.keys.LEFT:_(t.keyPanSpeed,0),H=!0;break;case t.keys.RIGHT:_(-t.keyPanSpeed,0),H=!0;break}H&&(d.preventDefault(),t.update())}function $(d){if(d.touches.length==1)L.set(d.touches[0].pageX,d.touches[0].pageY);else{const H=.5*(d.touches[0].pageX+d.touches[1].pageX),Z=.5*(d.touches[0].pageY+d.touches[1].pageY);L.set(H,Z)}}function _e(d){if(d.touches.length==1)S.set(d.touches[0].pageX,d.touches[0].pageY);else{const H=.5*(d.touches[0].pageX+d.touches[1].pageX),Z=.5*(d.touches[0].pageY+d.touches[1].pageY);S.set(H,Z)}}function ee(d){const H=d.touches[0].pageX-d.touches[1].pageX,Z=d.touches[0].pageY-d.touches[1].pageY,te=Math.sqrt(H*H+Z*Z);k.set(0,te)}function Ue(d){t.enableZoom&&ee(d),t.enablePan&&_e(d)}function je(d){t.enableZoom&&ee(d),t.enableRotate&&$(d)}function ze(d){if(d.touches.length==1)u.set(d.touches[0].pageX,d.touches[0].pageY);else{const Z=.5*(d.touches[0].pageX+d.touches[1].pageX),te=.5*(d.touches[0].pageY+d.touches[1].pageY);u.set(Z,te)}w.subVectors(u,L).multiplyScalar(t.rotateSpeed);const H=t.domElement;l(2*Math.PI*w.x/H.clientHeight),D(2*Math.PI*w.y/H.clientHeight),L.copy(u)}function se(d){if(d.touches.length==1)h.set(d.touches[0].pageX,d.touches[0].pageY);else{const H=.5*(d.touches[0].pageX+d.touches[1].pageX),Z=.5*(d.touches[0].pageY+d.touches[1].pageY);h.set(H,Z)}y.subVectors(h,S).multiplyScalar(t.panSpeed),_(y.x,y.y),S.copy(h)}function $e(d){const H=d.touches[0].pageX-d.touches[1].pageX,Z=d.touches[0].pageY-d.touches[1].pageY,te=Math.sqrt(H*H+Z*Z);A.set(0,te),C.set(0,Math.pow(A.y/k.y,t.zoomSpeed)),p(C.y),k.copy(A)}function N(d){t.enableZoom&&$e(d),t.enablePan&&se(d)}function Ee(d){t.enableZoom&&$e(d),t.enableRotate&&ze(d)}function Le(d){if(t.enabled!==!1)switch(d.pointerType){case"mouse":case"pen":ue(d);break}}function oe(d){if(t.enabled!==!1)switch(d.pointerType){case"mouse":case"pen":Qt(d);break}}function Y(d){switch(d.pointerType){case"mouse":case"pen":qt();break}}function ue(d){d.preventDefault(),t.domElement.focus?t.domElement.focus():window.focus();let H;switch(d.button){case 0:H=t.mouseButtons.LEFT;break;case 1:H=t.mouseButtons.MIDDLE;break;case 2:H=t.mouseButtons.RIGHT;break;default:H=-1}switch(H){case Fe.DOLLY:if(t.enableZoom===!1)return;B(d),r=i.DOLLY;break;case Fe.ROTATE:if(d.ctrlKey||d.metaKey||d.shiftKey){if(t.enablePan===!1)return;v(d),r=i.PAN}else{if(t.enableRotate===!1)return;E(d),r=i.ROTATE}break;case Fe.PAN:if(d.ctrlKey||d.metaKey||d.shiftKey){if(t.enableRotate===!1)return;E(d),r=i.ROTATE}else{if(t.enablePan===!1)return;v(d),r=i.PAN}break;default:r=i.NONE}r!==i.NONE&&(t.domElement.ownerDocument.addEventListener("pointermove",oe),t.domElement.ownerDocument.addEventListener("pointerup",Y),t.dispatchEvent(ht))}function Qt(d){if(t.enabled!==!1)switch(d.preventDefault(),r){case i.ROTATE:if(t.enableRotate===!1)return;M(d);break;case i.DOLLY:if(t.enableZoom===!1)return;z(d);break;case i.PAN:if(t.enablePan===!1)return;U(d);break}}function qt(d){t.domElement.ownerDocument.removeEventListener("pointermove",oe),t.domElement.ownerDocument.removeEventListener("pointerup",Y),t.enabled!==!1&&(t.dispatchEvent(ut),r=i.NONE)}function yt(d){t.enabled===!1||t.enableZoom===!1||r!==i.NONE&&r!==i.ROTATE||(d.preventDefault(),t.dispatchEvent(ht),Q(d),t.dispatchEvent(ut))}function Et(d){t.enabled===!1||t.enablePan===!1||ne(d)}function vt(d){if(t.enabled!==!1){switch(d.preventDefault(),d.touches.length){case 1:switch(t.touches.ONE){case Ce.ROTATE:if(t.enableRotate===!1)return;$(d),r=i.TOUCH_ROTATE;break;case Ce.PAN:if(t.enablePan===!1)return;_e(d),r=i.TOUCH_PAN;break;default:r=i.NONE}break;case 2:switch(t.touches.TWO){case Ce.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;Ue(d),r=i.TOUCH_DOLLY_PAN;break;case Ce.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;je(d),r=i.TOUCH_DOLLY_ROTATE;break;default:r=i.NONE}break;default:r=i.NONE}r!==i.NONE&&t.dispatchEvent(ht)}}function bt(d){if(t.enabled!==!1)switch(d.preventDefault(),r){case i.TOUCH_ROTATE:if(t.enableRotate===!1)return;ze(d),t.update();break;case i.TOUCH_PAN:if(t.enablePan===!1)return;se(d),t.update();break;case i.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;N(d),t.update();break;case i.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;Ee(d),t.update();break;default:r=i.NONE}}function wt(d){t.enabled!==!1&&(t.dispatchEvent(ut),r=i.NONE)}function It(d){t.enabled!==!1&&d.preventDefault()}t.domElement.addEventListener("contextmenu",It),t.domElement.addEventListener("pointerdown",Le),t.domElement.addEventListener("wheel",yt,{passive:!1}),t.domElement.addEventListener("touchstart",vt,{passive:!1}),t.domElement.addEventListener("touchend",wt),t.domElement.addEventListener("touchmove",bt,{passive:!1}),this.update()}}class Sn{constructor(e,n,t){n=Object.assign({size:90,padding:8,bubbleSizePrimary:8,bubbleSizeSecondary:6,lineWidth:2,fontSize:"12px",fontFamily:"arial",fontWeight:"bold",fontColor:"#222222",className:"orbit-controls-gizmo",colors:{x:["#f73c3c","#942424"],y:["#6ccb26","#417a17"],z:["#178cf0","#0e5490"]}},n),this.lock=!1,this.lockX=!1,this.lockY=!1,this.update=()=>{if(!this.lock){o.updateMatrix(),s.extractRotation(o.matrix).invert();for(let v=0,M=w.length;v<M;v++)B(w[v],s);w.sort((v,M)=>v.position.z>M.position.z?1:-1),E(!0)}},this.dispose=()=>{a.removeEventListener("change",this.update),a.removeEventListener("start",()=>this.domElement.classList.add("inactive")),a.removeEventListener("end",()=>this.domElement.classList.remove("inactive")),this.domElement.removeEventListener("pointerdown",F,!1),this.domElement.removeEventListener("pointerenter",D,!1),this.domElement.removeEventListener("pointermove",I,!1),this.domElement.removeEventListener("click",_,!1),window.removeEventListener("pointermove",b,!1),window.removeEventListener("pointerup",l,!1),this.domElement.remove()};const i=t,r=this,a=e,o=e.object,s=new gt,c=new P,g=new V,f=new V,L=new V,u=new P(n.size/2,n.size/2,0),w=C();let S=null,h=!1,y,k,A;a.addEventListener("change",this.update),a.addEventListener("start",()=>this.domElement.classList.add("inactive")),a.addEventListener("end",()=>this.domElement.classList.remove("inactive"));function C(){const v=n.colors,M=n.lineWidth,z={primary:n.bubbleSizePrimary,secondary:n.bubbleSizeSecondary};return[{axis:"x",direction:new P(1,0,0),size:z.primary,color:v.x,line:M,label:"X",position:new P(0,0,0)},{axis:"y",direction:new P(0,1,0),size:z.primary,color:v.y,line:M,label:"Z",position:new P(0,0,0)},{axis:"z",direction:new P(0,0,1),size:z.primary,color:v.z,line:M,label:"Y",position:new P(0,0,0)},{axis:"-x",direction:new P(-1,0,0),size:z.secondary,color:v.x,position:new P(0,0,0)},{axis:"-y",direction:new P(0,-1,0),size:z.secondary,color:v.y,position:new P(0,0,0)},{axis:"-z",direction:new P(0,0,-1),size:z.secondary,color:v.z,position:new P(0,0,0)}]}function O(){const v=document.createElement("canvas");return v.width=n.size,v.height=n.size,v.classList.add(n.className),v.addEventListener("pointerdown",F,!1),v.addEventListener("pointerenter",D,!1),v.addEventListener("pointermove",I,!1),v.addEventListener("click",_,!1),y=v.getContext("2d"),v}function F(v){g.set(v.clientX,v.clientY),A=a.enabled,a.enabled=!1,o.isPerspectiveCamera&&(window.addEventListener("pointermove",b,!1),window.addEventListener("pointerup",l,!1))}function l(){setTimeout(()=>h=!1,0),r.domElement.classList.remove("dragging"),a.enabled=A,window.removeEventListener("pointermove",b,!1),window.removeEventListener("pointerup",l,!1)}function D(){k=r.domElement.getBoundingClientRect()}function I(v){if(h||r.lock)return;const M=S;S=null,v&&c.set(v.clientX-k.left,v.clientY-k.top,0);for(let z=0,U=w.length;z<U;z++)c.distanceTo(w[z].position)<w[z].size&&(S=w[z]);M!==S&&E()}function b(v){r.lock||(h||r.domElement.classList.add("dragging"),h=!0,S=null,f.set(v.clientX,v.clientY),L.subVectors(f,g).multiplyScalar(.5),r.lockX||a.rotateLeft(2*Math.PI*L.x/r.domElement.height),r.lockY||a.rotateUp(2*Math.PI*L.y/r.domElement.height),g.copy(f),a.update())}function _(){if(h||!S)return;const v=S.direction.clone();v.multiplyScalar(10),i.setupCameraChangement(!!o.isPerspectiveCamera,v),S=null}function p(v,M=10,z="#FF0000"){y.beginPath(),y.arc(v.x,v.y,M,0,2*Math.PI,!1),y.fillStyle=z,y.fill(),y.closePath()}function x(v,M,z=1,U="#FF0000"){y.beginPath(),y.moveTo(v.x,v.y),y.lineTo(M.x,M.y),y.lineWidth=z,y.strokeStyle=U,y.stroke(),y.closePath()}function E(v){v&&y.clearRect(0,0,r.domElement.width,r.domElement.height);for(let M=0,z=w.length;M<z;M++){const U=w[M],Q=S===U,ne=U.position.z>=-.01?U.color[0]:U.color[1],$=U.position.z>=-.01?U.color[1]:U.color[0];U.line&&x(u,U.position,U.line,ne),p(U.position,U.size,Q?$:ne),U.label&&(y.font=[n.fontWeight,n.fontSize,n.fontFamily].join(" "),y.fillStyle=n.fontColor,y.textBaseline="middle",y.textAlign="center",y.fillText(U.label,U.position.x,U.position.y))}}function B(v){const M=v.direction.clone().applyMatrix4(s),z=v.size;v.position.set(M.x*(u.x-z/2-n.padding)+u.x,u.y-M.y*(u.y-z/2-n.padding),M.z)}this.domElement=O(),this.update()}}const He=class He{constructor(e,n){const t=this;let i=e.offsetWidth,r=e.offsetHeight;const a=C();this.renderer=a,this.element=a.domElement;let o=i/r;const s=O(),c=20,g=F(c,o);this.activeCamera=s;let f=l();this.orbitControls=f;let L=D(f);this.sceneManager=n,this.bindEventListeners=function(){this.element.addEventListener("pointerdown",S),this.element.addEventListener("pointerup",y),this.element.addEventListener("pointermove",k),n.transformControl.addEventListener("objectChange",function(){t.element.removeEventListener("pointermove",h),n.objects.updateObjectsPosition(),n.objects.populateStorage()}),document.addEventListener("keydown",A)};const u=new V,w=new V;function S(I){u.x=I.clientX,u.y=I.clientY,I.button===0&&t.element.addEventListener("pointermove",h),t.element.removeEventListener("pointermove",k)}function h(){t.activeCamera.isOrthographicCamera&&t.setupCameraChangement()}function y(I){w.x=I.clientX,w.y=I.clientY;const b=t.sceneManager.transformControl;b&&u.distanceTo(w)===0&&b.detach(),t.element.removeEventListener("pointermove",h),t.element.addEventListener("pointermove",k)}function k(I){const b=t.sceneManager.transformControl;if(b){const _=new V(I.clientX/e.offsetWidth*2-1,-((I.clientY-document.getElementById("header").offsetHeight)/e.offsetHeight)*2+1),p=new Zt;p.setFromCamera(_,t.activeCamera);const x=t.sceneManager.objects.nodeMeshes.concat(t.sceneManager.objects.dummiesMeshes).concat(t.sceneManager.objects.lidarsMeshes),E=p.intersectObjects(x,!1);if(E.length>0){const B=E[0].object;if(B!==b.object)if(b.attach(B),t.activeCamera.isOrthographicCamera){let v=new P;t.activeCamera.getWorldDirection(v),b.showX=!(1-Math.abs(v.dot(new P(1,0,0)))<.001),b.showZ=!(1-Math.abs(v.dot(new P(0,0,1)))<.001||B.name==="Lidar"),b.showY=!(1-Math.abs(v.dot(new P(0,1,0)))<.001||B.name==="Dummy")}else b.showX=!0,b.showZ=B.name!=="Lidar",b.showY=B.name!=="Dummy"}}}function A(I){switch(I.keyCode){case 80:t.sceneManager.debug();break}}function C(){const I=document.createElement("div");e.insertBefore(I,e.firstChild);const b=new an({logarithmicDepthBuffer:!0,antialias:!0});return b.setPixelRatio(window.devicePixelRatio),b.setSize(i,r),I.appendChild(b.domElement),b.shadowMap.enabled=!0,b.shadowMap.type=rn,b.outputEncoding=cn,b.autoClear=!1,b}function O(){const I=new Yt(70,o,.2,1e4);return I.position.copy(He.DEFAULT_CAM_POSITION),I}function F(I,b){const _=new ln(-I,I,I/b,-I/b,.2,1e4);return _.position.set(0,0,10),_}function l(){const I=new xn(t.activeCamera,a.domElement);return I.damping=.2,I.enableRotate=!t.activeCamera.isOrthographicCamera,I.addEventListener("change",()=>t.render()),I}function D(I){const b=new Sn(I,{size:100,padding:8,fontColor:"#ffffff",colors:{x:["#bf4747","#662626"],y:["#708eb0","#405063"],z:["#37a48a","#1c5446"]}},t);return e.appendChild(b.domElement),b}this.placeCamera=function(I=He.DEFAULT_CAM_POSITION){const b=this.activeCamera.isPerspectiveCamera?I.clone().add(new P(this.sceneManager.sceneWidth,0,this.sceneManager.sceneLength)):I;this.activeCamera.position.set(b.x,b.y,b.z),this.activeCamera.lookAt(0,0,0)},this.setupCameraChangement=function(I=!0,b=He.DEFAULT_CAM_POSITION){const _=this.sceneManager.transformControl;I&&(this.activeCamera=this.activeCamera.isOrthographicCamera?s:g,_&&(_.camera=this.activeCamera)),_&&_.detach(),this.placeCamera(b),f.dispose(),f=l(),L.dispose(),L=D(f)},this.onWindowResize=function(){i=e.offsetWidth,r=e.offsetHeight,o=i/r,a.setSize(i,r),s.aspect=o,s.updateProjectionMatrix(),g.left=-c/2,g.right=c/2,g.top=c/(2*o),g.bottom=-c/(2*o),g.updateProjectionMatrix()},this.render=function(){this.sceneManager.update(a),a.clear(),a.setViewport(0,0,i,r),a.render(this.sceneManager.scene,this.activeCamera)}}};R(He,"DEFAULT_CAM_POSITION",new P(12,8,12));let ft=He;class Ft extends yn{constructor(){super()}set(e){this.notifyAllObservers(e)}update(e,n){this.notifyObserversExceptOrigin(e,n)}}const W=class W{static loadFont(e,n){const t=(window==null?void 0:window.designerPath)||"./";new Wt().load(t+"fonts/helvetiker_regular.typeface.json",function(i){W.font=i,n()})}constructor(e,n){const t=document.getElementById("viewport");this.viewportManager=new ft(t,this);const i=this.viewportManager;var r="";r=new URL(document.location.href).searchParams.get("sceneData"),r||(r=sessionStorage.getItem("sceneInfos"));let o=JSON.parse(r);this.scene=f(),this.currentUnit=W.DEFAULT_UNIT,this.trackingMode=W.DEFAULT_TRACKING_MODE,this.trackingMode,this.heightDetected=W.DEFAULT_DETECTION_HEIGHT,this.heightDetected,this.sceneWidth=W.DEFAULT_WIDTH,this.sceneLength=W.DEFAULT_LENGTH,this.sceneSensorHeight=ce.DEFAULT_NODE_HEIGHT,this.sceneElevation=0,this.sceneEnvironment=W.DEFAULT_ENV,this.size=160,this.wallX=u(this.size,-10,-10),this.wallY=w(this.size,-10,-10),this.floor=L(this.size,this.wallX.position.x,this.wallY.position.z);const s=new P(0,1,0),c=new P(1,0,0),g=new P(0,0,1);this.checkerboardFloor,this.checkerboardWallY,this.checkerboardWallX,this.transformControl=y(),this.objects=new Re(this,e),this.augmentaSceneLoaded=!1,this.initScene=function(l,D,I){const b=new dn(16777215,.5);this.scene.add(b),this.scene.add(l),this.scene.add(D),this.scene.add(I);const _=S();this.scene.add(_);const p=h();this.scene.add(p)},this.initAugmentaScene=function(){this.checkerboardFloor=new ct(this.floor,this.currentUnit,this.sceneElevation,this.sceneWidth,this.sceneLength),this.checkerboardFloor.addToScene(this.scene),this.checkerboardWallY=new ct(this.wallY,this.currentUnit,this.sceneElevation,this.sceneWidth,this.sceneLength),this.transformControl&&this.scene.add(this.transformControl),this.augmentaSceneLoaded=!0,console.log("Augmenta scene loaded"),this.objects.initObjects(),this.trackingModeObservable=new Ft,this.trackingModeObservable.addObserver(n.changeTrackingMode),this.trackingModeObservable.addObserver(n.popup.setTrackingMode);const l=this.changeTrackingMode.bind(this);this.trackingModeObservable.addObserver(l),this.heightDetectedObservable=new Ft,this.heightDetectedObservable.addObserver(n.changeHeightDetected),this.heightDetectedObservable.addObserver(n.popup.setHeightDetected);const D=this.changeHeightDetected.bind(this);this.heightDetectedObservable.addObserver(D),o?(o.trackingMode?this.trackingModeObservable.set(o.trackingMode):this.trackingModeObservable.set(W.DEFAULT_TRACKING_MODE),o.heightDetected?this.heightDetectedObservable.set(o.heightDetected):this.heightDetectedObservable.set(W.DEFAULT_DETECTION_HEIGHT)):(this.trackingModeObservable.set(W.DEFAULT_TRACKING_MODE),this.heightDetectedObservable.set(W.DEFAULT_DETECTION_HEIGHT))};function f(){const l=new hn;return l.background=new ke(2236962),l}function L(l,D,I){const b=new ye({side:De,color:5592405}),_=new fe(l+.02,l+.02),p=new T(_,b);return p.position.set(l/2+D,-.01,l/2+I),p.rotation.x=-Math.PI/2,p}function u(l,D,I){const b=new ye({color:13421772}),_=new fe(l+.02,l+.02),p=new T(_,b);return p.position.set(D,l/2,l/2+I),p.rotation.y=Math.PI/2,p}function w(l,D,I){const b=new ye({color:11184810}),_=new fe(l+.02,l+.02),p=new T(_,b);return p.position.set(l/2+I,l/2,D),p}function S(){const l=new un(1);return l.position.set(.01,.01,.01),l.setColors(new ke(12535623),new ke(7376560),new ke(3646602)),l}function h(){const l=new mn(2e3,2e3,4473924,4473924);return l.position.y=-.001,l}function y(){const l=new En(i.activeCamera,i.renderer.domElement);return l.addEventListener("change",()=>i.render()),l.addEventListener("dragging-changed",function(D){i.orbitControls.enabled=!D.value}),l}this.toggleUnit=function(l=this.currentUnit.value===Ve.meters.value?Ve.feets:Ve.meters){this.augmentaSceneLoaded&&(this.checkerboardFloor.toggleUnit(l),this.checkerboardWallY.toggleUnit(l)),document.querySelectorAll("[data-unit]").forEach(p=>{p.tagName==="INPUT"&&p.value?p.value=Math.round(p.value/this.currentUnit.value*l.value*100)/100:p.innerHTML=Math.round(p.innerHTML/this.currentUnit.value*l.value*100)/100,p.dataset.unit=l.value}),document.querySelectorAll("[data-unittext]").forEach(p=>{p.dataset.unittext=l.value,p.innerHTML=l.label});const b=document.getElementById("toggle-unit-button-"+this.currentUnit.label);b&&b.classList.remove("bold-font"),b&&b.classList.add("normal-font");const _=document.getElementById("toggle-unit-button-"+l.label);_&&_.classList.remove("normal-font"),_&&_.classList.add("bold-font"),this.currentUnit=l,this.objects.populateStorage()},this.updateFloorAugmentaSceneBorder=function(l,D){if(l&&D){const I=parseFloat(l)/this.currentUnit.value,b=parseFloat(D)/this.currentUnit.value;this.sceneWidth=I,this.sceneLength=b,this.augmentaSceneLoaded&&this.checkerboardFloor.setSize(I,b),this.objects.calculateScenePolygon(I,b),this.objects.populateStorage()}},this.updateWallYAugmentaSceneBorder=function(l,D){if(l&&D){const I=parseFloat(l)/this.currentUnit.value,b=parseFloat(D)/this.currentUnit.value;this.sceneWidth=I,this.sceneLength=b,this.augmentaSceneLoaded&&this.checkerboardWallY.setSize(I,b),this.objects.populateStorage()}},this.changeTrackingMode=function(l,D=!0){if(this.trackingMode=l,!D)return;switch(l){case"hand-tracking":this.sceneElevation=W.TABLE_ELEVATION,this.augmentaSceneLoaded&&(this.sceneWidth=this.checkerboardFloor.width,this.sceneLength=this.checkerboardFloor.height,I(this.scene,[this.checkerboardWallY],[this.checkerboardFloor],[this.sceneElevation])),this.wallY.position.z=-10;break;case"wall-tracking":this.sceneElevation=0,this.augmentaSceneLoaded&&(this.sceneWidth=this.checkerboardWallY.width,this.sceneLength=this.checkerboardWallY.height,console.log("Changing surface"),I(this.scene,[this.checkerboardFloor],[this.checkerboardWallY],[this.sceneElevation])),this.wallY.position.z=0;break;case"human-tracking":default:this.sceneElevation=0,this.augmentaSceneLoaded&&(this.sceneWidth=this.checkerboardFloor.width,this.sceneLength=this.checkerboardFloor.height,I(this.scene,[this.checkerboardWallY],[this.checkerboardFloor],[this.sceneElevation])),this.wallY.position.z=-10;break}this.objects.changeSensorsTrackingMode(l),this.objects.populateStorage();function I(b,_,p,x){p.length!==x.length&&console.error("Your sceneElevations array indicates elevations for the checkerboards of your to toAdd array. They must be the same size."),_.forEach(E=>E.removeFromScene(b));for(let E=0;E<p.length;E++)p[E].addToScene(b),p[E].setSceneElevation(x[E])}},this.changeHeightDetected=function(l){this.heightDetected=l,this.objects.populateStorage()},this.changeEnvironment=function(l=this.sceneEnvironment==="indoor"?"outdoor":"indoor"){this.sceneEnvironment=l,this.objects.populateStorage()},this.drawProjection=function(l){this.scene.remove(l.areaCoveredFloor),this.scene.remove(l.areaCoveredAbove),this.scene.remove(l.areaCoveredWallX),this.scene.remove(l.areaCoveredWallY);const D=new Ge(s,-this.sceneElevation),I=new Ge(s,-(this.sceneElevation+this.heightDetected)),b=new Ge(c,-this.wallX.position.x),_=new Ge(g,-this.wallY.position.z);if(l.areaAppear){const p=[],x=[],E=[],B=[],v=new St;v.setFromProjectionMatrix(l.cameraPerspective.projectionMatrix);for(let N=0;N<6;N++){const Ee=v.planes[N].applyMatrix4(l.cameraPerspective.matrixWorld),Le=xe(Ee,D);Le!==-1&&p.push(Le);const oe=xe(Ee,I);oe!==-1&&x.push(oe);const Y=xe(Ee,b);Y!==-1&&E.push(Y);const ue=xe(Ee,_);ue!==-1&&B.push(ue)}const M=xe(D,b),z=xe(b,_),U=xe(D,_);M!==-1&&(p.push(M),E.push(M)),z!==-1&&(E.push(z),B.push(z)),U!==-1&&(p.push(U),B.push(U));const Q=k(p),ne=k(x),$=k(E),_e=k(B),ee=new St;ee.setFromProjectionMatrix(l.cameraPerspective.projectionMatrix);for(let N=0;N<6;N++)ee.planes[N].applyMatrix4(l.cameraPerspective.matrixWorld),ee.planes[N].constant+=.01;const Ue=Q.filter(N=>ee.containsPoint(N)&&N.x>this.wallX.position.x-.01&&N.z>this.wallY.position.z-.01&&N.y>this.sceneElevation-.01),je=$.filter(N=>ee.containsPoint(N)&&N.x>this.wallX.position.x-.01&&N.z>this.wallY.position.z-.01&&N.y>this.sceneElevation-.01),ze=_e.filter(N=>ee.containsPoint(N)&&N.x>this.wallX.position.x-.01&&N.z>this.wallY.position.z-.01&&N.y>this.sceneElevation-.01);let se=ne.filter(N=>ee.containsPoint(N));if(se.forEach(N=>N.y-=this.heightDetected),Ue.length>2&&se.length>2){const N=[...x];N.forEach(Y=>Y.origin.y-=this.heightDetected);const Ee=p.concat(N),Le=k(Ee).filter(Y=>ee.containsPoint(Y)),oe=se.concat(Le);oe.sort((Y,ue)=>ue.length()-Y.length()),A(oe,s);for(let Y=0;Y<oe.length-1;Y++)oe[Y].distanceTo(oe[Y+1])<.01&&(oe.splice(Y,1),Y--);se=oe.filter(Y=>{const ue=Y.clone();return ue.y+=this.heightDetected,ee.containsPoint(Y)&&ee.containsPoint(ue)&&Y.x>this.wallX.position.x-.01&&Y.y>this.sceneElevation-.01&&Y.z>this.wallY.position.z-.01})}else se=[];A(Ue,s),A(se,s),A(je,c),A(ze,g),l.coveredPointsAbove=se,Ue.forEach(N=>N.y+=.01*(l.id/this.objects.getNbNodes()+1)),se.forEach(N=>N.y+=.01+.01*(l.id/this.objects.getNbNodes()+1)),je.forEach(N=>N.x+=.01*(l.id/this.objects.getNbNodes()+1)),ze.forEach(N=>N.z+=.01*(l.id/this.objects.getNbNodes()+1));const $e=l.areaValue;if(l.areaValue=C(se,this.currentUnit.value),se.length>2){const N=O(se);l.changeTextPosition(N,this.currentUnit.value),$e!=l.areaValue&&l.updateAreaText(this.currentUnit)}else l.changeTextPosition(l.cameraPerspective.position.clone(),this.currentUnit.value),l.nameText.scale.set(ce.SIZE_TEXT_NODE/1.7/l.nameText.geometry.parameters.options.size,ce.SIZE_TEXT_NODE/1.7/l.nameText.geometry.parameters.options.size,1),l.areaValueText.visible=!1;l.areaCoveredFloor.geometry.dispose(),l.areaCoveredFloor.material.dispose(),l.areaCoveredAbove.geometry.dispose(),l.areaCoveredAbove.material.dispose(),l.areaCoveredWallX.geometry.dispose(),l.areaCoveredWallX.material.dispose(),l.areaCoveredWallY.geometry.dispose(),l.areaCoveredWallY.material.dispose(),l.areaCoveredFloor=F(Ue,125269879),l.areaCoveredAbove=F(se),l.areaCoveredWallX=F(je),l.areaCoveredWallY=F(ze),this.scene.add(l.areaCoveredFloor),this.scene.add(l.areaCoveredAbove),this.scene.add(l.areaCoveredWallX),this.scene.add(l.areaCoveredWallY)}};function k(l){const D=[];for(let I=0;I<l.length-1;I++){const b=l[I];for(let _=I+1;_<l.length;_++){const p=l[_],x=Mn(b,p);x!=-1&&D.push(x)}}return D}function A(l,D){if(l.length>2){const I=O(l),b=new P;b.subVectors(l[0],I);const _=b.clone();_.applyAxisAngle(D,Math.PI/2),l.sort((p,x)=>{const E=new P;E.subVectors(p,I);const B=new P;B.subVectors(x,I);const v=Math.abs(_.dot(E))>.001?_.dot(E):1,M=Math.abs(_.dot(B))>.001?_.dot(B):1;return Math.abs(M)/M*b.angleTo(B)-Math.abs(v)/v*b.angleTo(E)})}}function C(l,D){let I=0;for(let b=1;b<l.length-1;b++){const _=new P().subVectors(l[b],l[0]),p=new P().subVectors(l[b+1],l[0]),x=.5*_.cross(p).length();I+=x}return I*(D*D)}function O(l){let D=new P;return l.length!==0&&(l.forEach(I=>D.add(I)),D.divideScalar(l.length)),D}function F(l,D=3680609){const I=new rt,b=[];for(let E=1;E<l.length-1;E++)b.push(l[E+1].x),b.push(l[E+1].y),b.push(l[E+1].z),b.push(l[E].x),b.push(l[E].y),b.push(l[E].z),b.push(l[0].x),b.push(l[0].y),b.push(l[0].z);const _=new Float32Array(b);I.setAttribute("position",new Xt(_,3));const p=new Ae({side:De,color:D,transparent:!0,opacity:.6,alphaTest:.5});return new T(I,p)}this.update=function(){this.objects.update()},this.initScene(this.floor,this.wallX,this.wallY),this.debug=function(){this.objects.debug()}}};R(W,"font"),R(W,"DEFAULT_UNIT",Ve.meters),R(W,"DEFAULT_TRACKING_MODE","human-tracking"),R(W,"DEFAULT_DETECTION_HEIGHT",1.2),R(W,"DEFAULT_WIDTH",5),R(W,"DEFAULT_LENGTH",5),R(W,"DEFAULT_ENV","indoor"),R(W,"TABLE_ELEVATION",.75),R(W,"HAND_TRACKING_OVERLAP_HEIGHT",.25);let G=W;function xe(m,e){if(m.normal.length()<.001||e.normal.length()<.001)return console.error("invalid parameters : one of the plane's normal is zero Vector"),-1;const n=m.normal.x,t=m.normal.y,i=m.normal.z,r=m.constant,a=e.normal.x,o=e.normal.y,s=e.normal.z,c=e.constant,g=new P().crossVectors(m.normal,e.normal);if(g.length()<.001)return-1;if(Math.abs(n)>.001)return Math.abs(n*o-a*t)>.001?f("abc"):Math.abs(n*s-a*i)>.001?f("acb"):(console.error("There is a mathematical incoherence in the code"),-1);return Math.abs(t)>.001?Math.abs(t*s-o*i)>.001?f("bca"):Math.abs(t*a-o*n)>.001?f("bac"):(console.error("There is a mathematical incoherence in the code"),-1):Math.abs(i)>.001?Math.abs(i*a-s*n)>.001?f("cab"):Math.abs(i*o-s*t)>.001?f("cba"):(console.error("There is a mathematical incoherence in the code"),-1):(console.error("invalid parameters : one of the plane's normal is zero vector"),-1);function f(u){switch(u){case"abc":{const w=L(n,a,t,o,i,s,u);return new Ne(w,g.normalize())}case"acb":{const w=L(n,a,i,s,t,o,u);return new Ne(w,g.normalize())}case"bca":{const w=L(t,o,i,s,n,a,u);return new Ne(w,g.normalize())}case"bac":{const w=L(t,o,n,a,i,s,u);return new Ne(w,g.normalize())}case"cab":{const w=L(i,s,n,a,t,o,u);return new Ne(w,g.normalize())}case"cba":{const w=L(i,s,t,o,n,a,u);return new Ne(w,g.normalize())}default:return console.error("getInteresectionRay: the 'mode' argument is not valid"),-1}}function L(u,w,S,h,y,k,A,C=0){const O=C,F=((w*y-u*k)*O+(w*r-u*c))/(u*h-w*S),l=(-S*F-y*O-r)/u;switch(A){case"abc":return new P(l,F,O);case"acb":return new P(l,O,F);case"bca":return new P(O,l,F);case"bac":return new P(F,l,O);case"cab":return new P(F,O,l);case"cba":return new P(O,F,l);default:return console.error("calculatePointsOnIntersectionRayCoordinates: the 'mode' argument is not valid"),-1}}}function Mn(m,e){const n=m.origin,t=m.direction,i=e.origin,r=e.direction;if(new P().crossVectors(t,r).length()<.001)return-1;const o=new Ge().setFromCoplanarPoints(n,new P().addVectors(n,t),new P().addVectors(i,r));if(Math.abs(o.distanceToPoint(i))>.001)return-1;const s=new P;if(Math.abs(r.x)>.001)if(Math.abs(r.x*t.y-r.y*t.x)>.001){const c=1/(r.x*t.y-r.y*t.x)*(r.y*(n.x-i.x)+r.x*(i.y-n.y));return m.at(c,s),s}else if(Math.abs(r.x*t.z-r.z*t.x)>.001){const c=1/(r.x*t.z-r.z*t.x)*(r.z*(n.x-i.x)+r.x*(i.z-n.z));return m.at(c,s),s}else return console.error("There is a mathematical incoherence in the code"),-1;else if(r.y!=0)if(Math.abs(r.y*t.z-r.z*t.y)>.001){const c=1/(r.y*t.z-r.z*t.y)*(r.z*(n.y-i.y)+r.y*(i.z-n.z));return m.at(c,s),s}else if(Math.abs(r.y*t.x-r.x*t.y)>.001){const c=1/(r.y*t.x-r.x*t.y)*(r.x*(n.y-i.y)+r.y*(i.x-n.x));return m.at(c,s),s}else return console.error("There is a mathematical incoherence in the code"),-1;else if(r.z!=0)if(Math.abs(r.z*t.x-r.x*t.z)>.001){const c=1/(r.z*t.x-r.x*t.z)*(r.x*(n.z-i.z)+r.z*(i.x-n.x));return m.at(c,s),s}else if(Math.abs(r.z*t.y-r.y*t.z)>.001){const c=1/(r.z*t.y-r.y*t.z)*(r.y*(n.z-i.z)+r.z*(i.y-n.y));return m.at(c,s),s}else return console.error("There is a mathematical incoherence in the code"),-1;else return console.error("invalid parameters : one of the rays direction is zero vector"),-1}function Ct(m,e,n,t){return m<=n&&m>=e+t}function Nt(m,e,n){const t=ie.DEFAULT_RATIO_FAR_MINDIST*ie.DEFAULT_RATIO_FAR_MINDIST;return e<=Math.sqrt(1-1/(4*t))*n||m<=2*n*Math.abs(Math.sin(ie.DEFAULT_MIN_ANGLE_TO_AVOID_OBSTRUCTION))}function Ht(m,e){if(m.length>0){const n=[...m];return e==="hand-tracking"?(n.sort((t,i)=>i.handFar-t.handFar),n[0].handFar):(n.sort((t,i)=>i.rangeFar-t.rangeFar),n[0].rangeFar)}return 0}function Bn(m){if(m.length>0){const e=[...m];return e.sort((n,t)=>n.rangeNear-t.rangeNear),e[0].rangeNear}return 0}function kn(m,e,n){const t=ie.DEFAULT_RATIO_FAR_MINDIST*ie.DEFAULT_RATIO_FAR_MINDIST;if(n<=Math.sqrt(1-1/(4*t))*m.rangeFar){const i=2*Math.sqrt(m.rangeFar*m.rangeFar-n*n),r=Math.ceil(e/i),a=[],o=Math.max(e/r,m.rangeFar/ie.DEFAULT_RATIO_FAR_MINDIST),s=(e-o*(r-1))/2;for(let c=0;c<r;c++)a.push(new V(s+c*o,n));return{typeID:m.id,positions:a}}else if(e<=2*m.rangeFar*Math.abs(Math.sin(ie.DEFAULT_MIN_ANGLE_TO_AVOID_OBSTRUCTION))){const i=ie.DEFAULT_MIN_ANGLE_TO_AVOID_OBSTRUCTION;if(Math.abs(i%Math.PI)<.001)return{typeID:m.id,positions:[new V(0,1),new V(e,1)]};if(Math.abs(i%(Math.PI/2))>.001){const r=Math.sqrt(m.rangeFar*m.rangeFar-e/2*(e/2)),a=ie.DEFAULT_MIN_ANGLE_TO_AVOID_OBSTRUCTION%Math.PI/2!==0?e/(2*Math.tan(ie.DEFAULT_MIN_ANGLE_TO_AVOID_OBSTRUCTION)):0,o=(r+a)/2;return{typeID:m.id,positions:[new V(0,o),new V(e,o)]}}}return!1}function An(m,e,n,t,i,r){let a=0;switch(m){case"hand-tracking":a=e.handFar;break;case"human-tracking":default:a=e.rangeFar;break}if(i<=a&&i>=e.rangeNear+r){const o=Math.abs(Math.tan(e.HFov/2*Math.PI/180))*(i-r)*2,s=Math.abs(Math.tan(e.VFov/2*Math.PI/180))*(i-r)*2,c=Math.ceil(n/o)*Math.ceil(t/s);return Math.ceil(n/s)*Math.ceil(t/o)<c?{typeID:e.id,w:s,h:o,nbW:Math.ceil(n/s),nbH:Math.ceil(t/o),rot:!0}:{typeID:e.id,w:o,h:s,nbW:Math.ceil(n/o),nbH:Math.ceil(t/s),rot:!1}}return!1}function Dn(m,e,n,t,i,r){let a=m.w/2,o=m.h/2;m.nbW===1&&(a-=(m.nbW*m.w-n)/2),m.nbH===1&&(o-=(m.nbH*m.h-t)/2);const s=m.nbW>1?(m.nbW*m.w-n)/(m.nbW-1):0,c=m.nbH>1?(m.nbH*m.h-t)/(m.nbH-1):0;for(let g=0;g<m.nbW;g++)for(let f=0;f<m.nbH;f++)m.rot?r.objects.addNode(!0,e,m.typeID,a+g*(m.w-s),o+f*(m.h-c),i,0,0,Math.PI/2):r.objects.addNode(!0,e,m.typeID,a+g*(m.w-s),o+f*(m.h-c),i)}function _n(m,e){for(let n=0;n<m.positions.length;n++)e.objects.addLidar(!0,m.typeID,m.positions[n].x,m.positions[n].y)}class Un{constructor(e){this.trackingMode="human-tracking";let n=this.trackingMode;this.heightDetected=1.2;let t=this.heightDetected;this.givenWidth=0;let i=this.givenWidth;this.givenLength=0;let r=this.givenLength;this.givenHeight=0;let a=this.givenHeight;this.sensorsCompatible=[];let o=this.sensorsCompatible;this.usedSensor=void 0;let s=this.usedSensor;window.addEventListener("resize",c);function c(){document.getElementById("popup").classList.add("column"),document.getElementById("tracking-mode-selection-builder").classList.add("row"),document.getElementById("hardware-sensors-selection").classList.add("row"),document.getElementById("my-system-section-builder").classList.add("row")}c(),g();function g(){const p=sessionStorage.getItem("builderStep");if(p){if(f(),document.getElementById("popup").classList.remove("is-visible"),p<=0)return;if(h(),p<=1){document.getElementById("setup-content").classList.add("hidden"),document.getElementById("dimensions-content").classList.remove("hidden"),document.getElementById("dimensions-tab").classList.add("passed-tab");return}else y(),A(),D();if(p<=2){document.getElementById("setup-content").classList.add("hidden"),document.getElementById("hardware-content").classList.remove("hidden"),document.getElementById("dimensions-tab").classList.add("passed-tab"),document.getElementById("hardware-tab").classList.add("passed-tab");return}else I(),_();if(p<=3){document.getElementById("setup-content").classList.add("hidden"),document.getElementById("my-system-content").classList.remove("hidden"),document.getElementById("dimensions-tab").classList.add("passed-tab"),document.getElementById("hardware-tab").classList.add("passed-tab"),document.getElementById("my-system-tab").classList.add("passed-tab");return}}else sessionStorage.setItem("builderStep",0)}this.setTrackingMode=function(p){switch(n=p,n){case"wall-tracking":document.getElementById("setup-target-overlap-wall").classList.remove("hidden"),document.getElementById("setup-target-overlap-table").classList.add("hidden"),document.getElementById("setup-target-overlap").classList.add("hidden");break;case"hand-tracking":document.getElementById("setup-target-overlap-table").classList.remove("hidden"),document.getElementById("setup-target-overlap").classList.add("hidden"),document.getElementById("setup-target-overlap-wall").classList.add("hidden"),e.heightDetectedObservable.set(.25);break;case"human-tracking":document.getElementById("setup-target-overlap").classList.remove("hidden"),document.getElementById("setup-target-overlap-wall").classList.add("hidden"),document.getElementById("setup-target-overlap-table").classList.add("hidden");break}},this.setHeightDetected=function(p){t=p,n=="human-tracking"&&(document.getElementById("overlap-height-selection-popup").value=t)};function f(){const p=sessionStorage.getItem("sceneInfos");p&&(n=JSON.parse(p).trackingMode);const x=document.getElementsByName("tracking-mode-selection-builder");for(let E=0;E<x.length;E++)x[E].checked=x[E].value===(n||"human-tracking")}const L=document.getElementsByName("tracking-mode-selection-builder");for(let p=0;p<L.length;p++)L[p].addEventListener("click",()=>{L[p].value,e.trackingModeObservable.set(L[p].value),S()});document.getElementById("overlap-height-selection-popup").addEventListener("change",()=>{e.heightDetectedObservable.set(parseFloat(document.getElementById("overlap-height-selection-popup").value))}),document.getElementById("next-button-setup").addEventListener("click",()=>{const p=document.getElementsByName("tracking-mode-selection-builder");for(let E=0;E<p.length;E++)if(p[E].checked){n=p[E].value;break}if(!n){document.getElementById("setup-warning-message").classList.remove("hidden");return}["human-tracking","hand-tracking","wall-tracking"].includes(n)&&(h(),document.getElementById("setup-content").classList.add("hidden"),document.getElementById("dimensions-content").classList.remove("hidden"),document.getElementById("dimensions-tab").classList.add("passed-tab"),sessionStorage.setItem("builderStep",1))}),document.getElementById("dimensions-need-something-different-button").addEventListener("click",()=>{});function u(){i=void 0,r=void 0,a=void 0,document.getElementById("dimensions-length").classList.remove("hidden"),document.getElementById("dimensions-distance-text-default").classList.remove("hidden"),document.getElementById("dimensions-distance-text-hand-tracking").classList.add("hidden"),document.getElementById("dimensions-distance-text-wall-tracking").classList.add("hidden"),document.getElementById("dimensions-distance-input").placeholder="Sensor height",document.getElementById("dimensions-warning-message").classList.add("hidden")}document.getElementById("dimensions-width-input").addEventListener("change",w),document.getElementById("dimensions-length-input").addEventListener("change",w),document.getElementById("dimensions-distance-input").addEventListener("change",w),document.getElementById("sensor-height-infos").addEventListener("mouseover",p=>{const x=document.getElementById("sensor-height-infos-text");x.style.left=(p.clientX-180).toString()+"px",x.style.top=(p.clientY-130).toString()+"px",x.classList.remove("hidden")}),document.getElementById("sensor-height-infos").addEventListener("mouseleave",()=>document.getElementById("sensor-height-infos-text").classList.add("hidden"));function w(){const p=parseFloat(document.getElementById("dimensions-width-input").value),x=parseFloat(document.getElementById("dimensions-length-input").value),E=parseFloat(document.getElementById("dimensions-distance-input").value),B=Math.floor(parseFloat(p)/e.currentUnit.value*100)/100;Math.floor(parseFloat(x)/e.currentUnit.value*100)/100;const v=Math.floor(parseFloat(E)/e.currentUnit.value*100)/100;if(n==="wall-tracking"&&p&&E){if(p>0&&E>0)return document.getElementById("dimensions-negative-values-warning").classList.add("hidden"),Nt(B,v,Ht(Ie().filter(M=>M.recommended),n))?(e.updateWallYAugmentaSceneBorder(p,E),document.getElementById("input-wall-y-scene-width-inspector").value=p,document.getElementById("input-wall-y-scene-height-inspector").value=E,document.getElementById("dimensions-warning-message").classList.add("hidden"),document.getElementById("scene-size-text-div").innerHTML='<h3 id="scene-size-text">Scene size: <span data-unit=1>'+p+"</span>x<span data-unit=1>"+E+'</span><span data-unittext="1">m</span></h3>',!0):(S(),document.getElementById("dimensions-warning-message").classList.remove("hidden"),!1);S(),document.getElementById("dimensions-negative-values-warning").classList.remove("hidden")}else if(p&&x&&(p>0&&x>0?(document.getElementById("dimensions-negative-values-warning").classList.add("hidden"),e.updateFloorAugmentaSceneBorder(p,x),document.getElementById("input-scene-width-inspector").value=p,document.getElementById("input-scene-length-inspector").value=x):(S(),document.getElementById("dimensions-negative-values-warning").classList.remove("hidden")),v>0)){const M=we().filter(ne=>ne.recommended),z=n==="human-tracking"?G.DEFAULT_DETECTION_HEIGHT:G.HAND_TRACKING_OVERLAP_HEIGHT,U=Ht(M,n),Q=Bn(M);if(Ct(v,z,U,Q))return document.getElementById("warning-hook-height")&&document.getElementById("surface-warning-message").classList.add("hidden"),document.getElementById("input-scene-sensor-height-inspector").value=E,document.getElementById("scene-size-text-div").innerHTML='<h3 id="scene-size-text">Scene size: <span data-unit=1>'+p+"</span>x<span data-unit=1>"+x+'</span><span data-unittext="1">m</span> with a sensor height of <span data-unit="1">'+E+'</span><span data-unittext="1">m</span></h3>',!0;if(!document.getElementById("warning-hook-height")){const $=document.createElement("p");$.classList.add("warning-text"),$.id="warning-hook-height",$.innerHTML="The camera(s) you chose cannot see your tracking surface at this distance (min = <span data-unit="+e.currentUnit.value+">"+Math.round((Q+z)*e.currentUnit.value*100)/100+"</span> <span data-unittext="+e.currentUnit.label+">"+e.currentUnit.label+"</span>, max = <span data-unit="+e.currentUnit.value+">"+Math.round(U*e.currentUnit.value*100)/100+"</span> <span data-unittext="+e.currentUnit.label+">"+e.currentUnit.label+"</span>)",document.getElementById("surface-warning-message").appendChild($)}return S(),document.getElementById("surface-warning-message").classList.remove("hidden"),!1}return!1}function S(){document.getElementById("dimensions-negative-values-warning").classList.add("hidden"),document.getElementById("dimensions-warning-message").classList.add("hidden"),document.getElementById("surface-warning-message").classList.add("hidden"),document.getElementById("dimensions-no-value-warning").classList.add("hidden")}function h(){if(n==="hand-tracking"&&(document.getElementById("dimensions-distance-text-default").classList.add("hidden"),document.getElementById("dimensions-distance-text-hand-tracking").classList.remove("hidden")),n==="wall-tracking"&&(document.getElementById("dimensions-length").classList.add("hidden"),document.getElementById("dimensions-distance-text-default").classList.add("hidden"),document.getElementById("dimensions-distance-text-wall-tracking").classList.remove("hidden"),document.getElementById("dimensions-distance-input").placeholder="Height"),n){const p=sessionStorage.getItem("sceneInfos");if(p){const x=JSON.parse(p).sceneSize;switch(n){case"wall-tracking":document.getElementById("dimensions-width-input").value=Math.floor(x[0]*e.currentUnit.value*100)/100,document.getElementById("dimensions-distance-input").value=Math.floor(x[1]*e.currentUnit.value*100)/100;break;case"hand-tracking":case"human-tracking":document.getElementById("dimensions-width-input").value=Math.floor(x[0]*e.currentUnit.value*100)/100,document.getElementById("dimensions-length-input").value=Math.floor(x[1]*e.currentUnit.value*100)/100;const E=JSON.parse(p).objects.nodes;E.length>0?document.getElementById("dimensions-distance-input").value=Math.floor((E[0].p_z-(n==="hand-tracking"?2.5:0))*e.currentUnit.value*100)/100:document.getElementById("dimensions-distance-input").value="";break}}}}function y(){i=Math.floor(parseFloat(document.getElementById("dimensions-width-input").value)/e.currentUnit.value*100)/100,r=Math.floor(parseFloat(document.getElementById("dimensions-length-input").value)/e.currentUnit.value*100)/100,a=Math.floor(parseFloat(document.getElementById("dimensions-distance-input").value)/e.currentUnit.value*100)/100}document.getElementById("next-button-dimensions").addEventListener("click",()=>{S(),document.getElementById("dimensions-no-value-warning").classList.remove("hidden"),w()&&(y(),!(n!=="wall-tracking"&&(!i||!r||!a)||n==="wall-tracking"&&(!i||!a))&&(n!=="wall-tracking"&&(i<=0||r<=0||a<=0)||n==="wall-tracking"&&(i<=0||a<=0)||(S(),A(),l(),document.getElementById("dimensions-content").classList.add("hidden"),document.getElementById("hardware-content").classList.remove("hidden"),document.getElementById("hardware-tab").classList.add("passed-tab"),sessionStorage.setItem("builderStep",2))))}),document.getElementById("previous-button-dimensions").addEventListener("click",()=>{u(),document.getElementById("dimensions-content").classList.add("hidden"),document.getElementById("setup-content").classList.remove("hidden"),document.getElementById("dimensions-tab").classList.remove("passed-tab"),sessionStorage.setItem("builderStep",0)}),document.getElementById("hardware-need-something-different-button").addEventListener("click",()=>{}),document.getElementById("toggle-outdoor-indoor").addEventListener("change",()=>{let p=document.getElementById("toggle-outdoor-indoor").checked,x;p?x="OUTDOOR":x="INDOOR",document.getElementById("button-toggle-text").innerHTML=x});function k(){s=void 0,o.length=0,Ze(document.getElementById("hardware-sensors-selection")),Ze(document.getElementById("multi-select-sensors")),document.getElementById("hardware-input-radio-indoor").checked=!0,document.getElementById("hardware-input-radio-outdoor").checked=!1,document.getElementById("hardware-warning-message").classList.add("hidden")}function A(){if(n==="wall-tracking"?Ie().filter(B=>B.recommended).forEach(B=>{Nt(i,a,B.rangeFar)&&o.push(B)}):we().filter(B=>B.recommended).forEach(B=>{const v=n==="human-tracking"?t:G.HAND_TRACKING_OVERLAP_HEIGHT;Ct(a,v,n==="hand-tracking"?B.handFar:B.rangeFar,B.rangeNear)&&o.push(B)}),o.length===0)return;const p=document.getElementById("multi-select-sensors");o.forEach(B=>{const v=document.createElement("option");v.id=B.textId,v.value=B.textId;const M=Math.floor(B.rangeNear*e.currentUnit.value*100)/100,z=Math.floor((n==="hand-tracking"?B.handFar:B.rangeFar)*e.currentUnit.value*100)/100;v.innerHTML="<p>"+B.niceName+" (<span data-unit="+e.currentUnit.value+">"+M+"</span> - <span data-unit="+e.currentUnit.value+">"+z+"</span><span data-unittext="+e.currentUnit.value+">"+e.currentUnit.label+"</span>)</p>",p.appendChild(v)}),C(p.children);const x=sessionStorage.getItem("sceneInfos");let E;x?E=JSON.parse(x).sceneEnvironment:(document.getElementById("toggle-outdoor-indoor").checked?E="outdoor":E="indoor",F(E))}function C(p){const x=document.getElementById("toggle-outdoor-indoor");x.addEventListener("change",()=>{let E;x.checked?E="outdoor":E="indoor",F(E),e.changeEnvironment(E)}),document.getElementById("multi-select-sensors").addEventListener("change",()=>{O()})}function O(){const p=document.getElementById("multi-select-sensors").value;switch(n){case"wall-tracking":{const x=Ie().find(B=>B.textId===p),E=kn(x,i,a);if(!E){console.error("no config found with this setup");return}e.objects.removeSensors(),_n(E,e);break}case"human-tracking":case"hand-tracking":{const x=we().find(v=>v.textId===p),E=n==="human-tracking"?t:G.HAND_TRACKING_OVERLAP_HEIGHT,B=An(n,x,i,r,a,E);if(!B){console.error("no config found with this setup");return}e.objects.removeSensors(),Dn(B,n,i,r,a+e.sceneElevation,e);break}}}function F(p){let x=0;o.forEach(E=>{E.canBeUsed.includes(p)?document.getElementById(E.textId).classList.remove("hidden"):(document.getElementById(E.textId).classList.add("hidden"),x++)}),o.length===x?document.getElementById("hardware-warning-message").classList.remove("hidden"):(document.getElementById("hardware-warning-message").classList.add("hidden"),l())}function l(){const p=document.getElementById("multi-select-sensors");p.children[0]&&(p.value=p.children[0].value,O())}function D(){const p=sessionStorage.getItem("sceneInfos");if(p){const x=JSON.parse(p).objects;if(x.lidars.length>0||x.nodes.length>0){let E;switch(n){case"wall-tracking":const v=x.lidars.length>0?x.lidars[0].lidarTypeId:0;E=Ie().find(z=>z.id===v).textId;break;case"hand-tracking":case"human-tracking":const M=x.nodes.length>0?x.nodes[0].cameraTypeId:0;E=we().find(z=>z.id===M).textId;break}const B=document.getElementById("hardware-sensors-selection").children;for(let v=0;v<B.length;v++)if(!B[v].classList.contains("unselectable")&&B[v].querySelector("input").value===E){e.augmentaSceneLoaded&&B[v].dispatchEvent(new Event("click")),B[v].querySelector("input").checked=!0;break}}else l()}}function I(){const p=document.getElementsByName("sensor-choice");for(let x=0;x<p.length;x++)p[x].checked&&(s=we().concat(Ie()).find(E=>E.textId===p[x].value))}document.getElementById("next-button-hardware").addEventListener("click",()=>{document.getElementById("popup").classList.remove("is-visible")}),document.getElementById("previous-button-hardware").addEventListener("click",()=>{e.objects.removeSensors(),k(),document.getElementById("hardware-content").classList.add("hidden"),document.getElementById("dimensions-content").classList.remove("hidden"),document.getElementById("hardware-tab").classList.remove("passed-tab"),sessionStorage.setItem("builderStep",1)});function b(){Ze(document.getElementById("my-system-tracking-mode")),Ze(document.getElementById("my-system-dimensions")),Ze(document.getElementById("my-system-recap"))}function _(){const p=document.getElementById("tracking-mode-"+n+"-input").cloneNode(!0);p.id+="-copy",p.children[0].checked=!1,p.children[0].disabled=!0,document.getElementById("my-system-tracking-mode").appendChild(p);const x=document.getElementById("dimensions-inputs").cloneNode(!0);x.id+="copy",x.classList.remove("row"),x.classList.add("column");const E=x.getElementsByTagName("input");for(let U=0;U<E.length;U++)E[U].readOnly=!0;document.getElementById("my-system-dimensions").appendChild(x);const B=document.getElementById("my-system-recap");let v;const M=sessionStorage.getItem("sceneInfos");if(M){const U=JSON.parse(M).objects;switch(n){case"wall-tracking":v=U.lidars.length;break;case"hand-tracking":case"human-tracking":v=U.nodes.length;break}}else v=e.objects.getNbSensors();const z=document.createElement("p");z.innerHTML="x"+v+" "+s.niceName,B.appendChild(z),s.accessories.forEach(U=>{const Q=document.createElement("p");Q.innerHTML="x"+v+" "+U,B.appendChild(Q)})}document.getElementById("previous-button-my-system").addEventListener("click",()=>{b(),document.getElementById("my-system-content").classList.add("hidden"),document.getElementById("hardware-content").classList.remove("hidden"),document.getElementById("my-system-tab").classList.remove("passed-tab"),sessionStorage.setItem("builderStep",2)}),document.getElementById("finish-button-my-system").addEventListener("click",()=>{document.getElementById("popup").classList.remove("is-visible")}),document.getElementById("close-popup").addEventListener("click",()=>{document.getElementById("popup").classList.remove("is-visible")})}}function Ze(m){for(;m.firstChild;)m.removeChild(m.firstChild)}class zn{constructor(){this.popup=null;var e;n(),this.bindEventListeners=function(s){this.popup=new Un(s.sceneManager);const c=document.getElementById("toggle-unit-button");c&&c.addEventListener("click",()=>s.sceneManager.toggleUnit());const g=document.getElementById("display-frustums-button");g&&g.addEventListener("click",()=>s.sceneManager.objects.displayFrustums());const f=document.getElementById("display-lidars-rays-button");f&&f.addEventListener("click",()=>s.sceneManager.objects.displayRays());const L=document.getElementById("add-node-button");L&&L.addEventListener("click",()=>s.sceneManager.objects.addNode());const u=document.getElementById("delete-all-nodes-button");u&&u.addEventListener("click",()=>s.sceneManager.objects.removeNodes());const w=document.getElementById("add-lidar-button");w&&w.addEventListener("click",()=>s.sceneManager.objects.addLidar());const S=document.getElementById("delete-all-lidars-button");S&&S.addEventListener("click",()=>s.sceneManager.objects.removeLidars());const h=document.getElementById("add-dummy-button");h&&h.addEventListener("click",()=>s.sceneManager.objects.addDummy());const y=document.getElementById("delete-all-dummies-button");y&&y.addEventListener("click",()=>s.sceneManager.objects.removeDummies()),e=s.sceneManager;const k=document.getElementById("share-modal");document.getElementById("generate-link").addEventListener("click",()=>{t(e.objects.generateLink())}),document.getElementById("copy-scene-link").addEventListener("click",()=>{t(e.objects.generateLink())}),document.getElementById("close-share-modal").addEventListener("click",()=>k.classList.add("hidden")),window.addEventListener("click",()=>{event.target==k&&k.classList.add("hidden")}),document.getElementById("load-file-input").addEventListener("change",A=>r(A,e),!1),document.getElementById("download-scene-file").addEventListener("click",()=>i(s.sceneManager)),document.getElementById("input-scene-width-inspector").addEventListener("change",()=>e.updateAugmentaSceneBorder(parseFloat(document.getElementById("input-scene-width-inspector").value),parseFloat(document.getElementById("input-scene-length-inspector").value))),document.getElementById("input-scene-length-inspector").addEventListener("change",()=>e.updateAugmentaSceneBorder(parseFloat(document.getElementById("input-scene-width-inspector").value),parseFloat(document.getElementById("input-scene-length-inspector").value))),document.getElementById("input-wall-y-scene-width-inspector").addEventListener("change",()=>e.updateWallYAugmentaSceneBorder(parseFloat(document.getElementById("input-wall-y-scene-width-inspector").value),parseFloat(document.getElementById("input-wall-y-scene-height-inspector").value))),document.getElementById("input-wall-y-scene-height-inspector").addEventListener("change",()=>e.updateWallYAugmentaSceneBorder(parseFloat(document.getElementById("input-wall-y-scene-width-inspector").value),parseFloat(document.getElementById("input-wall-y-scene-height-inspector").value))),document.getElementById("open-wizard-button").addEventListener("click",()=>{e.augmentaSceneLoaded&&document.getElementById("popup").classList.add("is-visible")})};function n(){document.getElementById("scene-file-name-input").value="",document.getElementById("overlap-height-selection-inspector").value=G.DEFAULT_DETECTION_HEIGHT,document.getElementById("input-scene-width-inspector").value=G.DEFAULT_WIDTH,document.getElementById("input-scene-length-inspector").value=G.DEFAULT_LENGTH,document.getElementById("input-wall-y-scene-width-inspector").value=G.DEFAULT_WIDTH,document.getElementById("input-wall-y-scene-height-inspector").value=G.DEFAULT_LENGTH,document.getElementById("input-scene-sensor-height-inspector").value=ce.DEFAULT_NODE_HEIGHT,document.getElementById("scene-size-text-div").innerHTML='<h3 id="scene-size-text">Scene size: <span data-unit=1>'+G.DEFAULT_WIDTH+"</span>x<span data-unit=1>"+G.DEFAULT_LENGTH+'</span><span data-unittext="1">m</span> with a sensor height of <span data-unit="1">'+ce.DEFAULT_NODE_HEIGHT+'</span><span data-unittext="1">m</span></h3>'}function t(s){navigator.clipboard.writeText(s),document.getElementById("share-modal").classList.remove("hidden")}function i(s){const c=document.getElementById("scene-file-name-input");if(console.log("downloading..."),c&&c.value){console.log("file name ok");const g=["*",".",'"',"/","\\","[","]",":",";","|",",","?","<",">"],f=c.value.toString();for(let w=0;w<g.length;w++){const S=g[w];if(f.includes(S)){document.getElementById("warning-text-input-illegal-symbol").classList.remove("hidden"),document.getElementById("illegal-symbol-used").innerHTML=S;return}}console.log("file name ok ok");const L=s.objects.generateJson(),u=new Blob([L],{type:"application/json"});saveAs(u,f+".builder"),document.getElementById("warning-text-input-illegal-symbol").classList.add("hidden")}}function r(s,c){const g=s.target.files[0];if(!g)return;if(console.log(g),g.type!=="application/json"&&g.name.split(".")[1]!="builder"){alert('Invalid file. Your file must end with ".json"');return}const f=new FileReader;f.onload=function(L){const u=L.target.result;c.objects.removeSensors(),c.objects.parseJson(u)},f.readAsText(g)}this.changeTrackingMode=function(s){switch(document.getElementById("tracking-img").src="img/"+String(s)+".png",s){case"hand-tracking":document.getElementById("coverage-section").classList.remove("hidden"),document.getElementById("height-detection-text").classList.add("hidden"),document.getElementById("scene-size-text-div").innerHTML='<h3 id="scene-size-text">Scene size: <span data-unit=1>'+e.sceneWidth+"</span>x<span data-unit=1>"+e.sceneWidth+'</span><span data-unittext="1">m</span> with a sensor height of <span data-unit="1">'+e.sceneSensorHeight+'</span><span data-unittext="1">m</span></h3>';break;case"wall-tracking":document.getElementById("coverage-section").classList.add("hidden"),document.getElementById("height-detection-text").classList.add("hidden"),document.getElementById("scene-size-text-div").innerHTML='<h3 id="scene-size-text">Scene size: <span data-unit=1>'+e.sceneWidth+"</span>x<span data-unit=1>"+e.sceneLength+'</span><span data-unittext="1">m</span></h3>';break;case"human-tracking":document.getElementById("coverage-section").classList.remove("hidden"),document.getElementById("height-detection-text").classList.remove("hidden"),document.getElementById("scene-size-text-div").innerHTML='<h3 id="scene-size-text">Scene size: <span data-unit=1>'+e.sceneWidth+"</span>x<span data-unit=1>"+e.sceneWidth+'</span><span data-unittext="1">m</span> with a sensor height of <span data-unit="1">'+e.sceneSensorHeight+'</span><span data-unittext="1">m</span></h3>';break}switch(document.getElementById("tracking-mode-selection-inspector").value=s,s){case"hand-tracking":document.getElementById("overlap-height-inspector").classList.add("hidden"),document.getElementById("floor-scene-size-inspector").classList.remove("hidden"),document.getElementById("floor-scene-size-title-inspector").innerHTML="Table scene size",document.getElementById("wall-y-scene-size-inspector").classList.add("hidden"),document.getElementById("nodes-buttons").classList.remove("hidden"),document.getElementById("lidars-buttons").classList.add("hidden");const c=document.getElementById("info-table-height-inspector");c.innerHTML="<h3>The table is <span data-unit=1>"+G.TABLE_ELEVATION+"</span><span data-unittext=1>m</span> high</h3>",c.classList.remove("hidden");break;case"wall-tracking":document.getElementById("overlap-height-inspector").classList.add("hidden"),document.getElementById("wall-y-scene-size-inspector").classList.remove("hidden"),document.getElementById("floor-scene-size-inspector").classList.add("hidden"),document.getElementById("lidars-buttons").classList.remove("hidden"),document.getElementById("nodes-buttons").classList.add("hidden"),document.getElementById("info-table-height-inspector").classList.add("hidden");break;case"human-tracking":default:document.getElementById("overlap-height-inspector").classList.remove("hidden"),document.getElementById("overlap-height-selection-inspector").value=document.getElementById("default-height-detected").value,document.getElementById("floor-scene-size-inspector").classList.remove("hidden"),document.getElementById("floor-scene-size-title-inspector").innerHTML="Floor scene size",document.getElementById("wall-y-scene-size-inspector").classList.add("hidden"),document.getElementById("nodes-buttons").classList.remove("hidden"),document.getElementById("lidars-buttons").classList.add("hidden"),document.getElementById("info-table-height-inspector").classList.add("hidden");break}},this.changeHeightDetected=function(s){let c;switch(s){case 1.2:c="Target overlap height detection: Hips";break;case 1.6:c="Target overlap height detection: Shoulders";break;case 2:c="Target overlap height detection: Entire body";break;default:c="";break}document.getElementById("height-detection-text").innerText=c};function a(s){const c=s.objects.doesCoverArea(),g=document.getElementById("scene-fully-covered-icon");g.dataset.icon=c?"ion:checkmark-circle-sharp":"ion:close-circle",g.style=c?"color: #2b2;":"color: #b22;"}function o(s){document.getElementById("number-nodes-value").innerHTML=s.objects.getNbSensors()}this.update=function(s){a(s),o(s)}}}class On{constructor(e=!1){this.uiManager=e?void 0:new zn;const n=this.uiManager;this.sceneManager=new G(e,n);const i=this.sceneManager.viewportManager;r(),o();function r(){window.addEventListener("resize",()=>a(i)),n.bindEventListeners(i),i.bindEventListeners()}function a(s){s.onWindowResize()}function o(){requestAnimationFrame(o),i.render(),n&&n.update(i.sceneManager)}}}new On;
