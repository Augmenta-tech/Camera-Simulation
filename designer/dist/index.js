var Qt=Object.defineProperty;var qt=(h,e,n)=>e in h?Qt(h,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):h[e]=n;var Y=(h,e,n)=>(qt(h,typeof e!="symbol"?e+"":e,n),n);import{L as Nt,E as It,a as Ht,G as ut,T as qe,M as x,b as Ie,B as K,c as Ae,D as Ne,V as L,P as fe,C as Kt,d as Ce,e as Rt,O as ot,f as Jt,g as $t,h as se,i as at,j as jt,F as Yt,R as Xt,k as en,l as pt,Q as le,m as Tt,n as et,o as Ee,S as tn,p as je,q as nn,r as Oe,s as Fe,t as Lt,u as V,W as sn,v as on,w as an,x as rn,A as cn,y as ln,z as dn,H as hn,I as Ze,J as xt,K as ze}from"./vendor.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();window.camerasTypes=null;window.lidarsTypes=null;const Wt=(window==null?void 0:window.designerPath)||"./";function Zt(h,e){var n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("GET",h,!1),n.onreadystatechange=function(){n.readyState===4&&n.status=="200"&&e(n.responseText)},n.send(null)}function be(){if(window.camerasTypes===null){let h;Zt(Wt+"js/camera-data/camera-data.json",function(e){h=JSON.parse(e).sensors.cameras;let t=0;h.forEach(i=>i.id=t++),h.forEach(i=>i.aspectRatio=Math.abs(Math.tan(i.HFov/2*Math.PI/180)/Math.tan(i.VFov/2*Math.PI/180))),window.camerasTypes=h})}return window.camerasTypes}function we(){if(window.lidarsTypes===null){let h;Zt(Wt+"js/camera-data/camera-data.json",function(e){h=JSON.parse(e).sensors.lidars;let t=0;h.forEach(i=>i.id=t++),window.lidarsTypes=h})}return window.lidarsTypes}const Ge={meters:{value:1,label:"m",squaredLabel:"mÂ²"},feets:{value:3.28084,label:"ft",squaredLabel:"sqft"}},Ke=class Ke{constructor(e,n=Ge.meters,t=0,i=G.DEFAULT_WIDTH,r=G.DEFAULT_LENGTH){this.width=i,this.height=r,this.unit=n,this.elevation=t;const o=new Nt(new It,new Ht({color:0})),a=new ut,s=f(this.width,this.height),c=new ut;function g(p,y,A,k){a.children.forEach(S=>{S.geometry.dispose(),S.material.dispose()}),a.clear();const U=Math.floor(p*k),z=Math.floor(y*k),C=1/k,l=new fe(C,C),D=new Ae({color:1118481,side:Ne});new x(l,D);const w=p-U*C,b=new fe(w,C),_=y-z*C,m=new fe(C,_),P=new fe(w,_),E=new Ae({side:Ne,color:3026478}),M=new fe(p+.02,y+.02);M.translate(-p/2,y/2,0);const v=new x(M,E);v.position.set(p/2+.01,-y/2+.01,-.01),a.add(v);for(let S=0;S<z;S++){for(let F=0;F<U;F++)if((S+F)%2===0){const O=l.clone();O.translate(-p/2+(F+.5)*C,y/2-(S+.5)*C,0);const Q=new x(O,D);a.add(Q)}if((S+U)%2===0){const F=b.clone();F.translate(-p/2+U*C+w/2,y/2-(S+.5)*C,0);const O=new x(F,D);a.add(O)}}for(let S=0;S<U;S++)if((z+S)%2===0){const F=m.clone();F.translate(-p/2+(S+.5)*C,y/2-z*C-_/2,0);const O=new x(F,D);a.add(O)}if((U+z)%2===0){const S=P.clone();S.translate(-p/2+U*C+w/2,y/2-z*C-_/2,0);const F=new x(S,D);a.add(F)}B(a,p,y,A)}function f(p,y){const A=new qe("",{font:G.font,size:Ke.SIZE_TEXT_SCENE,height:.01});return new x(A,new Ie({color:16777215}))}function T(p,y,A,k){s.geometry.dispose();const U=Math.round(p*k.value*100)/100+k.label+" x "+Math.round(y*k.value*100)/100+k.label;s.geometry=new qe(U,{font:G.font,size:Ke.SIZE_TEXT_SCENE*2/3,height:.01}),B(s,p,y,A);const z=.14*U.length;s.translateX(p/2-.2-z),s.translateY(-(y/2-.2))}function u(p,y,A,k){o.geometry.dispose();const U=new K(Math.round(p*100)/100+.02,Math.round(y*100)/100+.02,0);o.geometry=new It(U),B(o,p,y,A),g(p,y,A,k.value),T(p,y,A,k),I(p,y,A)}function I(p,y,A,k){c.clear();const U=new K(1/15,A,1/15),z=new Ae({color:1118481,side:Ne});let C=new x(U,z);C.position.set(p,A/2,y),c.add(C);let l=new x(U,z);l.position.set(0,A/2,y),c.add(l);let D=new x(U,z);D.position.set(0,A/2,0),c.add(D);let w=new x(U,z);w.position.set(p,A/2,0),c.add(w)}function B(p,y,A,k){const U=new L(1,1,0),z=new L(y/2,A/2,0);p.position.set(0,0,0),U.applyEuler(e.rotation),z.applyEuler(e.rotation),p.position.set(U.x*Math.abs(z.x),U.y*Math.abs(z.y),-U.z*Math.abs(z.z)),p.translateZ(k+.005),p.setRotationFromEuler(e.rotation)}this.addToScene=function(p){p.add(o),p.add(a),p.add(s),p.add(c)},this.toggleUnit=function(p){this.dispose(),this.unit=p,this.width>0&&this.height>0&&u(this.width,this.height,this.elevation,this.unit)},this.setSize=function(p,y){this.dispose(),this.width=p,this.height=y,u(this.width,this.height,this.elevation,this.unit)},this.setSceneElevation=function(p){this.dispose(),this.elevation=p,u(this.width,this.height,this.elevation,this.unit)},this.removeFromScene=function(p){p.remove(o),p.remove(a),p.remove(s),p.remove(c)},this.dispose=function(){a.children.forEach(p=>{p.geometry.dispose(),p.material.dispose()}),a.clear(),o.geometry.dispose(),o.material.dispose(),s.geometry.dispose(),s.material.dispose()},u(this.width,this.height,this.elevation,this.unit)}};Y(Ke,"SIZE_TEXT_SCENE",.3);let rt=Ke;const q=class q{constructor(e,n=document.getElementById("tracking-mode-inspector")?document.getElementById("tracking-mode-inspector").value:"human-tracking",t=q.DEFAULT_CAMERA_TYPE_ID,i=0,r=0,o=q.DEFAULT_NODE_HEIGHT,a=0,s=0,c=0){this.id=e,this.cameraType=be().find(u=>u.id===t),this.xPos=i,this.yPos=r,this.zPos=o,this.xRot=a,this.yRot=s,this.zRot=c,this.cameraPerspective=g(this.cameraType,n,this.xPos,this.yPos,this.zPos,this.xRot,this.yRot,this.zRot),this.cameraPerspectiveHelper=new Kt(this.cameraPerspective),this.color=new Ce(Math.random(),Math.random(),Math.random()),this.mesh=f(this.color,this.xPos,this.yPos,this.zPos),this.coveredPointsAbove=[],this.areaCoveredFloor=new x,this.areaCoveredAbove=new x,this.areaCoveredWallX=new x,this.areaCoveredWallY=new x,this.areaAppear=!0,this.areaValue=0,this.nameText=T("Node "+(this.id+1),q.SIZE_TEXT_NODE,this.xPos-q.SIZE_TEXT_NODE*2,this.yPos+q.SIZE_TEXT_NODE/2,this.zPos-(this.cameraType.rangeFar-1)),this.areaValueText=T("AREA VALUE",q.SIZE_TEXT_NODE*2/3,this.xPos-q.SIZE_TEXT_NODE*4/3,this.yPos+3*q.SIZE_TEXT_NODE/2,this.zPos-(this.cameraType.rangeFar-1));function g(u,I,B,p,y,A,k,U){let z=0;switch(I){case"hand-tracking":z=u.handFar;break;case"human-tracking":default:z=u.rangeFar;break}const C=new Rt(u.VFov,u.aspectRatio,u.rangeNear,z);return C.position.set(B,y,p),C.rotation.set(A+q.DEFAULT_NODE_ROTATION_X,-k,U),C}function f(u,I,B,p){const y=new Ie({color:u,dithering:!0}),A=new K(.2,.2,.2),k=new x(A,y);return k.position.set(I,p,B),k.name="Camera",k}function T(u,I,B,p,y){const A=new qe(u,{font:He.font,size:I,height:.01}),k=new x(A,new Ie({color:16777215}));return k.position.set(B,y,p),k.rotation.x=-Math.PI/2,k}this.addToScene=function(u){u.add(this.cameraPerspective),u.add(this.cameraPerspectiveHelper),u.add(this.mesh),u.add(this.nameText),u.add(this.areaValueText),this.areaAppear=!0},this.removeFromScene=function(u){this.areaAppear=!1,u.remove(this.cameraPerspective),u.remove(this.cameraPerspectiveHelper),u.remove(this.mesh),u.remove(this.areaCoveredFloor),u.remove(this.areaCoveredAbove),u.remove(this.areaCoveredWallX),u.remove(this.areaCoveredWallY),u.remove(this.nameText),u.remove(this.areaValueText)},this.changeVisibility=function(u=!this.areaAppear){const I=u;this.areaAppear=I,this.cameraPerspective.visible=I,this.cameraPerspectiveHelper.visible=I,this.nameText.visible=I,this.areaValueText.visible=I,this.uiElement&&this.uiElement.changeVisibility(I)},this.updatePosition=function(u){this.xPos=this.mesh.position.x,this.yPos=this.mesh.position.z,this.zPos=this.mesh.position.y,this.cameraPerspective.position.set(this.xPos,this.zPos,this.yPos),this.uiElement&&this.uiElement.updatePosition(this.xPos,this.yPos,this.zPos,u)},this.updateAreaText=function(u){this.areaValueText.geometry.dispose(),this.areaValueText.geometry=new qe(Math.round(this.areaValue*100)/100+u.squaredLabel,{font:He.font,size:q.SIZE_TEXT_NODE*2/3*Math.sqrt(this.areaValue)/3/u.value,height:.01}),this.nameText.geometry.dispose(),this.nameText.geometry=new qe("Node "+(this.id+1),{font:He.font,size:q.SIZE_TEXT_NODE*Math.sqrt(this.areaValue)/3/u.value,height:.01})},this.changeTextPosition=function(u,I){this.nameText.scale.set(1,1,1),this.nameText.position.copy(u.add(new L(-q.SIZE_TEXT_NODE*2*Math.sqrt(this.areaValue)/3/I,.1,0))),this.areaValueText.position.copy(u.add(new L(0,0,1.5*q.SIZE_TEXT_NODE*Math.sqrt(this.areaValue)/3/I))),this.areaValueText.visible=this.areaAppear},this.changeMode=function(u){switch(u){case"hand-tracking":this.cameraPerspective.far=this.cameraType.handFar;break;case"human-tracking":default:this.cameraPerspective.far=this.cameraType.rangeFar;break}this.uiElement&&this.uiElement.changeFar()},this.update=function(){this.cameraPerspective.updateProjectionMatrix(),this.cameraPerspectiveHelper.update()},this.dispose=function(){this.cameraPerspective.children.forEach(u=>{u.isMesh&&(u.geometry.dispose(),u.material.dispose())}),this.cameraPerspective.clear(),this.cameraPerspectiveHelper.children.forEach(u=>{u.isMesh&&(u.geometry.dispose(),u.material.dispose())}),this.cameraPerspectiveHelper.clear(),this.cameraPerspectiveHelper.geometry.dispose(),this.cameraPerspectiveHelper.material.dispose(),this.cameraPerspectiveHelper.dispose(),this.mesh.geometry.dispose(),this.mesh.material.dispose(),this.coveredPointsAbove.length=0,this.areaCoveredFloor.geometry.dispose(),this.areaCoveredFloor.material.dispose(),this.areaCoveredAbove.geometry.dispose(),this.areaCoveredAbove.material.dispose(),this.areaCoveredWallX.geometry.dispose(),this.areaCoveredWallX.material.dispose(),this.areaCoveredWallY.geometry.dispose(),this.areaCoveredWallY.material.dispose(),this.nameText.geometry.dispose(),this.nameText.material.dispose(),this.areaValueText.geometry.dispose(),this.areaValueText.material.dispose(),this.uiElement&&this.uiElement.dispose()}}};Y(q,"DEFAULT_CAMERA_TYPE_ID",0),Y(q,"DEFAULT_NODE_HEIGHT",5.5),Y(q,"DEFAULT_NODE_ROTATION_X",-Math.PI/2),Y(q,"SIZE_TEXT_NODE",.4);let ce=q;class un{constructor(e,n){t(),i();function t(){let s="";be().filter(f=>f.recommended).forEach(f=>{const T='<option value="'+f.niceName+'" '+(e.cameraType.niceName===f.niceName?"selected":"")+">"+f.niceName;s+=T,s+="</option>"});const c=document.createElement("div");c.classList.add("sensorUI"),c.id="node-"+e.id+"-UI",c.innerHTML=`
                <div id="node-`+e.id+`-UI-header" class="row center-x-spaced center-y">
                    <div class="row center-y">
                        <div class="sensor-color" style="background-color: #`+e.color.getHexString()+`;"></div>
                        <p class="main-text">Sensor `+(e.id+1)+`</p>
                    </div>
                    <div class="row center-y">
                        <!-- <div id="node-`+e.id+`-solo-button"><span class="iconify" data-icon="bx:search-alt-2"></span></div> -->
                        <div id="node-`+e.id+`-hide-UI"><span class="iconify" data-icon="bx:minus"></span></div> 
                        <div id="node-`+e.id+`-visible"><span class="iconify" data-icon="akar-icons:eye-open"></span></div>
                        <!-- <div><span class="iconify" data-icon="fluent:lock-open-16-regular"></span></div> -->
                        <div id="node-`+e.id+`-delete"><span class="iconify" data-icon="fluent:delete-16-filled"></span></div>
                    </div>
                </div>
                <div id="node-infos-`+e.id+`-UI" class="column sections-container space-y">
                    <div id="select-camera" class="row center-y">
                        <select title="camType-`+e.id+'" name="camType-'+e.id+'" id="cam-type-'+e.id+`">
                        `+s+`
                        </select>
                    </div>
                    <div class="row sensor-transformations">
                        <p class="main-text">Position</p>
                        <div>
                            <p id="node-x-pos-`+e.id+'" class="draggable">X <strong data-unit='+n.currentUnit.value+">"+Math.round(e.xPos*n.currentUnit.value*100)/100+"</strong><span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        </div>
                        <div>
                            <p id="node-y-pos-`+e.id+'" class="draggable">Y <strong data-unit='+n.currentUnit.value+">"+Math.round(e.yPos*n.currentUnit.value*100)/100+"</strong><span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        </div>
                        <div>
                            <p id="node-z-pos-`+e.id+'" class="draggable">Z <strong data-unit='+n.currentUnit.value+">"+Math.round(e.zPos*n.currentUnit.value*100)/100+"</strong><span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        </div>
                    </div>
                    <div class="row sensor-transformations">
                        <p class="main-text">Rotation</p>
                        <div>
                            <p id="node-x-rot-`+e.id+'" class="draggable">X <strong>'+Math.round(e.xRot*180/Math.PI)+`</strong>Â°</p>
                        </div>
                        <div>
                            <p id="node-y-rot-`+e.id+'" class="draggable">Y <strong>'+Math.round(e.yRot*180/Math.PI)+`</strong>Â°</p>
                        </div>
                        <div>
                            <p id="node-z-rot-`+e.id+'" class="draggable">Z <strong>'+Math.round(e.zRot*180/Math.PI)+`</strong>Â° </p>
                        </div>
                    </div>
                    <div class="row cam-spec">
                        <p class="spec-title main-text">FOV</p>
                        <p>H</p><p id="hfov`+e.id+'">'+e.cameraType.HFov+`Â°</p>
                        <p>V</p><p id="vfov`+e.id+'">'+e.cameraType.VFov+`Â°</p>
                    </div>
                    <div class="row cam-spec">
                        <p class="spec-title main-text">Distance</p>
                        <p>Near</p><p><span id="node-near`+e.id+'" data-unit='+n.currentUnit.value+">"+Math.round(e.cameraPerspective.near*n.currentUnit.value*100)/100+"</span> <span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        <p>Far</p><p><span id="node-far`+e.id+'" data-unit='+n.currentUnit.value+">"+Math.round(e.cameraPerspective.far*n.currentUnit.value*100)/100+"</span> <span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                    </div>
                </div>`,document.getElementById("inspector").appendChild(c)}function i(){r(document.getElementById("node-x-pos-"+e.id)),r(document.getElementById("node-y-pos-"+e.id)),r(document.getElementById("node-z-pos-"+e.id)),r(document.getElementById("node-x-rot-"+e.id)),r(document.getElementById("node-y-rot-"+e.id)),r(document.getElementById("node-z-rot-"+e.id)),document.getElementById("node-"+e.id+"-hide-UI").addEventListener("click",()=>o()),document.getElementById("node-"+e.id+"-visible").addEventListener("click",()=>e.changeVisibility()),document.getElementById("node-"+e.id+"-delete").addEventListener("click",()=>n.objects.removeNode(e)),document.getElementById("cam-type-"+e.id).addEventListener("change",()=>a())}function r(s){let c=s.getElementsByTagName("strong")[0],g=parseFloat(c.innerHTML),f=0,T=0;s.onmousedown=u;function u(p){c=s.getElementsByTagName("strong")[0],g=parseFloat(c.innerHTML),c.classList.add("underlined"),p=p||window.event,p.preventDefault(),f=p.clientX,document.onmouseup=B,document.onmousemove=I}function I(p){p=p||window.event,p.preventDefault(),T=p.clientX-f,f=p.clientX;let y=1;switch(s.id.split("-")[2]){case"pos":y=1/100;break;case"rot":y=1;break;default:y=1;break}switch(g+=T*y,c.innerHTML=Math.round(g*100)/100,s.id.split("-")[1]){case"x":switch(s.id.split("-")[2]){case"pos":e.xPos=g/n.currentUnit.value,e.cameraPerspective.position.x=e.xPos,e.mesh.position.set(e.xPos,e.zPos,e.yPos);break;case"rot":e.xRot=g*(Math.PI/180),e.cameraPerspective.rotation.x=e.xRot+ce.DEFAULT_NODE_ROTATION_X;break}break;case"y":switch(s.id.split("-")[2]){case"pos":e.yPos=g/n.currentUnit.value,e.cameraPerspective.position.z=e.yPos,e.mesh.position.set(e.xPos,e.zPos,e.yPos);break;case"rot":e.yRot=g*(Math.PI/180),e.cameraPerspective.rotation.y=-e.yRot;break}break;case"z":switch(s.id.split("-")[2]){case"pos":e.zPos=g/n.currentUnit.value,e.cameraPerspective.position.y=e.zPos,e.mesh.position.set(e.xPos,e.zPos,e.yPos);break;case"rot":e.zRot=g*(Math.PI/180),e.cameraPerspective.rotation.z=e.zRot;break}break}}function B(){c.classList.contains("underlined")&&c.classList.remove("underlined"),document.onmouseup=null,document.onmousemove=null,n.objects.populateStorage()}}function o(){const s=document.getElementById("node-infos-"+e.id+"-UI");document.getElementById("node-"+e.id+"-UI-header");const c=s.classList.contains("hidden");c?s.classList.remove("hidden"):s.classList.add("hidden");const g=document.getElementById("node-"+e.id+"-hide-UI").firstChild;g.dataset.icon=c?"bx:minus":"bx:plus"}function a(){switch(e.cameraType=be().find(s=>s.niceName===document.getElementById("cam-type-"+e.id).value),e.cameraPerspective.fov=e.cameraType.VFov,e.cameraPerspective.aspect=e.cameraType.aspectRatio,e.cameraPerspective.near=e.cameraType.rangeNear,n.trackingMode){case"hand-tracking":e.cameraPerspective.far=e.cameraType.handFar;break;case"human-tracking":default:e.cameraPerspective.far=e.cameraType.rangeFar;break}document.getElementById("hfov"+e.id).innerHTML=e.cameraType.HFov+"Â°",document.getElementById("vfov"+e.id).innerHTML=e.cameraType.VFov+"Â°",document.getElementById("node-near"+e.id).innerHTML=Math.round(e.cameraPerspective.near*document.getElementById("node-near"+e.id).dataset.unit*100)/100,document.getElementById("node-far"+e.id).innerHTML=Math.round(e.cameraPerspective.far*document.getElementById("node-far"+e.id).dataset.unit*100)/100,n.objects.populateStorage()}this.changeFar=function(){document.getElementById("node-far"+e.id).innerHTML=Math.round(e.cameraPerspective.far*document.getElementById("node-far"+e.id).dataset.unit*100)/100},this.changeVisibility=function(s){const c=document.getElementById("node-"+e.id+"-visible").firstElementChild;c.dataset.icon=s?"akar-icons:eye-open":"akar-icons:eye-slashed",n.objects.updateFrustumIcon()},this.updatePosition=function(s,c,g,f){document.getElementById("node-x-pos-"+e.id).getElementsByTagName("strong")[0].innerHTML=Math.round(s*f*100)/100,document.getElementById("node-y-pos-"+e.id).getElementsByTagName("strong")[0].innerHTML=Math.round(c*f*100)/100,document.getElementById("node-z-pos-"+e.id).getElementsByTagName("strong")[0].innerHTML=Math.round(g*f*100)/100},this.dispose=function(){let s=document.getElementById("node-"+e.id+"-UI");s&&s.remove()}}}class mn{constructor(e,n){t(),i();function t(){let s="";we().filter(f=>f.recommended).forEach(f=>{const T='<option value="'+f.name+'" '+(e.lidarType.name===f.name?"selected":"")+">"+f.name;s+=T,s+="</option>"});const c=document.createElement("div");c.classList.add("sensorUI"),c.id="lidar-"+e.id+"-UI",c.innerHTML=`
                <div id="lidar-`+e.id+`-UI-header" class="row center-x-spaced center-y">
                    <div class="row center-y">
                        <div class="sensor-color" style="background-color: #`+e.color.getHexString()+`;"></div>
                        <p class="main-text">Lidar `+(e.id+1)+`</p>
                    </div>
                    <div class="row center-y">
                        <!-- <div id="lidar-`+e.id+`-solo-button"><span class="iconify" data-icon="bx:search-alt-2"></span></div> -->
                        <div id="lidar-`+e.id+`-hide-UI"><span class="iconify" data-icon="bx:minus"></span></div> 
                        <div id="lidar-`+e.id+`-visible"><span class="iconify" data-icon="akar-icons:eye-open"></span></div>
                        <!-- <div><span class="iconify" data-icon="fluent:lock-open-16-regular"></span></div> -->
                        <div id="lidar-`+e.id+`-delete"><span class="iconify" data-icon="fluent:delete-16-filled"></span></div>
                    </div>
                </div>
                <div id="lidar-infos-`+e.id+`-UI" class="column sections-container space-y">
                    <div id="select-lidar-type" class="row center-y">
                        <select title="lidarType-`+e.id+'" name="lidarType-'+e.id+'" id="lidar-type-'+e.id+`">
                        `+s+`
                        </select>
                    </div>
                    <div class="row sensor-transformations">
                        <p class="main-text">Transf.</p>
                        <div>
                            <p id="lidar-x-pos-`+e.id+'" class="draggable">Pos. X <strong data-unit='+n.currentUnit.value+">"+Math.round(e.xPos*n.currentUnit.value*100)/100+"</strong><span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        </div>
                        <div>
                            <p id="lidar-z-pos-`+e.id+'" class="draggable">Pos. Z <strong data-unit='+n.currentUnit.value+">"+Math.round(e.zPos*n.currentUnit.value*100)/100+"</strong><span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        </div>
                        <div>
                            <p id="lidar-y-rot-`+e.id+'" class="draggable">Rot. Y <strong>'+Math.round(e.yRot*180/Math.PI)+`</strong>Â° </p>
                        </div>
                    </div>
                    <div class="row cam-spec">
                        <p class="spec-title main-text">Angular</p>
                        <p>FOV</p><p id="lidar-fov`+e.id+'">'+e.lidarType.fov+`Â°</p>
                        <p>Res</p><p id="lidar-res`+e.id+'">'+e.lidarType.angularResolution+`Â°</p>
                    </div>
                    <div class="row cam-spec">
                        <p class="spec-title main-text">Distance</p>
                        <p>Near</p><p><span id="lidar-near`+e.id+'" data-unit='+n.currentUnit.value+">"+Math.round(e.lidarType.rangeNear*n.currentUnit.value*100)/100+"</span> <span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                        <p>Far</p><p><span id="lidar-far`+e.id+'" data-unit='+n.currentUnit.value+">"+Math.round(e.lidarType.rangeFar*n.currentUnit.value*100)/100+"</span> <span data-unittext="+n.currentUnit.value+">"+n.currentUnit.label+`</span></p>
                    </div>
                </div>`,document.getElementById("inspector").appendChild(c)}function i(){r(document.getElementById("lidar-x-pos-"+e.id)),r(document.getElementById("lidar-z-pos-"+e.id)),r(document.getElementById("lidar-y-rot-"+e.id)),document.getElementById("lidar-"+e.id+"-hide-UI").addEventListener("click",()=>o()),document.getElementById("lidar-"+e.id+"-visible").addEventListener("click",()=>e.changeVisibility()),document.getElementById("lidar-"+e.id+"-delete").addEventListener("click",()=>n.objects.removeLidar(e)),document.getElementById("lidar-type-"+e.id).addEventListener("change",()=>a())}function r(s){let c=s.getElementsByTagName("strong")[0],g=parseFloat(c.innerHTML),f=0,T=0;s.onmousedown=u;function u(p){c=s.getElementsByTagName("strong")[0],g=parseFloat(c.innerHTML),c.classList.add("underlined"),p=p||window.event,p.preventDefault(),f=p.clientX,document.onmouseup=B,document.onmousemove=I}function I(p){p=p||window.event,p.preventDefault(),T=p.clientX-f,f=p.clientX;let y=1;switch(s.id.split("-")[2]){case"pos":y=1/100;break;case"rot":y=1;break;default:y=1;break}switch(g+=T*y,c.innerHTML=Math.round(g*100)/100,s.id.split("-")[1]){case"x":switch(s.id.split("-")[2]){case"pos":e.xPos=g/n.currentUnit.value,e.mesh.position.set(e.xPos,e.zPos,e.yPos),e.rays.position.set(e.xPos,e.zPos,e.yPos);break}break;case"z":switch(s.id.split("-")[2]){case"pos":e.zPos=g/n.currentUnit.value,e.mesh.position.set(e.xPos,e.zPos,e.yPos),e.rays.position.set(e.xPos,e.zPos,e.yPos);break}break;case"y":switch(s.id.split("-")[2]){case"rot":e.yRot=g*(Math.PI/180),e.rays.rotation.z=e.yRot;break}break}}function B(){c.classList.contains("underlined")&&c.classList.remove("underlined"),document.onmouseup=null,document.onmousemove=null,n.objects.populateStorage()}}function o(){const s=document.getElementById("lidar-infos-"+e.id+"-UI");document.getElementById("lidar-"+e.id+"-UI-header");const c=s.classList.contains("hidden");c?s.classList.remove("hidden"):s.classList.add("hidden");const g=document.getElementById("lidar-"+e.id+"-hide-UI").firstChild;g.dataset.icon=c?"bx:minus":"bx:plus"}function a(){e.lidarType=we().find(s=>s.name===document.getElementById("lidar-type-"+e.id).value),n.scene.remove(e.rays),e.rays.children.forEach(s=>{s.isLineSegments&&(s.geometry.dispose(),s.material.dispose())}),e.rays.clear(),e.buildRays(),n.scene.add(e.rays),document.getElementById("lidar-fov"+e.id).innerHTML=e.lidarType.fov+"Â°",document.getElementById("lidar-res"+e.id).innerHTML=e.lidarType.angularResolution+"Â°",document.getElementById("lidar-near"+e.id).innerHTML=Math.round(e.lidarType.rangeNear*document.getElementById("lidar-near"+e.id).dataset.unit*100)/100,document.getElementById("lidar-far"+e.id).innerHTML=Math.round(e.lidarType.rangeFar*document.getElementById("lidar-far"+e.id).dataset.unit*100)/100,n.objects.populateStorage()}this.changeVisibility=function(s){const c=document.getElementById("lidar-"+e.id+"-visible").firstElementChild;c.dataset.icon=s?"akar-icons:eye-open":"akar-icons:eye-slashed",n.objects.updateRaysIcon()},this.updatePosition=function(s,c,g){document.getElementById("lidar-x-pos-"+e.id).getElementsByTagName("strong")[0].innerHTML=Math.round(s*g*100)/100,document.getElementById("lidar-z-pos-"+e.id).getElementsByTagName("strong")[0].innerHTML=Math.round(c*g*100)/100},this.dispose=function(){let s=document.getElementById("lidar-"+e.id+"-UI");s&&s.remove()}}}const de=class de{constructor(e){this.id=e,this.xPos=0,this.yPos=0,this.zPos=0,this.mesh=n(this.xPos,this.yPos),this.model=t();function n(i,r){const o=new K(.7,de.DEFAULT_DUMMIES_HEIGHT*4/5,.8),a=new Ie({color:0});a.transparent=!0,a.opacity=0,a.alphaTest=.5;const s=new x(o,a);return s.position.set(i,de.DEFAULT_DUMMIES_HEIGHT/2,r),s.name="Dummy",s}function t(){const i=new ot().copy(Math.random()<.5?de.maleModel:de.femaleModel),r=de.DEFAULT_DUMMIES_HEIGHT/180;return i.scale.set(r,r,r),i}this.addToScene=function(i){i.add(this.model),i.add(this.mesh),this.model.position.clone(this.mesh.position)},this.removeFromScene=function(i){i.remove(this.model),i.remove(this.mesh)},this.updatePosition=function(){this.xPos=this.mesh.position.x,this.yPos=this.mesh.position.z,this.zPos=this.mesh.position.y-de.DEFAULT_DUMMIES_HEIGHT/2,this.model.position.set(this.xPos,this.zPos,this.yPos)},this.dispose=function(){this.mesh.geometry.dispose(),this.mesh.material.dispose(),this.model.children.forEach(i=>{i.isMesh&&(i.geometry.dispose(),i.material.dispose())}),this.model.clear()}}};Y(de,"DEFAULT_DUMMIES_HEIGHT",document.getElementById("dummy-height-reference")?document.getElementById("dummy-height-reference").value:2),Y(de,"maleModel"),Y(de,"femaleModel");let ge=de;function Pt(h,e){const n=function(i){if(i.lengthComputable){const r=i.loaded/i.total*100;console.log(Math.round(r,2)+"% downloaded")}},t=(window==null?void 0:window.designerPath)||"./";new Jt().setPath(t+"models/"+e+"02/").setRequestHeader({"Content-Type":"model/mtl"}).load(e+"02.mtl",function(i){i.preload(),new $t().setMaterials(i).setPath(t+"models/"+e+"02/").setRequestHeader({"Content-Type":"model/obj"}).load(e+"02.obj",function(r){e==="male"?ge.maleModel=r:e==="female"&&(ge.femaleModel=r)},n)})}const ae=class ae{constructor(e,n=ae.DEFAULT_LIDAR_TYPE_ID,t=0,i=ae.DEFAULT_LIDAR_HOOK_HEIGHT,r=0){this.id=e,this.lidarType=we().find(a=>a.id===n),this.xPos=t,this.yPos=ae.DEFAULT_LIDAR_SIZE+.01*this.id,this.zPos=i,this.xRot=0,this.yRot=r,this.zRot=0,this.color=new Ce(.5*Math.random(),.5*Math.random(),.5*Math.random()),this.mesh=o(this.color,this.xPos,ae.DEFAULT_LIDAR_SIZE,this.zPos),this.rays=new ut,this.raysAppear=!0;function o(a,s,c,g){const f=new Ie({color:a,dithering:!0}),T=new se(ae.DEFAULT_LIDAR_SIZE,ae.DEFAULT_LIDAR_SIZE,2*ae.DEFAULT_LIDAR_SIZE),u=new x(T,f);return u.position.set(s,g,c),u.rotation.set(Math.PI/2,0,0),u.name="Lidar",u}this.buildRays=function(){const a=new Ae({color:this.color,transparent:!0,opacity:.4,alphaTest:.3}),s=-Math.PI/2-this.lidarType.fov/2*Math.PI/180;for(let c=s;c<=s+this.lidarType.fov*Math.PI/180;c+=this.lidarType.angularResolution*Math.PI/180){const g=new at,f=[];f.push(this.lidarType.rangeNear*Math.cos(c)),f.push(this.lidarType.rangeNear*Math.sin(c)),f.push(0),f.push(this.lidarType.rangeFar*Math.cos(c)),f.push(this.lidarType.rangeFar*Math.sin(c)),f.push(0);const T=new Float32Array(f);g.setAttribute("position",new jt(T,3));const u=new Nt(g,a);this.rays.add(u)}this.rays.position.set(this.xPos,this.zPos,this.yPos),this.rays.rotation.z=this.yRot},this.addToScene=function(a){a.add(this.mesh),a.add(this.rays)},this.removeFromScene=function(a){a.remove(this.mesh),a.remove(this.rays)},this.changeVisibility=function(a=!this.raysAppear){const s=a;this.raysAppear=s,this.rays.visible=s,this.uiElement&&this.uiElement.changeVisibility(s)},this.updatePosition=function(a){this.xPos=this.mesh.position.x,this.zPos=this.mesh.position.y,this.rays.position.set(this.xPos,this.zPos,this.yPos),this.uiElement&&this.uiElement.updatePosition(this.xPos,this.zPos,a)},this.update=function(){},this.dispose=function(){this.mesh.geometry.dispose(),this.mesh.material.dispose(),this.rays.children.forEach(a=>{a.geometry.dispose(),a.material.dispose()}),this.rays.clear(),this.uiElement&&this.uiElement.dispose()},this.buildRays()}};Y(ae,"DEFAULT_LIDAR_TYPE_ID",0),Y(ae,"DEFAULT_LIDAR_HOOK_HEIGHT",8),Y(ae,"DEFAULT_LIDAR_SIZE",.1),Y(ae,"DEFAULT_MIN_ANGLE_TO_AVOID_OBSTRUCTION",Math.PI/180*60),Y(ae,"DEFAULT_RATIO_FAR_MINDIST",2);let ie=ae;const Me=class Me{static loadFont(e,n){const t=(window==null?void 0:window.designerPath)||"./";new Yt().load(t+"fonts/helvetiker_regular.typeface.json",function(i){Me.font=i,n()})}constructor(e,n){let t=[],i=[],r=[];this.nodeMeshes=[],this.lidarsMeshes=[],this.dummiesMeshes=[];const o=[[]];this.initObjects=function(){const s=new URL(document.location.href).searchParams.get("sceneData");if(s){this.parseJson(s),document.getElementById("popup").classList.remove("is-visible"),this.populateStorage();return}else{const c=sessionStorage.getItem("sceneInfos");if(console.log(JSON.parse(c)),c){this.parseJson(c);return}}n||this.addNode(!1,e.trackingMode,ce.DEFAULT_CAMERA_TYPE_ID,2.5,2.5,ce.DEFAULT_NODE_HEIGHT),e.updateFloorAugmentaSceneBorder(G.DEFAULT_WIDTH,G.DEFAULT_LENGTH),this.populateStorage()},this.deleteObject=function(a){e.transformControl&&e.transformControl.object===a.mesh&&e.transformControl.detach(),a.removeFromScene(e.scene),a.dispose()},this.addDummy=function(){if(!ge.maleModel||!ge.femaleModel){console.log("Add Dummy button will work in an instant");return}const a=new ge(r.length);e.trackingMode=="wall-tracking"&&(a.model.rotateY(180),a.mesh.position.set(0,1,1),a.updatePosition());for(let s=0;s<r.length;s++)a.mesh.position.distanceTo(r[s].mesh.position)<1&&(a.mesh.position.x++,s=0);a.updatePosition(),a.addToScene(e.scene),r.push(a),this.dummiesMeshes.push(a.mesh),this.populateStorage()},this.removeDummies=function(){r.forEach(a=>this.deleteObject(a)),r.length=0,this.dummiesMeshes.length=0,this.populateStorage()},this.addNode=function(a=!1,s=e.trackingMode,c=ce.DEFAULT_CAMERA_TYPE_ID,g=0,f=0,T=ce.DEFAULT_NODE_HEIGHT,u=0,I=0,B=0){if(!Me.font){console.log("Add Node button will work in an instant");return}const p=new ce(t.length,s,c,g,f,T,u,I,B);if(n||(p.uiElement=new un(p,e)),!a)for(let y=0;y<t.length;y++)p.mesh.position.distanceTo(t[y].mesh.position)<.5&&(p.mesh.position.x+=.5,y=0);p.updatePosition(e.currentUnit.value),p.addToScene(e.scene),t.push(p),this.nodeMeshes.push(p.mesh),e.sceneSensorHeight=T,this.populateStorage()},this.displayFrustums=function(){const a=t.filter(c=>c.areaAppear);t.forEach(c=>c.changeVisibility(a.length!=t.length));const s=document.getElementById("display-frustums-button-icon");s&&(s.dataset.icon=a.length!=t.length?"akar-icons:eye-open":"akar-icons:eye-slashed")},this.updateFrustumIcon=function(){const a=t.filter(c=>c.areaAppear),s=document.getElementById("display-frustums-button-icon");s&&(s.dataset.icon=a.length!=0?"akar-icons:eye-open":"akar-icons:eye-slashed")},this.removeNodes=function(){t.forEach(a=>this.deleteObject(a)),t.length=0,this.nodeMeshes.length=0,this.populateStorage()},this.removeNode=function(a){this.deleteObject(a),t=t.filter(s=>s!=a),this.nodeMeshes=this.nodeMeshes.filter(s=>s!=a.mesh),this.populateStorage()},this.addLidar=function(a=!1,s=ie.DEFAULT_LIDAR_TYPE_ID,c=0,g=ie.DEFAULT_LIDAR_HEIGHT,f=0){if(!Me.font){console.log("Add Lidar button will work in an instant");return}const T=new ie(i.length,s,c,g,f);if(n||(T.uiElement=new mn(T,e)),!a)for(let u=0;u<i.length;u++)T.mesh.position.distanceTo(i[u].mesh.position)<1&&(T.mesh.position.x+=1,u=0);T.updatePosition(e.currentUnit.value),T.addToScene(e.scene),i.push(T),this.lidarsMeshes.push(T.mesh),this.populateStorage()},this.displayRays=function(){const a=i.filter(c=>c.raysAppear);i.forEach(c=>c.changeVisibility(a.length!=i.length));const s=document.getElementById("display-lidars-rays-button-icon");s&&(s.dataset.icon=a.length!=t.length?"akar-icons:eye-open":"akar-icons:eye-slashed")},this.updateRaysIcon=function(){const a=i.filter(c=>c.raysAppear),s=document.getElementById("display-lidars-rays-button-icon");s&&(s.dataset.icon=a.length!=0?"akar-icons:eye-open":"akar-icons:eye-slashed")},this.removeLidars=function(){i.forEach(a=>this.deleteObject(a)),i.length=0,this.lidarsMeshes.length=0,this.populateStorage()},this.removeLidar=function(a){this.deleteObject(a),i=i.filter(s=>s!=a),this.lidarsMeshes=this.lidarsMeshes.filter(s=>s!=a.mesh),this.populateStorage()},this.removeSensors=function(){this.removeNodes(),this.removeLidars()},this.calculateScenePolygon=function(a,s){o[0].length=0,o[0].push([0,0]),o[0].push([a,0]),o[0].push([a,s]),o[0].push([0,s])},this.updateObjectsPosition=function(){t.forEach(a=>a.updatePosition(e.currentUnit.value)),i.forEach(a=>a.updatePosition(e.currentUnit.value)),r.forEach(a=>a.updatePosition())},this.generateLink=function(){const a=new URL(document.location.href.split("?")[0]);return a.searchParams.append("sceneData",sessionStorage.getItem("sceneInfos")),a},this.parseJson=function(a){const s=JSON.parse(a);s.hasOwnProperty("sceneEnvironment")&&(e.sceneEnvironment=s.sceneEnvironment);let c="human-tracking";if(s.hasOwnProperty("trackingMode")&&(c=s.trackingMode,e.trackingMode=c),s.hasOwnProperty("sceneSize")&&s.sceneSize.length===2){const f=s.sceneSize[0],T=s.sceneSize[1];switch(c){case"wall-tracking":{const u=document.getElementById("input-wall-y-scene-width-inspector");u&&(u.value=f);const I=document.getElementById("input-wall-y-scene-height-inspector");I&&(I.value=T),e.updateWallYAugmentaSceneBorder(f,T);break}case"hand-tracking":case"human-tracking":{const u=document.getElementById("input-scene-width-inspector");u&&(u.value=f);const I=document.getElementById("input-scene-length-inspector");I&&(I.value=T),e.updateFloorAugmentaSceneBorder(f,T);break}}}s.hasOwnProperty("unit")&&e.toggleUnit(s.unit);const g=document.getElementById("tracking-mode-selection-inspector");if(g&&(g.value=c,g.dispatchEvent(new Event("change"))),s.hasOwnProperty("heightDetected")){const f=document.getElementById("overlap-height-selection-inspector");f&&(f.value=s.heightDetected,f.dispatchEvent(new Event("change"))),e.heightDetected=s.heightDetected}if(s.hasOwnProperty("sceneSensorHeight")){const f=document.getElementById("input-scene-sensor-height-inspector");f&&(f.value=s.sceneSensorHeight,f.dispatchEvent(new Event("change"))),e.sceneSensorHeight=s.sceneSensorHeight}if(s.hasOwnProperty("objects")&&(s.objects.hasOwnProperty("nodes")&&s.objects.nodes.forEach(f=>this.addNode(!0,s.trackingMode,f.cameraTypeId,f.p_x,f.p_y,f.p_z,f.r_x,f.r_y,f.r_z)),s.objects.hasOwnProperty("lidars")&&s.objects.lidars.forEach(f=>this.addLidar(!0,f.lidarTypeId,f.p_x,f.p_z,f.r_y)),s.objects.hasOwnProperty("dummies"))){if(!ge.maleModel||!ge.femaleModel)return;s.objects.dummies.forEach(f=>{this.addDummy();const T=r[r.length-1];T.mesh.translateX(f.p_x),T.mesh.translateZ(f.p_y),T.updatePosition()})}},this.generateJson=function(){const a={sceneEnvironment:e.sceneEnvironment,sceneSize:[e.sceneWidth,e.sceneLength],unit:e.currentUnit,trackingMode:e.trackingMode,heightDetected:e.heightDetected,sceneSensorHeight:e.sceneSensorHeight,objects:{nodes:[],lidars:[],dummies:[]}};return t.forEach(s=>{const c={id:s.id,cameraTypeId:s.cameraType.id,p_x:s.xPos,p_y:s.yPos,p_z:s.zPos,r_x:s.xRot,r_y:s.yRot,r_z:s.zRot};a.objects.nodes.push(c)}),i.forEach(s=>{const c={id:s.id,lidarTypeId:s.lidarType.id,p_x:s.xPos,p_z:s.zPos,r_y:s.yRot};a.objects.lidars.push(c)}),r.forEach(s=>{const c={id:s.id,p_x:s.xPos,p_y:s.yPos,p_z:s.zPos};a.objects.dummies.push(c)}),JSON.stringify(a)},this.populateStorage=()=>sessionStorage.setItem("sceneInfos",this.generateJson()),this.changeSensorsTrackingMode=function(a){t.forEach(s=>s.changeMode(a))},this.doesCoverArea=function(){let s={regions:[...o],inverted:!0};return t.forEach(c=>{const g={regions:[[]],inverted:!1};c.coveredPointsAbove.forEach(I=>{g.regions[0].push([I.x,I.z])});const f=PolyBool.segments(g),T=PolyBool.segments(s),u=PolyBool.combine(f,T);s=PolyBool.polygon(PolyBool.selectUnion(u))}),s.regions.length===0},this.getNbNodes=()=>t.length,this.getNbLidars=()=>i.length,this.getNbSensors=()=>this.getNbNodes()+this.getNbLidars(),this.debug=function(){console.log(JSON.parse(sessionStorage.getItem("sceneInfos")))},this.update=function(){t.forEach(a=>{a.update(),e.drawProjection(a)})},Me.loadFont(n,()=>G.loadFont(n,()=>e.initAugmentaScene())),Pt(n,"male"),Pt(n,"female")}};Y(Me,"font");let He=Me;class pn{constructor(){this._observers=[]}addObserver(e){return this._observers.push(e),()=>{this._observers=this._observers.filter(n=>n!==e)}}notifyAllObservers(...e){this._observers.forEach(n=>{n(...e)})}notifyObserversExceptOrigin(e,...n){this._observers.filter(t=>t!==e).forEach(t=>{t(...n)})}}const xe=new Xt,re=new L,ve=new L,X=new le,St={X:new L(1,0,0),Y:new L(0,1,0),Z:new L(0,0,1)},ct={type:"change"},Mt={type:"mouseDown"},At={type:"mouseUp",mode:null},Bt={type:"objectChange"};class fn extends ot{constructor(e,n){super(),n===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),n=document),this.isTransformControls=!0,this.visible=!1,this.domElement=n,this.domElement.style.touchAction="none";const t=new wn;this._gizmo=t,this.add(t);const i=new In;this._plane=i,this.add(i);const r=this;function o(A,k){let U=k;Object.defineProperty(r,A,{get:function(){return U!==void 0?U:k},set:function(z){U!==z&&(U=z,i[A]=z,t[A]=z,r.dispatchEvent({type:A+"-changed",value:z}),r.dispatchEvent(ct))}}),r[A]=k,i[A]=k,t[A]=k}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const a=new L,s=new L,c=new le,g=new le,f=new L,T=new le,u=new L,I=new L,B=new L,p=0,y=new L;o("worldPosition",a),o("worldPositionStart",s),o("worldQuaternion",c),o("worldQuaternionStart",g),o("cameraPosition",f),o("cameraQuaternion",T),o("pointStart",u),o("pointEnd",I),o("rotationAxis",B),o("rotationAngle",p),o("eye",y),this._offset=new L,this._startNorm=new L,this._endNorm=new L,this._cameraScale=new L,this._parentPosition=new L,this._parentQuaternion=new le,this._parentQuaternionInv=new le,this._parentScale=new L,this._worldScaleStart=new L,this._worldQuaternionInv=new le,this._worldScale=new L,this._positionStart=new L,this._quaternionStart=new le,this._scaleStart=new L,this._getPointer=gn.bind(this),this._onPointerDown=En.bind(this),this._onPointerHover=yn.bind(this),this._onPointerMove=vn.bind(this),this._onPointerUp=bn.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;xe.setFromCamera(e,this.camera);const n=lt(this._gizmo.picker[this.mode],xe);n?this.axis=n.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){xe.setFromCamera(e,this.camera);const n=lt(this._plane,xe,!0);n&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(n.point).sub(this.worldPositionStart)),this.dragging=!0,Mt.mode=this.mode,this.dispatchEvent(Mt)}}pointerMove(e){const n=this.axis,t=this.mode,i=this.object;let r=this.space;if(t==="scale"?r="local":(n==="E"||n==="XYZE"||n==="XYZ")&&(r="world"),i===void 0||n===null||this.dragging===!1||e.button!==-1)return;xe.setFromCamera(e,this.camera);const o=lt(this._plane,xe,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),t==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&n!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),n.indexOf("X")===-1&&(this._offset.x=0),n.indexOf("Y")===-1&&(this._offset.y=0),n.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&n!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(i.position.applyQuaternion(X.copy(this._quaternionStart).invert()),n.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),n.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),n.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),r==="world"&&(i.parent&&i.position.add(re.setFromMatrixPosition(i.parent.matrixWorld)),n.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),n.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),n.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(re.setFromMatrixPosition(i.parent.matrixWorld))));else if(t==="scale"){if(n.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),ve.set(a,a,a)}else re.copy(this.pointStart),ve.copy(this.pointEnd),re.applyQuaternion(this._worldQuaternionInv),ve.applyQuaternion(this._worldQuaternionInv),ve.divide(re),n.search("X")===-1&&(ve.x=1),n.search("Y")===-1&&(ve.y=1),n.search("Z")===-1&&(ve.z=1);i.scale.copy(this._scaleStart).multiply(ve),this.scaleSnap&&(n.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),n.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),n.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(t==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(re.setFromMatrixPosition(this.camera.matrixWorld));n==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):n==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(re.copy(this.rotationAxis).cross(this.eye))*a):(n==="X"||n==="Y"||n==="Z")&&(this.rotationAxis.copy(St[n]),re.copy(St[n]),r==="local"&&re.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(re.cross(this.eye).normalize())*a),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&n!=="E"&&n!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(X.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(X.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(ct),this.dispatchEvent(Bt)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(At.mode=this.mode,this.dispatchEvent(At)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(ct),this.dispatchEvent(Bt),this.pointStart.copy(this.pointEnd))}getRaycaster(){return xe}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}update(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}}function gn(h){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:h.button};{const e=this.domElement.getBoundingClientRect();return{x:(h.clientX-e.left)/e.width*2-1,y:-(h.clientY-e.top)/e.height*2+1,button:h.button}}}function yn(h){if(this.enabled)switch(h.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(h));break}}function En(h){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(h.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(h)),this.pointerDown(this._getPointer(h)))}function vn(h){this.enabled&&this.pointerMove(this._getPointer(h))}function bn(h){this.enabled&&(this.domElement.releasePointerCapture(h.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(h)))}function lt(h,e,n){const t=e.intersectObject(h,!0);for(let i=0;i<t.length;i++)if(t[i].object.visible||n)return t[i];return!1}const tt=new en,R=new L(0,1,0),kt=new L(0,0,0),Dt=new pt,nt=new le,it=new le,he=new L,_t=new pt,Ve=new L(1,0,0),Se=new L(0,1,0),Qe=new L(0,0,1),st=new L,Ye=new L,Xe=new L;class wn extends ot{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Ae({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=new Ht({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=e.clone();t.opacity=.15;const i=n.clone();i.opacity=.5;const r=e.clone();r.color.setHex(12535623);const o=e.clone();o.color.setHex(3646602);const a=e.clone();a.color.setHex(7376560);const s=e.clone();s.color.setHex(12535623),s.opacity=.5;const c=e.clone();c.color.setHex(3646602),c.opacity=.5;const g=e.clone();g.color.setHex(7376560),g.opacity=.5;const f=e.clone();f.opacity=.25;const T=e.clone();T.color.setHex(16776960),T.opacity=.25,e.clone().color.setHex(16776960);const I=e.clone();I.color.setHex(7895160);const B=new se(0,.04,.1,12);B.translate(0,.05,0);const p=new K(.08,.08,.08);p.translate(0,.04,0);const y=new at;y.setAttribute("position",new Tt([0,0,0,1,0,0],3));const A=new se(.0075,.0075,.5,3);A.translate(0,.25,0);function k(M,v){const S=new je(M,.0075,3,64,v*Math.PI*2);return S.rotateY(Math.PI/2),S.rotateX(Math.PI/2),S}function U(){const M=new at;return M.setAttribute("position",new Tt([0,0,0,1,1,1],3)),M}const z={X:[[new x(B,r),[.5,0,0],[0,0,-Math.PI/2]],[new x(B,r),[-.5,0,0],[0,0,Math.PI/2]],[new x(A,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new x(B,a),[0,.5,0]],[new x(B,a),[0,-.5,0],[Math.PI,0,0]],[new x(A,a)]],Z:[[new x(B,o),[0,0,.5],[Math.PI/2,0,0]],[new x(B,o),[0,0,-.5],[-Math.PI/2,0,0]],[new x(A,o),null,[Math.PI/2,0,0]]],XYZ:[[new x(new et(.1,0),f.clone()),[0,0,0]]],XY:[[new x(new K(.15,.15,.01),c.clone()),[.15,.15,0]]],YZ:[[new x(new K(.15,.15,.01),s.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new x(new K(.15,.15,.01),g.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},C={X:[[new x(new se(.2,0,.6,4),t),[.3,0,0],[0,0,-Math.PI/2]],[new x(new se(.2,0,.6,4),t),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new x(new se(.2,0,.6,4),t),[0,.3,0]],[new x(new se(.2,0,.6,4),t),[0,-.3,0],[0,0,Math.PI]]],Z:[[new x(new se(.2,0,.6,4),t),[0,0,.3],[Math.PI/2,0,0]],[new x(new se(.2,0,.6,4),t),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new x(new et(.2,0),t)]],XY:[[new x(new K(.2,.2,.01),t),[.15,.15,0]]],YZ:[[new x(new K(.2,.2,.01),t),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new x(new K(.2,.2,.01),t),[.15,0,.15],[-Math.PI/2,0,0]]]},l={START:[[new x(new et(.01,2),i),null,null,null,"helper"]],END:[[new x(new et(.01,2),i),null,null,null,"helper"]],DELTA:[[new Ee(U(),i),null,null,null,"helper"]],X:[[new Ee(y,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ee(y,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ee(y,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},D={XYZE:[[new x(k(.5,1),I),null,[0,Math.PI/2,0]]],X:[[new x(k(.5,.5),r)]],Y:[[new x(k(.5,.5),a),null,[0,0,-Math.PI/2]]],Z:[[new x(k(.5,.5),o),null,[0,Math.PI/2,0]]],E:[[new x(k(.75,1),T),null,[0,Math.PI/2,0]]]},w={AXIS:[[new Ee(y,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},b={XYZE:[[new x(new tn(.25,10,8),t)]],X:[[new x(new je(.5,.1,4,24),t),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new x(new je(.5,.1,4,24),t),[0,0,0],[Math.PI/2,0,0]]],Z:[[new x(new je(.5,.1,4,24),t),[0,0,0],[0,0,-Math.PI/2]]],E:[[new x(new je(.75,.1,2,24),t)]]},_={X:[[new x(p,r),[.5,0,0],[0,0,-Math.PI/2]],[new x(A,r),[0,0,0],[0,0,-Math.PI/2]],[new x(p,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new x(p,a),[0,.5,0]],[new x(A,a)],[new x(p,a),[0,-.5,0],[0,0,Math.PI]]],Z:[[new x(p,o),[0,0,.5],[Math.PI/2,0,0]],[new x(A,o),[0,0,0],[Math.PI/2,0,0]],[new x(p,o),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new x(new K(.15,.15,.01),c),[.15,.15,0]]],YZ:[[new x(new K(.15,.15,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new x(new K(.15,.15,.01),g),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new x(new K(.1,.1,.1),f.clone())]]},m={X:[[new x(new se(.2,0,.6,4),t),[.3,0,0],[0,0,-Math.PI/2]],[new x(new se(.2,0,.6,4),t),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new x(new se(.2,0,.6,4),t),[0,.3,0]],[new x(new se(.2,0,.6,4),t),[0,-.3,0],[0,0,Math.PI]]],Z:[[new x(new se(.2,0,.6,4),t),[0,0,.3],[Math.PI/2,0,0]],[new x(new se(.2,0,.6,4),t),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new x(new K(.2,.2,.01),t),[.15,.15,0]]],YZ:[[new x(new K(.2,.2,.01),t),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new x(new K(.2,.2,.01),t),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new x(new K(.2,.2,.2),t),[0,0,0]]]},P={X:[[new Ee(y,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ee(y,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ee(y,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function E(M){const v=new ot;for(const S in M)for(let F=M[S].length;F--;){const O=M[S][F][0].clone(),Q=M[S][F][1],te=M[S][F][2],J=M[S][F][3],Be=M[S][F][4];O.name=S,O.tag=Be,Q&&O.position.set(Q[0],Q[1],Q[2]),te&&O.rotation.set(te[0],te[1],te[2]),J&&O.scale.set(J[0],J[1],J[2]),O.updateMatrix();const $=O.geometry.clone();$.applyMatrix4(O.matrix),O.geometry=$,O.renderOrder=1/0,O.position.set(0,0,0),O.rotation.set(0,0,0),O.scale.set(1,1,1),v.add(O)}return v}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=E(z)),this.add(this.gizmo.rotate=E(D)),this.add(this.gizmo.scale=E(_)),this.add(this.picker.translate=E(C)),this.add(this.picker.rotate=E(b)),this.add(this.picker.scale=E(m)),this.add(this.helper.translate=E(l)),this.add(this.helper.rotate=E(w)),this.add(this.helper.scale=E(P)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:it;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let r=0;r<i.length;r++){const o=i[r];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.position.copy(this.worldPositionStart),o.visible=!!this.axis,this.axis==="X"&&(X.setFromEuler(tt.set(0,0,0)),o.quaternion.copy(t).multiply(X),Math.abs(R.copy(Ve).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(X.setFromEuler(tt.set(0,0,Math.PI/2)),o.quaternion.copy(t).multiply(X),Math.abs(R.copy(Se).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(X.setFromEuler(tt.set(0,Math.PI/2,0)),o.quaternion.copy(t).multiply(X),Math.abs(R.copy(Qe).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(X.setFromEuler(tt.set(0,Math.PI/2,0)),R.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(Dt.lookAt(kt,R,Se)),o.quaternion.multiply(X),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),re.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),re.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(re),o.visible=this.dragging):(o.quaternion.copy(t),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(R.copy(Ve).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(R.copy(Se).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(R.copy(Qe).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(R.copy(Qe).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(R.copy(Ve).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(R.copy(Se).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(nt.copy(t),R.copy(this.eye).applyQuaternion(X.copy(t).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(Dt.lookAt(this.eye,kt,Se)),o.name==="X"&&(X.setFromAxisAngle(Ve,Math.atan2(-R.y,R.z)),X.multiplyQuaternions(nt,X),o.quaternion.copy(X)),o.name==="Y"&&(X.setFromAxisAngle(Se,Math.atan2(R.x,R.z)),X.multiplyQuaternions(nt,X),o.quaternion.copy(X)),o.name==="Z"&&(X.setFromAxisAngle(Qe,Math.atan2(R.y,R.x)),X.multiplyQuaternions(nt,X),o.quaternion.copy(X))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(s){return o.name===s}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}class In extends x{constructor(){super(new fe(1e5,1e5,2,2),new Ae({visible:!1,wireframe:!0,side:Ne,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let n=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(n="local"),st.copy(Ve).applyQuaternion(n==="local"?this.worldQuaternion:it),Ye.copy(Se).applyQuaternion(n==="local"?this.worldQuaternion:it),Xe.copy(Qe).applyQuaternion(n==="local"?this.worldQuaternion:it),R.copy(Ye),this.mode){case"translate":case"scale":switch(this.axis){case"X":R.copy(this.eye).cross(st),he.copy(st).cross(R);break;case"Y":R.copy(this.eye).cross(Ye),he.copy(Ye).cross(R);break;case"Z":R.copy(this.eye).cross(Xe),he.copy(Xe).cross(R);break;case"XY":he.copy(Xe);break;case"YZ":he.copy(st);break;case"XZ":R.copy(Xe),he.copy(Ye);break;case"XYZ":case"E":he.set(0,0,0);break}break;case"rotate":default:he.set(0,0,0)}he.length()===0?this.quaternion.copy(this.cameraQuaternion):(_t.lookAt(re.set(0,0,0),he,R),this.quaternion.setFromRotationMatrix(_t)),super.updateMatrixWorld(e)}}const Ot={type:"change"},dt={type:"start"},ht={type:"end"};class Tn extends nn{constructor(e,n){super(),n===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=n,this.enabled=!0,this.target=new L,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Oe.ROTATE,MIDDLE:Oe.DOLLY,RIGHT:Oe.PAN},this.touches={ONE:Fe.ROTATE,TWO:Fe.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.listenToKeyEvents=function(d){d.addEventListener("keydown",gt),this._domElementKeyEvents=d},this.saveState=function(){t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=function(){t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(Ot),t.update(),r=i.NONE},this.update=function(){const d=new L,H=new le().setFromUnitVectors(e.up,new L(0,1,0)),Z=H.clone().invert(),ee=new L,Le=new le,_e=2*Math.PI;return function(){const wt=t.object.position;d.copy(wt).sub(t.target),d.applyQuaternion(H),a.setFromVector3(d),t.autoRotate&&r===i.NONE&&l(z()),t.enableDamping?(a.theta+=s.theta*t.dampingFactor,a.phi+=s.phi*t.dampingFactor):(a.theta+=s.theta,a.phi+=s.phi);let me=t.minAzimuthAngle,pe=t.maxAzimuthAngle;return isFinite(me)&&isFinite(pe)&&(me<-Math.PI?me+=_e:me>Math.PI&&(me-=_e),pe<-Math.PI?pe+=_e:pe>Math.PI&&(pe-=_e),me<=pe?a.theta=Math.max(me,Math.min(pe,a.theta)):a.theta=a.theta>(me+pe)/2?Math.max(me,a.theta):Math.min(pe,a.theta)),a.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=c,a.radius=Math.max(t.minDistance,Math.min(t.maxDistance,a.radius)),t.enableDamping===!0?t.target.addScaledVector(g,t.dampingFactor):t.target.add(g),d.setFromSpherical(a),d.applyQuaternion(Z),wt.copy(t.target).add(d),t.object.lookAt(t.target),t.enableDamping===!0?(s.theta*=1-t.dampingFactor,s.phi*=1-t.dampingFactor,g.multiplyScalar(1-t.dampingFactor)):(s.set(0,0,0),g.set(0,0,0)),c=1,f||ee.distanceToSquared(t.object.position)>o||8*(1-Le.dot(t.object.quaternion))>o?(t.dispatchEvent(Ot),ee.copy(t.object.position),Le.copy(t.object.quaternion),f=!1,!0):!1}}(),this.dispose=function(){t.domElement.removeEventListener("contextmenu",bt),t.domElement.removeEventListener("pointerdown",Te),t.domElement.removeEventListener("wheel",ft),t.domElement.removeEventListener("touchstart",yt),t.domElement.removeEventListener("touchend",vt),t.domElement.removeEventListener("touchmove",Et),t.domElement.ownerDocument.removeEventListener("pointermove",oe),t.domElement.ownerDocument.removeEventListener("pointerup",j),t._domElementKeyEvents!==null&&t._domElementKeyEvents.removeEventListener("keydown",gt)};const t=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=i.NONE;const o=1e-6,a=new Lt,s=new Lt;let c=1;const g=new L;let f=!1;const T=new V,u=new V,I=new V,B=new V,p=new V,y=new V,A=new V,k=new V,U=new V;function z(){return 2*Math.PI/60/60*t.autoRotateSpeed}function C(){return Math.pow(.95,t.zoomSpeed)}function l(d){s.theta-=d}function D(d){s.phi-=d}this.rotateLeft=l,this.rotateUp=D;const w=function(){const d=new L;return function(Z,ee){d.setFromMatrixColumn(ee,0),d.multiplyScalar(-Z),g.add(d)}}(),b=function(){const d=new L;return function(Z,ee){t.screenSpacePanning===!0?d.setFromMatrixColumn(ee,1):(d.setFromMatrixColumn(ee,0),d.crossVectors(t.object.up,d)),d.multiplyScalar(Z),g.add(d)}}(),_=function(){const d=new L;return function(Z,ee){const Le=t.domElement;if(t.object.isPerspectiveCamera){const _e=t.object.position;d.copy(_e).sub(t.target);let $e=d.length();$e*=Math.tan(t.object.fov/2*Math.PI/180),w(2*Z*$e/Le.clientHeight,t.object.matrix),b(2*ee*$e/Le.clientHeight,t.object.matrix)}else t.object.isOrthographicCamera?(w(Z*(t.object.right-t.object.left)/t.object.zoom/Le.clientWidth,t.object.matrix),b(ee*(t.object.top-t.object.bottom)/t.object.zoom/Le.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}}();function m(d){t.object.isPerspectiveCamera?c/=d:t.object.isOrthographicCamera?(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom*d)),t.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function P(d){t.object.isPerspectiveCamera?c*=d:t.object.isOrthographicCamera?(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/d)),t.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function E(d){T.set(d.clientX,d.clientY)}function M(d){A.set(d.clientX,d.clientY)}function v(d){B.set(d.clientX,d.clientY)}function S(d){u.set(d.clientX,d.clientY),I.subVectors(u,T).multiplyScalar(t.rotateSpeed);const H=t.domElement;l(2*Math.PI*I.x/H.clientHeight),D(2*Math.PI*I.y/H.clientHeight),T.copy(u),t.update()}function F(d){k.set(d.clientX,d.clientY),U.subVectors(k,A),U.y>0?m(C()):U.y<0&&P(C()),A.copy(k),t.update()}function O(d){p.set(d.clientX,d.clientY),y.subVectors(p,B).multiplyScalar(t.panSpeed),_(y.x,y.y),B.copy(p),t.update()}function Q(d){d.deltaY<0?P(C()):d.deltaY>0&&m(C()),t.update()}function te(d){let H=!1;switch(d.code){case t.keys.UP:_(0,t.keyPanSpeed),H=!0;break;case t.keys.BOTTOM:_(0,-t.keyPanSpeed),H=!0;break;case t.keys.LEFT:_(t.keyPanSpeed,0),H=!0;break;case t.keys.RIGHT:_(-t.keyPanSpeed,0),H=!0;break}H&&(d.preventDefault(),t.update())}function J(d){if(d.touches.length==1)T.set(d.touches[0].pageX,d.touches[0].pageY);else{const H=.5*(d.touches[0].pageX+d.touches[1].pageX),Z=.5*(d.touches[0].pageY+d.touches[1].pageY);T.set(H,Z)}}function Be(d){if(d.touches.length==1)B.set(d.touches[0].pageX,d.touches[0].pageY);else{const H=.5*(d.touches[0].pageX+d.touches[1].pageX),Z=.5*(d.touches[0].pageY+d.touches[1].pageY);B.set(H,Z)}}function $(d){const H=d.touches[0].pageX-d.touches[1].pageX,Z=d.touches[0].pageY-d.touches[1].pageY,ee=Math.sqrt(H*H+Z*Z);A.set(0,ee)}function ke(d){t.enableZoom&&$(d),t.enablePan&&Be(d)}function Re(d){t.enableZoom&&$(d),t.enableRotate&&J(d)}function De(d){if(d.touches.length==1)u.set(d.touches[0].pageX,d.touches[0].pageY);else{const Z=.5*(d.touches[0].pageX+d.touches[1].pageX),ee=.5*(d.touches[0].pageY+d.touches[1].pageY);u.set(Z,ee)}I.subVectors(u,T).multiplyScalar(t.rotateSpeed);const H=t.domElement;l(2*Math.PI*I.x/H.clientHeight),D(2*Math.PI*I.y/H.clientHeight),T.copy(u)}function ne(d){if(d.touches.length==1)p.set(d.touches[0].pageX,d.touches[0].pageY);else{const H=.5*(d.touches[0].pageX+d.touches[1].pageX),Z=.5*(d.touches[0].pageY+d.touches[1].pageY);p.set(H,Z)}y.subVectors(p,B).multiplyScalar(t.panSpeed),_(y.x,y.y),B.copy(p)}function Je(d){const H=d.touches[0].pageX-d.touches[1].pageX,Z=d.touches[0].pageY-d.touches[1].pageY,ee=Math.sqrt(H*H+Z*Z);k.set(0,ee),U.set(0,Math.pow(k.y/A.y,t.zoomSpeed)),m(U.y),A.copy(k)}function N(d){t.enableZoom&&Je(d),t.enablePan&&ne(d)}function ye(d){t.enableZoom&&Je(d),t.enableRotate&&De(d)}function Te(d){if(t.enabled!==!1)switch(d.pointerType){case"mouse":case"pen":ue(d);break}}function oe(d){if(t.enabled!==!1)switch(d.pointerType){case"mouse":case"pen":Gt(d);break}}function j(d){switch(d.pointerType){case"mouse":case"pen":Vt();break}}function ue(d){d.preventDefault(),t.domElement.focus?t.domElement.focus():window.focus();let H;switch(d.button){case 0:H=t.mouseButtons.LEFT;break;case 1:H=t.mouseButtons.MIDDLE;break;case 2:H=t.mouseButtons.RIGHT;break;default:H=-1}switch(H){case Oe.DOLLY:if(t.enableZoom===!1)return;M(d),r=i.DOLLY;break;case Oe.ROTATE:if(d.ctrlKey||d.metaKey||d.shiftKey){if(t.enablePan===!1)return;v(d),r=i.PAN}else{if(t.enableRotate===!1)return;E(d),r=i.ROTATE}break;case Oe.PAN:if(d.ctrlKey||d.metaKey||d.shiftKey){if(t.enableRotate===!1)return;E(d),r=i.ROTATE}else{if(t.enablePan===!1)return;v(d),r=i.PAN}break;default:r=i.NONE}r!==i.NONE&&(t.domElement.ownerDocument.addEventListener("pointermove",oe),t.domElement.ownerDocument.addEventListener("pointerup",j),t.dispatchEvent(dt))}function Gt(d){if(t.enabled!==!1)switch(d.preventDefault(),r){case i.ROTATE:if(t.enableRotate===!1)return;S(d);break;case i.DOLLY:if(t.enableZoom===!1)return;F(d);break;case i.PAN:if(t.enablePan===!1)return;O(d);break}}function Vt(d){t.domElement.ownerDocument.removeEventListener("pointermove",oe),t.domElement.ownerDocument.removeEventListener("pointerup",j),t.enabled!==!1&&(t.dispatchEvent(ht),r=i.NONE)}function ft(d){t.enabled===!1||t.enableZoom===!1||r!==i.NONE&&r!==i.ROTATE||(d.preventDefault(),t.dispatchEvent(dt),Q(d),t.dispatchEvent(ht))}function gt(d){t.enabled===!1||t.enablePan===!1||te(d)}function yt(d){if(t.enabled!==!1){switch(d.preventDefault(),d.touches.length){case 1:switch(t.touches.ONE){case Fe.ROTATE:if(t.enableRotate===!1)return;J(d),r=i.TOUCH_ROTATE;break;case Fe.PAN:if(t.enablePan===!1)return;Be(d),r=i.TOUCH_PAN;break;default:r=i.NONE}break;case 2:switch(t.touches.TWO){case Fe.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;ke(d),r=i.TOUCH_DOLLY_PAN;break;case Fe.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;Re(d),r=i.TOUCH_DOLLY_ROTATE;break;default:r=i.NONE}break;default:r=i.NONE}r!==i.NONE&&t.dispatchEvent(dt)}}function Et(d){if(t.enabled!==!1)switch(d.preventDefault(),r){case i.TOUCH_ROTATE:if(t.enableRotate===!1)return;De(d),t.update();break;case i.TOUCH_PAN:if(t.enablePan===!1)return;ne(d),t.update();break;case i.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;N(d),t.update();break;case i.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;ye(d),t.update();break;default:r=i.NONE}}function vt(d){t.enabled!==!1&&(t.dispatchEvent(ht),r=i.NONE)}function bt(d){t.enabled!==!1&&d.preventDefault()}t.domElement.addEventListener("contextmenu",bt),t.domElement.addEventListener("pointerdown",Te),t.domElement.addEventListener("wheel",ft,{passive:!1}),t.domElement.addEventListener("touchstart",yt,{passive:!1}),t.domElement.addEventListener("touchend",vt),t.domElement.addEventListener("touchmove",Et,{passive:!1}),this.update()}}class Ln{constructor(e,n,t){n=Object.assign({size:90,padding:8,bubbleSizePrimary:8,bubbleSizeSecondary:6,lineWidth:2,fontSize:"12px",fontFamily:"arial",fontWeight:"bold",fontColor:"#222222",className:"orbit-controls-gizmo",colors:{x:["#f73c3c","#942424"],y:["#6ccb26","#417a17"],z:["#178cf0","#0e5490"]}},n),this.lock=!1,this.lockX=!1,this.lockY=!1,this.update=()=>{if(!this.lock){a.updateMatrix(),s.extractRotation(a.matrix).invert();for(let v=0,S=I.length;v<S;v++)M(I[v],s);I.sort((v,S)=>v.position.z>S.position.z?1:-1),E(!0)}},this.dispose=()=>{o.removeEventListener("change",this.update),o.removeEventListener("start",()=>this.domElement.classList.add("inactive")),o.removeEventListener("end",()=>this.domElement.classList.remove("inactive")),this.domElement.removeEventListener("pointerdown",C,!1),this.domElement.removeEventListener("pointerenter",D,!1),this.domElement.removeEventListener("pointermove",w,!1),this.domElement.removeEventListener("click",_,!1),window.removeEventListener("pointermove",b,!1),window.removeEventListener("pointerup",l,!1),this.domElement.remove()};const i=t,r=this,o=e,a=e.object,s=new pt,c=new L,g=new V,f=new V,T=new V,u=new L(n.size/2,n.size/2,0),I=U();let B=null,p=!1,y,A,k;o.addEventListener("change",this.update),o.addEventListener("start",()=>this.domElement.classList.add("inactive")),o.addEventListener("end",()=>this.domElement.classList.remove("inactive"));function U(){const v=n.colors,S=n.lineWidth,F={primary:n.bubbleSizePrimary,secondary:n.bubbleSizeSecondary};return[{axis:"x",direction:new L(1,0,0),size:F.primary,color:v.x,line:S,label:"X",position:new L(0,0,0)},{axis:"y",direction:new L(0,1,0),size:F.primary,color:v.y,line:S,label:"Z",position:new L(0,0,0)},{axis:"z",direction:new L(0,0,1),size:F.primary,color:v.z,line:S,label:"Y",position:new L(0,0,0)},{axis:"-x",direction:new L(-1,0,0),size:F.secondary,color:v.x,position:new L(0,0,0)},{axis:"-y",direction:new L(0,-1,0),size:F.secondary,color:v.y,position:new L(0,0,0)},{axis:"-z",direction:new L(0,0,-1),size:F.secondary,color:v.z,position:new L(0,0,0)}]}function z(){const v=document.createElement("canvas");return v.width=n.size,v.height=n.size,v.classList.add(n.className),v.addEventListener("pointerdown",C,!1),v.addEventListener("pointerenter",D,!1),v.addEventListener("pointermove",w,!1),v.addEventListener("click",_,!1),y=v.getContext("2d"),v}function C(v){g.set(v.clientX,v.clientY),k=o.enabled,o.enabled=!1,a.isPerspectiveCamera&&(window.addEventListener("pointermove",b,!1),window.addEventListener("pointerup",l,!1))}function l(){setTimeout(()=>p=!1,0),r.domElement.classList.remove("dragging"),o.enabled=k,window.removeEventListener("pointermove",b,!1),window.removeEventListener("pointerup",l,!1)}function D(){A=r.domElement.getBoundingClientRect()}function w(v){if(p||r.lock)return;const S=B;B=null,v&&c.set(v.clientX-A.left,v.clientY-A.top,0);for(let F=0,O=I.length;F<O;F++)c.distanceTo(I[F].position)<I[F].size&&(B=I[F]);S!==B&&E()}function b(v){r.lock||(p||r.domElement.classList.add("dragging"),p=!0,B=null,f.set(v.clientX,v.clientY),T.subVectors(f,g).multiplyScalar(.5),r.lockX||o.rotateLeft(2*Math.PI*T.x/r.domElement.height),r.lockY||o.rotateUp(2*Math.PI*T.y/r.domElement.height),g.copy(f),o.update())}function _(){if(p||!B)return;const v=B.direction.clone();v.multiplyScalar(10),i.setupCameraChangement(!!a.isPerspectiveCamera,v),B=null}function m(v,S=10,F="#FF0000"){y.beginPath(),y.arc(v.x,v.y,S,0,2*Math.PI,!1),y.fillStyle=F,y.fill(),y.closePath()}function P(v,S,F=1,O="#FF0000"){y.beginPath(),y.moveTo(v.x,v.y),y.lineTo(S.x,S.y),y.lineWidth=F,y.strokeStyle=O,y.stroke(),y.closePath()}function E(v){v&&y.clearRect(0,0,r.domElement.width,r.domElement.height);for(let S=0,F=I.length;S<F;S++){const O=I[S],Q=B===O,te=O.position.z>=-.01?O.color[0]:O.color[1],J=O.position.z>=-.01?O.color[1]:O.color[0];O.line&&P(u,O.position,O.line,te),m(O.position,O.size,Q?J:te),O.label&&(y.font=[n.fontWeight,n.fontSize,n.fontFamily].join(" "),y.fillStyle=n.fontColor,y.textBaseline="middle",y.textAlign="center",y.fillText(O.label,O.position.x,O.position.y))}}function M(v){const S=v.direction.clone().applyMatrix4(s),F=v.size;v.position.set(S.x*(u.x-F/2-n.padding)+u.x,u.y-S.y*(u.y-F/2-n.padding),S.z)}this.domElement=z(),this.update()}}const Ue=class Ue{constructor(e,n){const t=this;let i=e.offsetWidth,r=e.offsetHeight;const o=U();this.renderer=o,this.element=o.domElement;let a=i/r;const s=z(),c=20,g=C(c,a);this.activeCamera=s;let f=l();this.orbitControls=f;let T=D(f);this.sceneManager=n,this.bindEventListeners=function(){this.element.addEventListener("pointerdown",B),this.element.addEventListener("pointerup",y),this.element.addEventListener("pointermove",A),n.transformControl.addEventListener("objectChange",function(){t.element.removeEventListener("pointermove",p),n.objects.updateObjectsPosition(),n.objects.populateStorage()}),document.addEventListener("keydown",k)};const u=new V,I=new V;function B(w){u.x=w.clientX,u.y=w.clientY,w.button===0&&t.element.addEventListener("pointermove",p),t.element.removeEventListener("pointermove",A)}function p(){t.activeCamera.isOrthographicCamera&&t.setupCameraChangement()}function y(w){I.x=w.clientX,I.y=w.clientY;const b=t.sceneManager.transformControl;b&&u.distanceTo(I)===0&&b.detach(),t.element.removeEventListener("pointermove",p),t.element.addEventListener("pointermove",A)}function A(w){const b=t.sceneManager.transformControl;if(b){const _=new V(w.clientX/e.offsetWidth*2-1,-((w.clientY-document.getElementById("header").offsetHeight)/e.offsetHeight)*2+1),m=new Xt;m.setFromCamera(_,t.activeCamera);const P=t.sceneManager.objects.nodeMeshes.concat(t.sceneManager.objects.dummiesMeshes).concat(t.sceneManager.objects.lidarsMeshes),E=m.intersectObjects(P,!1);if(E.length>0){const M=E[0].object;if(M!==b.object)if(b.attach(M),t.activeCamera.isOrthographicCamera){let v=new L;t.activeCamera.getWorldDirection(v),b.showX=!(1-Math.abs(v.dot(new L(1,0,0)))<.001),b.showZ=!(1-Math.abs(v.dot(new L(0,0,1)))<.001||M.name==="Lidar"),b.showY=!(1-Math.abs(v.dot(new L(0,1,0)))<.001||M.name==="Dummy")}else b.showX=!0,b.showZ=M.name!=="Lidar",b.showY=M.name!=="Dummy"}}}function k(w){switch(w.keyCode){case 80:t.sceneManager.debug();break}}function U(){const w=document.createElement("div");e.insertBefore(w,e.firstChild);const b=new sn({logarithmicDepthBuffer:!0,antialias:!0});return b.setPixelRatio(window.devicePixelRatio),b.setSize(i,r),w.appendChild(b.domElement),b.shadowMap.enabled=!0,b.shadowMap.type=on,b.outputEncoding=an,b.autoClear=!1,b}function z(){const w=new Rt(70,a,.2,1e4);return w.position.copy(Ue.DEFAULT_CAM_POSITION),w}function C(w,b){const _=new rn(-w,w,w/b,-w/b,.2,1e4);return _.position.set(0,0,10),_}function l(){const w=new Tn(t.activeCamera,o.domElement);return w.damping=.2,w.enableRotate=!t.activeCamera.isOrthographicCamera,w.addEventListener("change",()=>t.render()),w}function D(w){const b=new Ln(w,{size:100,padding:8,fontColor:"#ffffff",colors:{x:["#bf4747","#662626"],y:["#708eb0","#405063"],z:["#37a48a","#1c5446"]}},t);return e.appendChild(b.domElement),b}this.placeCamera=function(w=Ue.DEFAULT_CAM_POSITION){const b=this.activeCamera.isPerspectiveCamera?w.clone().add(new L(this.sceneManager.sceneWidth,0,this.sceneManager.sceneLength)):w;this.activeCamera.position.set(b.x,b.y,b.z),this.activeCamera.lookAt(0,0,0)},this.setupCameraChangement=function(w=!0,b=Ue.DEFAULT_CAM_POSITION){const _=this.sceneManager.transformControl;w&&(this.activeCamera=this.activeCamera.isOrthographicCamera?s:g,_&&(_.camera=this.activeCamera)),_&&_.detach(),this.placeCamera(b),f.dispose(),f=l(),T.dispose(),T=D(f)},this.onWindowResize=function(){i=e.offsetWidth,r=e.offsetHeight,a=i/r,o.setSize(i,r),s.aspect=a,s.updateProjectionMatrix(),g.left=-c/2,g.right=c/2,g.top=c/(2*a),g.bottom=-c/(2*a),g.updateProjectionMatrix()},this.render=function(){this.sceneManager.update(o),o.clear(),o.setViewport(0,0,i,r),o.render(this.sceneManager.scene,this.activeCamera)}}};Y(Ue,"DEFAULT_CAM_POSITION",new L(12,8,12));let mt=Ue;class Ft extends pn{constructor(){super()}set(e){this.notifyAllObservers(e)}update(e,n){this.notifyObserversExceptOrigin(e,n)}}const W=class W{static loadFont(e,n){const t="./";new Yt().load(t+"fonts/helvetiker_regular.typeface.json",function(i){W.font=i,n()})}constructor(e,n){const t=document.getElementById("viewport");this.viewportManager=new mt(t,this);const i=this.viewportManager;var r="";r=new URL(document.location.href).searchParams.get("sceneData"),r||(r=sessionStorage.getItem("sceneInfos"));let a=JSON.parse(r);this.scene=f(),this.currentUnit=W.DEFAULT_UNIT,this.trackingMode=W.DEFAULT_TRACKING_MODE,this.trackingMode,this.heightDetected=W.DEFAULT_DETECTION_HEIGHT,this.heightDetected,this.sceneWidth=W.DEFAULT_WIDTH,this.sceneLength=W.DEFAULT_LENGTH,this.sceneSensorHeight=ce.DEFAULT_NODE_HEIGHT,this.sceneElevation=0,this.sceneEnvironment=W.DEFAULT_ENV,this.size=160,this.wallX=u(this.size,-10,-10),this.wallY=I(this.size,-10,-10),this.floor=T(this.size,this.wallX.position.x,this.wallY.position.z);const s=new L(0,1,0),c=new L(1,0,0),g=new L(0,0,1);this.checkerboardFloor,this.checkerboardWallY,this.checkerboardWallX,this.transformControl=y(),this.objects=new He(this,e),this.augmentaSceneLoaded=!1,this.initScene=function(l,D,w){const b=new cn(16777215,.5);this.scene.add(b),this.scene.add(l),this.scene.add(D),this.scene.add(w);const _=B();this.scene.add(_);const m=p();this.scene.add(m)},this.initAugmentaScene=function(){this.checkerboardFloor=new rt(this.floor,this.currentUnit,this.sceneElevation,this.sceneWidth,this.sceneLength),this.checkerboardFloor.addToScene(this.scene),this.checkerboardWallY=new rt(this.wallY,this.currentUnit,this.sceneElevation,this.sceneWidth,this.sceneLength),this.transformControl&&this.scene.add(this.transformControl),this.augmentaSceneLoaded=!0,console.log("Augmenta scene loaded"),this.objects.initObjects(),this.trackingModeObservable=new Ft,this.trackingModeObservable.addObserver(n.changeTrackingMode),this.trackingModeObservable.addObserver(n.popup.setTrackingMode);const l=this.changeTrackingMode.bind(this);this.trackingModeObservable.addObserver(l),this.heightDetectedObservable=new Ft,this.heightDetectedObservable.addObserver(n.changeHeightDetected),this.heightDetectedObservable.addObserver(n.popup.setHeightDetected);const D=this.changeHeightDetected.bind(this);this.heightDetectedObservable.addObserver(D),a?(a.trackingMode?this.trackingModeObservable.set(a.trackingMode):this.trackingModeObservable.set(W.DEFAULT_TRACKING_MODE),a.heightDetected?this.heightDetectedObservable.set(a.heightDetected):this.heightDetectedObservable.set(W.DEFAULT_DETECTION_HEIGHT)):(this.trackingModeObservable.set(W.DEFAULT_TRACKING_MODE),this.heightDetectedObservable.set(W.DEFAULT_DETECTION_HEIGHT))};function f(){const l=new ln;return l.background=new Ce(2236962),l}function T(l,D,w){const b=new Ie({side:Ne,color:5592405}),_=new fe(l+.02,l+.02),m=new x(_,b);return m.position.set(l/2+D,-.01,l/2+w),m.rotation.x=-Math.PI/2,m}function u(l,D,w){const b=new Ie({color:13421772}),_=new fe(l+.02,l+.02),m=new x(_,b);return m.position.set(D,l/2,l/2+w),m.rotation.y=Math.PI/2,m}function I(l,D,w){const b=new Ie({color:11184810}),_=new fe(l+.02,l+.02),m=new x(_,b);return m.position.set(l/2+w,l/2,D),m}function B(){const l=new dn(1);return l.position.set(.01,.01,.01),l.setColors(new Ce(12535623),new Ce(7376560),new Ce(3646602)),l}function p(){const l=new hn(2e3,2e3,4473924,4473924);return l.position.y=-.001,l}function y(){const l=new fn(i.activeCamera,i.renderer.domElement);return l.addEventListener("change",()=>i.render()),l.addEventListener("dragging-changed",function(D){i.orbitControls.enabled=!D.value}),l}this.toggleUnit=function(l=this.currentUnit.value===Ge.meters.value?Ge.feets:Ge.meters){this.augmentaSceneLoaded&&(this.checkerboardFloor.toggleUnit(l),this.checkerboardWallY.toggleUnit(l)),document.querySelectorAll("[data-unit]").forEach(m=>{m.tagName==="INPUT"&&m.value?m.value=Math.round(m.value/this.currentUnit.value*l.value*100)/100:m.innerHTML=Math.round(m.innerHTML/this.currentUnit.value*l.value*100)/100,m.dataset.unit=l.value}),document.querySelectorAll("[data-unittext]").forEach(m=>{m.dataset.unittext=l.value,m.innerHTML=l.label});const b=document.getElementById("toggle-unit-button-"+this.currentUnit.label);b&&b.classList.remove("bold-font"),b&&b.classList.add("normal-font");const _=document.getElementById("toggle-unit-button-"+l.label);_&&_.classList.remove("normal-font"),_&&_.classList.add("bold-font"),this.currentUnit=l,this.objects.populateStorage()},this.updateFloorAugmentaSceneBorder=function(l,D){if(l&&D){const w=parseFloat(l)/this.currentUnit.value,b=parseFloat(D)/this.currentUnit.value;this.sceneWidth=w,this.sceneLength=b,this.augmentaSceneLoaded&&this.checkerboardFloor.setSize(w,b),this.objects.calculateScenePolygon(w,b),this.objects.populateStorage()}},this.updateWallYAugmentaSceneBorder=function(l,D){if(l&&D){const w=parseFloat(l)/this.currentUnit.value,b=parseFloat(D)/this.currentUnit.value;this.sceneWidth=w,this.sceneLength=b,this.augmentaSceneLoaded&&this.checkerboardWallY.setSize(w,b),this.objects.populateStorage()}},this.changeTrackingMode=function(l,D=!0){if(this.trackingMode=l,!D)return;switch(l){case"hand-tracking":this.sceneElevation=W.TABLE_ELEVATION,this.augmentaSceneLoaded&&(this.sceneWidth=this.checkerboardFloor.width,this.sceneLength=this.checkerboardFloor.height,w(this.scene,[this.checkerboardWallY],[this.checkerboardFloor],[this.sceneElevation])),this.wallY.position.z=-10;break;case"wall-tracking":this.sceneElevation=0,this.augmentaSceneLoaded&&(this.sceneWidth=this.checkerboardWallY.width,this.sceneLength=this.checkerboardWallY.height,console.log("Changing surface"),w(this.scene,[this.checkerboardFloor],[this.checkerboardWallY],[this.sceneElevation])),this.wallY.position.z=0;break;case"human-tracking":default:this.sceneElevation=0,this.augmentaSceneLoaded&&(this.sceneWidth=this.checkerboardFloor.width,this.sceneLength=this.checkerboardFloor.height,w(this.scene,[this.checkerboardWallY],[this.checkerboardFloor],[this.sceneElevation])),this.wallY.position.z=-10;break}this.objects.changeSensorsTrackingMode(l),this.objects.populateStorage();function w(b,_,m,P){m.length!==P.length&&console.error("Your sceneElevations array indicates elevations for the checkerboards of your to toAdd array. They must be the same size."),_.forEach(E=>E.removeFromScene(b));for(let E=0;E<m.length;E++)m[E].addToScene(b),m[E].setSceneElevation(P[E])}},this.changeHeightDetected=function(l){this.heightDetected=l,this.objects.populateStorage()},this.changeEnvironment=function(l=this.sceneEnvironment==="indoor"?"outdoor":"indoor"){this.sceneEnvironment=l,this.objects.populateStorage()},this.drawProjection=function(l){this.scene.remove(l.areaCoveredFloor),this.scene.remove(l.areaCoveredAbove),this.scene.remove(l.areaCoveredWallX),this.scene.remove(l.areaCoveredWallY);const D=new Ze(s,-this.sceneElevation),w=new Ze(s,-(this.sceneElevation+this.heightDetected)),b=new Ze(c,-this.wallX.position.x),_=new Ze(g,-this.wallY.position.z);if(l.areaAppear){const m=[],P=[],E=[],M=[],v=new xt;v.setFromProjectionMatrix(l.cameraPerspective.projectionMatrix);for(let N=0;N<6;N++){const ye=v.planes[N].applyMatrix4(l.cameraPerspective.matrixWorld),Te=Pe(ye,D);Te!==-1&&m.push(Te);const oe=Pe(ye,w);oe!==-1&&P.push(oe);const j=Pe(ye,b);j!==-1&&E.push(j);const ue=Pe(ye,_);ue!==-1&&M.push(ue)}const S=Pe(D,b),F=Pe(b,_),O=Pe(D,_);S!==-1&&(m.push(S),E.push(S)),F!==-1&&(E.push(F),M.push(F)),O!==-1&&(m.push(O),M.push(O));const Q=A(m),te=A(P),J=A(E),Be=A(M),$=new xt;$.setFromProjectionMatrix(l.cameraPerspective.projectionMatrix);for(let N=0;N<6;N++)$.planes[N].applyMatrix4(l.cameraPerspective.matrixWorld),$.planes[N].constant+=.01;const ke=Q.filter(N=>$.containsPoint(N)&&N.x>this.wallX.position.x-.01&&N.z>this.wallY.position.z-.01&&N.y>this.sceneElevation-.01),Re=J.filter(N=>$.containsPoint(N)&&N.x>this.wallX.position.x-.01&&N.z>this.wallY.position.z-.01&&N.y>this.sceneElevation-.01),De=Be.filter(N=>$.containsPoint(N)&&N.x>this.wallX.position.x-.01&&N.z>this.wallY.position.z-.01&&N.y>this.sceneElevation-.01);let ne=te.filter(N=>$.containsPoint(N));if(ne.forEach(N=>N.y-=this.heightDetected),ke.length>2&&ne.length>2){const N=[...P];N.forEach(j=>j.origin.y-=this.heightDetected);const ye=m.concat(N),Te=A(ye).filter(j=>$.containsPoint(j)),oe=ne.concat(Te);oe.sort((j,ue)=>ue.length()-j.length()),k(oe,s);for(let j=0;j<oe.length-1;j++)oe[j].distanceTo(oe[j+1])<.01&&(oe.splice(j,1),j--);ne=oe.filter(j=>{const ue=j.clone();return ue.y+=this.heightDetected,$.containsPoint(j)&&$.containsPoint(ue)&&j.x>this.wallX.position.x-.01&&j.y>this.sceneElevation-.01&&j.z>this.wallY.position.z-.01})}else ne=[];k(ke,s),k(ne,s),k(Re,c),k(De,g),l.coveredPointsAbove=ne,ke.forEach(N=>N.y+=.01*(l.id/this.objects.getNbNodes()+1)),ne.forEach(N=>N.y+=.01+.01*(l.id/this.objects.getNbNodes()+1)),Re.forEach(N=>N.x+=.01*(l.id/this.objects.getNbNodes()+1)),De.forEach(N=>N.z+=.01*(l.id/this.objects.getNbNodes()+1));const Je=l.areaValue;if(l.areaValue=U(ne,this.currentUnit.value),ne.length>2){const N=z(ne);l.changeTextPosition(N,this.currentUnit.value),Je!=l.areaValue&&l.updateAreaText(this.currentUnit)}else l.changeTextPosition(l.cameraPerspective.position.clone(),this.currentUnit.value),l.nameText.scale.set(ce.SIZE_TEXT_NODE/1.7/l.nameText.geometry.parameters.options.size,ce.SIZE_TEXT_NODE/1.7/l.nameText.geometry.parameters.options.size,1),l.areaValueText.visible=!1;l.areaCoveredFloor.geometry.dispose(),l.areaCoveredFloor.material.dispose(),l.areaCoveredAbove.geometry.dispose(),l.areaCoveredAbove.material.dispose(),l.areaCoveredWallX.geometry.dispose(),l.areaCoveredWallX.material.dispose(),l.areaCoveredWallY.geometry.dispose(),l.areaCoveredWallY.material.dispose(),l.areaCoveredFloor=C(ke,125269879),l.areaCoveredAbove=C(ne),l.areaCoveredWallX=C(Re),l.areaCoveredWallY=C(De),this.scene.add(l.areaCoveredFloor),this.scene.add(l.areaCoveredAbove),this.scene.add(l.areaCoveredWallX),this.scene.add(l.areaCoveredWallY)}};function A(l){const D=[];for(let w=0;w<l.length-1;w++){const b=l[w];for(let _=w+1;_<l.length;_++){const m=l[_],P=xn(b,m);P!=-1&&D.push(P)}}return D}function k(l,D){if(l.length>2){const w=z(l),b=new L;b.subVectors(l[0],w);const _=b.clone();_.applyAxisAngle(D,Math.PI/2),l.sort((m,P)=>{const E=new L;E.subVectors(m,w);const M=new L;M.subVectors(P,w);const v=Math.abs(_.dot(E))>.001?_.dot(E):1,S=Math.abs(_.dot(M))>.001?_.dot(M):1;return Math.abs(S)/S*b.angleTo(M)-Math.abs(v)/v*b.angleTo(E)})}}function U(l,D){let w=0;for(let b=1;b<l.length-1;b++){const _=new L().subVectors(l[b],l[0]),m=new L().subVectors(l[b+1],l[0]),P=.5*_.cross(m).length();w+=P}return w*(D*D)}function z(l){let D=new L;return l.length!==0&&(l.forEach(w=>D.add(w)),D.divideScalar(l.length)),D}function C(l,D=3680609){const w=new at,b=[];for(let E=1;E<l.length-1;E++)b.push(l[E+1].x),b.push(l[E+1].y),b.push(l[E+1].z),b.push(l[E].x),b.push(l[E].y),b.push(l[E].z),b.push(l[0].x),b.push(l[0].y),b.push(l[0].z);const _=new Float32Array(b);w.setAttribute("position",new jt(_,3));const m=new Ae({side:Ne,color:D,transparent:!0,opacity:.6,alphaTest:.5});return new x(w,m)}this.update=function(){this.objects.update()},this.initScene(this.floor,this.wallX,this.wallY),this.debug=function(){this.objects.debug()}}};Y(W,"font"),Y(W,"DEFAULT_UNIT",Ge.meters),Y(W,"DEFAULT_TRACKING_MODE","human-tracking"),Y(W,"DEFAULT_DETECTION_HEIGHT",1.2),Y(W,"DEFAULT_WIDTH",5),Y(W,"DEFAULT_LENGTH",5),Y(W,"DEFAULT_ENV","indoor"),Y(W,"TABLE_ELEVATION",.75),Y(W,"HAND_TRACKING_OVERLAP_HEIGHT",.25);let G=W;function Pe(h,e){if(h.normal.length()<.001||e.normal.length()<.001)return console.error("invalid parameters : one of the plane's normal is zero Vector"),-1;const n=h.normal.x,t=h.normal.y,i=h.normal.z,r=h.constant,o=e.normal.x,a=e.normal.y,s=e.normal.z,c=e.constant,g=new L().crossVectors(h.normal,e.normal);if(g.length()<.001)return-1;if(Math.abs(n)>.001)return Math.abs(n*a-o*t)>.001?f("abc"):Math.abs(n*s-o*i)>.001?f("acb"):(console.error("There is a mathematical incoherence in the code"),-1);return Math.abs(t)>.001?Math.abs(t*s-a*i)>.001?f("bca"):Math.abs(t*o-a*n)>.001?f("bac"):(console.error("There is a mathematical incoherence in the code"),-1):Math.abs(i)>.001?Math.abs(i*o-s*n)>.001?f("cab"):Math.abs(i*a-s*t)>.001?f("cba"):(console.error("There is a mathematical incoherence in the code"),-1):(console.error("invalid parameters : one of the plane's normal is zero vector"),-1);function f(u){switch(u){case"abc":{const I=T(n,o,t,a,i,s,u);return new ze(I,g.normalize())}case"acb":{const I=T(n,o,i,s,t,a,u);return new ze(I,g.normalize())}case"bca":{const I=T(t,a,i,s,n,o,u);return new ze(I,g.normalize())}case"bac":{const I=T(t,a,n,o,i,s,u);return new ze(I,g.normalize())}case"cab":{const I=T(i,s,n,o,t,a,u);return new ze(I,g.normalize())}case"cba":{const I=T(i,s,t,a,n,o,u);return new ze(I,g.normalize())}default:return console.error("getInteresectionRay: the 'mode' argument is not valid"),-1}}function T(u,I,B,p,y,A,k,U=0){const z=U,C=((I*y-u*A)*z+(I*r-u*c))/(u*p-I*B),l=(-B*C-y*z-r)/u;switch(k){case"abc":return new L(l,C,z);case"acb":return new L(l,z,C);case"bca":return new L(z,l,C);case"bac":return new L(C,l,z);case"cab":return new L(C,z,l);case"cba":return new L(z,C,l);default:return console.error("calculatePointsOnIntersectionRayCoordinates: the 'mode' argument is not valid"),-1}}}function xn(h,e){const n=h.origin,t=h.direction,i=e.origin,r=e.direction;if(new L().crossVectors(t,r).length()<.001)return-1;const a=new Ze().setFromCoplanarPoints(n,new L().addVectors(n,t),new L().addVectors(i,r));if(Math.abs(a.distanceToPoint(i))>.001)return-1;const s=new L;if(Math.abs(r.x)>.001)if(Math.abs(r.x*t.y-r.y*t.x)>.001){const c=1/(r.x*t.y-r.y*t.x)*(r.y*(n.x-i.x)+r.x*(i.y-n.y));return h.at(c,s),s}else if(Math.abs(r.x*t.z-r.z*t.x)>.001){const c=1/(r.x*t.z-r.z*t.x)*(r.z*(n.x-i.x)+r.x*(i.z-n.z));return h.at(c,s),s}else return console.error("There is a mathematical incoherence in the code"),-1;else if(r.y!=0)if(Math.abs(r.y*t.z-r.z*t.y)>.001){const c=1/(r.y*t.z-r.z*t.y)*(r.z*(n.y-i.y)+r.y*(i.z-n.z));return h.at(c,s),s}else if(Math.abs(r.y*t.x-r.x*t.y)>.001){const c=1/(r.y*t.x-r.x*t.y)*(r.x*(n.y-i.y)+r.y*(i.x-n.x));return h.at(c,s),s}else return console.error("There is a mathematical incoherence in the code"),-1;else if(r.z!=0)if(Math.abs(r.z*t.x-r.x*t.z)>.001){const c=1/(r.z*t.x-r.x*t.z)*(r.x*(n.z-i.z)+r.z*(i.x-n.x));return h.at(c,s),s}else if(Math.abs(r.z*t.y-r.y*t.z)>.001){const c=1/(r.z*t.y-r.y*t.z)*(r.y*(n.z-i.z)+r.z*(i.y-n.y));return h.at(c,s),s}else return console.error("There is a mathematical incoherence in the code"),-1;else return console.error("invalid parameters : one of the rays direction is zero vector"),-1}function zt(h,e,n,t){return h<=n&&h>=e+t}function Ct(h,e,n){const t=ie.DEFAULT_RATIO_FAR_MINDIST*ie.DEFAULT_RATIO_FAR_MINDIST;return e<=Math.sqrt(1-1/(4*t))*n||h<=2*n*Math.abs(Math.sin(ie.DEFAULT_MIN_ANGLE_TO_AVOID_OBSTRUCTION))}function Ut(h,e){if(h.length>0){const n=[...h];return e==="hand-tracking"?(n.sort((t,i)=>i.handFar-t.handFar),n[0].handFar):(n.sort((t,i)=>i.rangeFar-t.rangeFar),n[0].rangeFar)}return 0}function Pn(h){if(h.length>0){const e=[...h];return e.sort((n,t)=>n.rangeNear-t.rangeNear),e[0].rangeNear}return 0}function Sn(h,e,n){const t=ie.DEFAULT_RATIO_FAR_MINDIST*ie.DEFAULT_RATIO_FAR_MINDIST;if(n<=Math.sqrt(1-1/(4*t))*h.rangeFar){const i=2*Math.sqrt(h.rangeFar*h.rangeFar-n*n),r=Math.ceil(e/i),o=[],a=Math.max(e/r,h.rangeFar/ie.DEFAULT_RATIO_FAR_MINDIST),s=(e-a*(r-1))/2;for(let c=0;c<r;c++)o.push(new V(s+c*a,n));return{typeID:h.id,positions:o}}else if(e<=2*h.rangeFar*Math.abs(Math.sin(ie.DEFAULT_MIN_ANGLE_TO_AVOID_OBSTRUCTION))){const i=ie.DEFAULT_MIN_ANGLE_TO_AVOID_OBSTRUCTION;if(Math.abs(i%Math.PI)<.001)return{typeID:h.id,positions:[new V(0,1),new V(e,1)]};if(Math.abs(i%(Math.PI/2))>.001){const r=Math.sqrt(h.rangeFar*h.rangeFar-e/2*(e/2)),o=ie.DEFAULT_MIN_ANGLE_TO_AVOID_OBSTRUCTION%Math.PI/2!==0?e/(2*Math.tan(ie.DEFAULT_MIN_ANGLE_TO_AVOID_OBSTRUCTION)):0,a=(r+o)/2;return{typeID:h.id,positions:[new V(0,a),new V(e,a)]}}}return!1}function Mn(h,e,n,t,i,r){let o=0;switch(h){case"hand-tracking":o=e.handFar;break;case"human-tracking":default:o=e.rangeFar;break}if(i<=o&&i>=e.rangeNear+r){const a=Math.abs(Math.tan(e.HFov/2*Math.PI/180))*(i-r)*2,s=Math.abs(Math.tan(e.VFov/2*Math.PI/180))*(i-r)*2,c=Math.ceil(n/a)*Math.ceil(t/s);return Math.ceil(n/s)*Math.ceil(t/a)<c?{typeID:e.id,w:s,h:a,nbW:Math.ceil(n/s),nbH:Math.ceil(t/a),rot:!0}:{typeID:e.id,w:a,h:s,nbW:Math.ceil(n/a),nbH:Math.ceil(t/s),rot:!1}}return!1}function An(h,e,n,t,i,r){let o=h.w/2,a=h.h/2;h.nbW===1&&(o-=(h.nbW*h.w-n)/2),h.nbH===1&&(a-=(h.nbH*h.h-t)/2);const s=h.nbW>1?(h.nbW*h.w-n)/(h.nbW-1):0,c=h.nbH>1?(h.nbH*h.h-t)/(h.nbH-1):0;for(let g=0;g<h.nbW;g++)for(let f=0;f<h.nbH;f++)h.rot?r.objects.addNode(!0,e,h.typeID,o+g*(h.w-s),a+f*(h.h-c),i,0,0,Math.PI/2):r.objects.addNode(!0,e,h.typeID,o+g*(h.w-s),a+f*(h.h-c),i)}function Bn(h,e){for(let n=0;n<h.positions.length;n++)e.objects.addLidar(!0,h.typeID,h.positions[n].x,h.positions[n].y)}class kn{constructor(e){this.trackingMode="human-tracking";let n=this.trackingMode;this.heightDetected=1.2;let t=this.heightDetected;this.givenWidth=0;let i=this.givenWidth;this.givenLength=0;let r=this.givenLength;this.givenHeight=0;let o=this.givenHeight;this.sensorsCompatible=[];let a=this.sensorsCompatible;this.usedSensor=void 0;let s=this.usedSensor;window.addEventListener("resize",c);function c(){document.getElementById("popup").classList.add("column"),document.getElementById("tracking-mode-selection-builder").classList.add("row"),document.getElementById("hardware-sensors-selection").classList.add("row"),document.getElementById("my-system-section-builder").classList.add("row")}c(),g();function g(){const m=sessionStorage.getItem("builderStep");if(m){if(f(),document.getElementById("popup").classList.remove("is-visible"),m<=0)return;if(p(),m<=1){document.getElementById("setup-content").classList.add("hidden"),document.getElementById("dimensions-content").classList.remove("hidden"),document.getElementById("dimensions-tab").classList.add("passed-tab");return}else y(),k(),D();if(m<=2){document.getElementById("setup-content").classList.add("hidden"),document.getElementById("hardware-content").classList.remove("hidden"),document.getElementById("dimensions-tab").classList.add("passed-tab"),document.getElementById("hardware-tab").classList.add("passed-tab");return}else w(),_();if(m<=3){document.getElementById("setup-content").classList.add("hidden"),document.getElementById("my-system-content").classList.remove("hidden"),document.getElementById("dimensions-tab").classList.add("passed-tab"),document.getElementById("hardware-tab").classList.add("passed-tab"),document.getElementById("my-system-tab").classList.add("passed-tab");return}}else sessionStorage.setItem("builderStep",0)}this.setTrackingMode=function(m){switch(n=m,n){case"wall-tracking":document.getElementById("setup-target-overlap-wall").classList.remove("hidden"),document.getElementById("setup-target-overlap-table").classList.add("hidden"),document.getElementById("setup-target-overlap").classList.add("hidden");break;case"hand-tracking":document.getElementById("setup-target-overlap-table").classList.remove("hidden"),document.getElementById("setup-target-overlap").classList.add("hidden"),document.getElementById("setup-target-overlap-wall").classList.add("hidden"),e.heightDetectedObservable.set(.25);break;case"human-tracking":document.getElementById("setup-target-overlap").classList.remove("hidden"),document.getElementById("setup-target-overlap-wall").classList.add("hidden"),document.getElementById("setup-target-overlap-table").classList.add("hidden");break}},this.setHeightDetected=function(m){t=m,n=="human-tracking"&&(document.getElementById("overlap-height-selection-popup").value=t)};function f(){const m=sessionStorage.getItem("sceneInfos");m&&(n=JSON.parse(m).trackingMode);const P=document.getElementsByName("tracking-mode-selection-builder");for(let E=0;E<P.length;E++)P[E].checked=P[E].value===(n||"human-tracking")}const T=document.getElementsByName("tracking-mode-selection-builder");for(let m=0;m<T.length;m++)T[m].addEventListener("click",()=>{T[m].value,e.trackingModeObservable.set(T[m].value),B()});document.getElementById("overlap-height-selection-popup").addEventListener("change",()=>{e.heightDetectedObservable.set(parseFloat(document.getElementById("overlap-height-selection-popup").value))}),document.getElementById("next-button-setup").addEventListener("click",()=>{const m=document.getElementsByName("tracking-mode-selection-builder");for(let E=0;E<m.length;E++)if(m[E].checked){n=m[E].value;break}if(!n){document.getElementById("setup-warning-message").classList.remove("hidden");return}["human-tracking","hand-tracking","wall-tracking"].includes(n)&&(p(),document.getElementById("setup-content").classList.add("hidden"),document.getElementById("dimensions-content").classList.remove("hidden"),document.getElementById("dimensions-tab").classList.add("passed-tab"),sessionStorage.setItem("builderStep",1))}),document.getElementById("dimensions-need-something-different-button").addEventListener("click",()=>{});function u(){i=void 0,r=void 0,o=void 0,document.getElementById("dimensions-length").classList.remove("hidden"),document.getElementById("dimensions-distance-text-default").classList.remove("hidden"),document.getElementById("dimensions-distance-text-hand-tracking").classList.add("hidden"),document.getElementById("dimensions-distance-text-wall-tracking").classList.add("hidden"),document.getElementById("dimensions-distance-input").placeholder="Sensor height",document.getElementById("dimensions-warning-message").classList.add("hidden")}document.getElementById("dimensions-width-input").addEventListener("change",I),document.getElementById("dimensions-length-input").addEventListener("change",I),document.getElementById("dimensions-distance-input").addEventListener("change",I),document.getElementById("sensor-height-infos").addEventListener("mouseover",m=>{const P=document.getElementById("sensor-height-infos-text");P.style.left=(m.clientX-180).toString()+"px",P.style.top=(m.clientY-130).toString()+"px",P.classList.remove("hidden")}),document.getElementById("sensor-height-infos").addEventListener("mouseleave",()=>document.getElementById("sensor-height-infos-text").classList.add("hidden"));function I(){const m=parseFloat(document.getElementById("dimensions-width-input").value),P=parseFloat(document.getElementById("dimensions-length-input").value),E=parseFloat(document.getElementById("dimensions-distance-input").value),M=Math.floor(parseFloat(m)/e.currentUnit.value*100)/100;Math.floor(parseFloat(P)/e.currentUnit.value*100)/100;const v=Math.floor(parseFloat(E)/e.currentUnit.value*100)/100;if(n==="wall-tracking"&&m&&E){if(m>0&&E>0)return document.getElementById("dimensions-negative-values-warning").classList.add("hidden"),Ct(M,v,Ut(we().filter(S=>S.recommended),n))?(e.updateWallYAugmentaSceneBorder(m,E),document.getElementById("input-wall-y-scene-width-inspector").value=m,document.getElementById("input-wall-y-scene-height-inspector").value=E,document.getElementById("dimensions-warning-message").classList.add("hidden"),document.getElementById("scene-size-text-div").innerHTML='<h3 id="scene-size-text">Scene size: <span data-unit=1>'+m+"</span>x<span data-unit=1>"+E+'</span><span data-unittext="1">m</span></h3>',!0):(B(),document.getElementById("dimensions-warning-message").classList.remove("hidden"),!1);B(),document.getElementById("dimensions-negative-values-warning").classList.remove("hidden")}else if(m&&P&&(m>0&&P>0?(document.getElementById("dimensions-negative-values-warning").classList.add("hidden"),e.updateFloorAugmentaSceneBorder(m,P),document.getElementById("input-scene-width-inspector").value=m,document.getElementById("input-scene-length-inspector").value=P):(B(),document.getElementById("dimensions-negative-values-warning").classList.remove("hidden")),v>0)){const S=be().filter(te=>te.recommended),F=n==="human-tracking"?G.DEFAULT_DETECTION_HEIGHT:G.HAND_TRACKING_OVERLAP_HEIGHT,O=Ut(S,n),Q=Pn(S);if(zt(v,F,O,Q))return document.getElementById("warning-hook-height")&&document.getElementById("surface-warning-message").classList.add("hidden"),document.getElementById("input-scene-sensor-height-inspector").value=E,document.getElementById("scene-size-text-div").innerHTML='<h3 id="scene-size-text">Scene size: <span data-unit=1>'+m+"</span>x<span data-unit=1>"+P+'</span><span data-unittext="1">m</span> with a sensor height of <span data-unit="1">'+E+'</span><span data-unittext="1">m</span></h3>',!0;if(!document.getElementById("warning-hook-height")){const J=document.createElement("p");J.classList.add("warning-text"),J.id="warning-hook-height",J.innerHTML="The camera(s) you chose cannot see your tracking surface at this distance (min = <span data-unit="+e.currentUnit.value+">"+Math.round((Q+F)*e.currentUnit.value*100)/100+"</span> <span data-unittext="+e.currentUnit.label+">"+e.currentUnit.label+"</span>, max = <span data-unit="+e.currentUnit.value+">"+Math.round(O*e.currentUnit.value*100)/100+"</span> <span data-unittext="+e.currentUnit.label+">"+e.currentUnit.label+"</span>)",document.getElementById("surface-warning-message").appendChild(J)}return B(),document.getElementById("surface-warning-message").classList.remove("hidden"),!1}return!1}function B(){document.getElementById("dimensions-negative-values-warning").classList.add("hidden"),document.getElementById("dimensions-warning-message").classList.add("hidden"),document.getElementById("surface-warning-message").classList.add("hidden"),document.getElementById("dimensions-no-value-warning").classList.add("hidden")}function p(){if(n==="hand-tracking"&&(document.getElementById("dimensions-distance-text-default").classList.add("hidden"),document.getElementById("dimensions-distance-text-hand-tracking").classList.remove("hidden")),n==="wall-tracking"&&(document.getElementById("dimensions-length").classList.add("hidden"),document.getElementById("dimensions-distance-text-default").classList.add("hidden"),document.getElementById("dimensions-distance-text-wall-tracking").classList.remove("hidden"),document.getElementById("dimensions-distance-input").placeholder="Height"),n){const m=sessionStorage.getItem("sceneInfos");if(m){const P=JSON.parse(m).sceneSize;switch(n){case"wall-tracking":document.getElementById("dimensions-width-input").value=Math.floor(P[0]*e.currentUnit.value*100)/100,document.getElementById("dimensions-distance-input").value=Math.floor(P[1]*e.currentUnit.value*100)/100;break;case"hand-tracking":case"human-tracking":document.getElementById("dimensions-width-input").value=Math.floor(P[0]*e.currentUnit.value*100)/100,document.getElementById("dimensions-length-input").value=Math.floor(P[1]*e.currentUnit.value*100)/100;const E=JSON.parse(m).objects.nodes;E.length>0?document.getElementById("dimensions-distance-input").value=Math.floor((E[0].p_z-(n==="hand-tracking"?2.5:0))*e.currentUnit.value*100)/100:document.getElementById("dimensions-distance-input").value="";break}}}}function y(){i=Math.floor(parseFloat(document.getElementById("dimensions-width-input").value)/e.currentUnit.value*100)/100,r=Math.floor(parseFloat(document.getElementById("dimensions-length-input").value)/e.currentUnit.value*100)/100,o=Math.floor(parseFloat(document.getElementById("dimensions-distance-input").value)/e.currentUnit.value*100)/100}document.getElementById("next-button-dimensions").addEventListener("click",()=>{B(),document.getElementById("dimensions-no-value-warning").classList.remove("hidden"),I()&&(y(),!(n!=="wall-tracking"&&(!i||!r||!o)||n==="wall-tracking"&&(!i||!o))&&(n!=="wall-tracking"&&(i<=0||r<=0||o<=0)||n==="wall-tracking"&&(i<=0||o<=0)||(B(),k(),l(),document.getElementById("dimensions-content").classList.add("hidden"),document.getElementById("hardware-content").classList.remove("hidden"),document.getElementById("hardware-tab").classList.add("passed-tab"),sessionStorage.setItem("builderStep",2))))}),document.getElementById("previous-button-dimensions").addEventListener("click",()=>{u(),document.getElementById("dimensions-content").classList.add("hidden"),document.getElementById("setup-content").classList.remove("hidden"),document.getElementById("dimensions-tab").classList.remove("passed-tab"),sessionStorage.setItem("builderStep",0)}),document.getElementById("hardware-need-something-different-button").addEventListener("click",()=>{}),document.getElementById("toggle-outdoor-indoor").addEventListener("change",()=>{let m=document.getElementById("toggle-outdoor-indoor").checked,P;m?P="OUTDOOR":P="INDOOR",document.getElementById("button-toggle-text").innerHTML=P});function A(){s=void 0,a.length=0,We(document.getElementById("hardware-sensors-selection")),We(document.getElementById("multi-select-sensors")),document.getElementById("hardware-input-radio-indoor").checked=!0,document.getElementById("hardware-input-radio-outdoor").checked=!1,document.getElementById("hardware-warning-message").classList.add("hidden")}function k(){if(n==="wall-tracking"?we().filter(M=>M.recommended).forEach(M=>{Ct(i,o,M.rangeFar)&&a.push(M)}):be().filter(M=>M.recommended).forEach(M=>{const v=n==="human-tracking"?t:G.HAND_TRACKING_OVERLAP_HEIGHT;zt(o,v,n==="hand-tracking"?M.handFar:M.rangeFar,M.rangeNear)&&a.push(M)}),a.length===0)return;const m=document.getElementById("multi-select-sensors");a.forEach(M=>{const v=document.createElement("option");v.id=M.textId,v.value=M.textId;const S=Math.floor(M.rangeNear*e.currentUnit.value*100)/100,F=Math.floor((n==="hand-tracking"?M.handFar:M.rangeFar)*e.currentUnit.value*100)/100;v.innerHTML="<p>"+M.niceName+" (<span data-unit="+e.currentUnit.value+">"+S+"</span> - <span data-unit="+e.currentUnit.value+">"+F+"</span><span data-unittext="+e.currentUnit.value+">"+e.currentUnit.label+"</span>)</p>",m.appendChild(v)}),U(m.children);const P=sessionStorage.getItem("sceneInfos");let E;P?E=JSON.parse(P).sceneEnvironment:(document.getElementById("toggle-outdoor-indoor").checked?E="outdoor":E="indoor",C(E))}function U(m){const P=document.getElementById("toggle-outdoor-indoor");P.addEventListener("change",()=>{let E;P.checked?E="outdoor":E="indoor",C(E),e.changeEnvironment(E)}),document.getElementById("multi-select-sensors").addEventListener("change",()=>{z()})}function z(){const m=document.getElementById("multi-select-sensors").value;switch(n){case"wall-tracking":{const P=we().find(M=>M.textId===m),E=Sn(P,i,o);if(!E){console.error("no config found with this setup");return}e.objects.removeSensors(),Bn(E,e);break}case"human-tracking":case"hand-tracking":{const P=be().find(v=>v.textId===m),E=n==="human-tracking"?t:G.HAND_TRACKING_OVERLAP_HEIGHT,M=Mn(n,P,i,r,o,E);if(!M){console.error("no config found with this setup");return}e.objects.removeSensors(),An(M,n,i,r,o+e.sceneElevation,e);break}}}function C(m){let P=0;a.forEach(E=>{E.canBeUsed.includes(m)?document.getElementById(E.textId).classList.remove("hidden"):(document.getElementById(E.textId).classList.add("hidden"),P++)}),a.length===P?document.getElementById("hardware-warning-message").classList.remove("hidden"):(document.getElementById("hardware-warning-message").classList.add("hidden"),l())}function l(){const m=document.getElementById("multi-select-sensors");m.children[0]&&(m.value=m.children[0].value,z())}function D(){const m=sessionStorage.getItem("sceneInfos");if(m){const P=JSON.parse(m).objects;if(P.lidars.length>0||P.nodes.length>0){let E;switch(n){case"wall-tracking":const v=P.lidars.length>0?P.lidars[0].lidarTypeId:0;E=we().find(F=>F.id===v).textId;break;case"hand-tracking":case"human-tracking":const S=P.nodes.length>0?P.nodes[0].cameraTypeId:0;E=be().find(F=>F.id===S).textId;break}const M=document.getElementById("hardware-sensors-selection").children;for(let v=0;v<M.length;v++)if(!M[v].classList.contains("unselectable")&&M[v].querySelector("input").value===E){e.augmentaSceneLoaded&&M[v].dispatchEvent(new Event("click")),M[v].querySelector("input").checked=!0;break}}else l()}}function w(){const m=document.getElementsByName("sensor-choice");for(let P=0;P<m.length;P++)m[P].checked&&(s=be().concat(we()).find(E=>E.textId===m[P].value))}document.getElementById("next-button-hardware").addEventListener("click",()=>{document.getElementById("popup").classList.remove("is-visible")}),document.getElementById("previous-button-hardware").addEventListener("click",()=>{e.objects.removeSensors(),A(),document.getElementById("hardware-content").classList.add("hidden"),document.getElementById("dimensions-content").classList.remove("hidden"),document.getElementById("hardware-tab").classList.remove("passed-tab"),sessionStorage.setItem("builderStep",1)});function b(){We(document.getElementById("my-system-tracking-mode")),We(document.getElementById("my-system-dimensions")),We(document.getElementById("my-system-recap"))}function _(){const m=document.getElementById("tracking-mode-"+n+"-input").cloneNode(!0);m.id+="-copy",m.children[0].checked=!1,m.children[0].disabled=!0,document.getElementById("my-system-tracking-mode").appendChild(m);const P=document.getElementById("dimensions-inputs").cloneNode(!0);P.id+="copy",P.classList.remove("row"),P.classList.add("column");const E=P.getElementsByTagName("input");for(let O=0;O<E.length;O++)E[O].readOnly=!0;document.getElementById("my-system-dimensions").appendChild(P);const M=document.getElementById("my-system-recap");let v;const S=sessionStorage.getItem("sceneInfos");if(S){const O=JSON.parse(S).objects;switch(n){case"wall-tracking":v=O.lidars.length;break;case"hand-tracking":case"human-tracking":v=O.nodes.length;break}}else v=e.objects.getNbSensors();const F=document.createElement("p");F.innerHTML="x"+v+" "+s.niceName,M.appendChild(F),s.accessories.forEach(O=>{const Q=document.createElement("p");Q.innerHTML="x"+v+" "+O,M.appendChild(Q)})}document.getElementById("previous-button-my-system").addEventListener("click",()=>{b(),document.getElementById("my-system-content").classList.add("hidden"),document.getElementById("hardware-content").classList.remove("hidden"),document.getElementById("my-system-tab").classList.remove("passed-tab"),sessionStorage.setItem("builderStep",2)}),document.getElementById("finish-button-my-system").addEventListener("click",()=>{document.getElementById("popup").classList.remove("is-visible")}),document.getElementById("close-popup").addEventListener("click",()=>{document.getElementById("popup").classList.remove("is-visible")})}}function We(h){for(;h.firstChild;)h.removeChild(h.firstChild)}class Dn{constructor(){this.popup=null;var e;n(),this.bindEventListeners=function(s){this.popup=new kn(s.sceneManager);const c=document.getElementById("toggle-unit-button");c&&c.addEventListener("click",()=>s.sceneManager.toggleUnit());const g=document.getElementById("display-frustums-button");g&&g.addEventListener("click",()=>s.sceneManager.objects.displayFrustums());const f=document.getElementById("display-lidars-rays-button");f&&f.addEventListener("click",()=>s.sceneManager.objects.displayRays());const T=document.getElementById("add-node-button");T&&T.addEventListener("click",()=>s.sceneManager.objects.addNode());const u=document.getElementById("delete-all-nodes-button");u&&u.addEventListener("click",()=>s.sceneManager.objects.removeNodes());const I=document.getElementById("add-lidar-button");I&&I.addEventListener("click",()=>s.sceneManager.objects.addLidar());const B=document.getElementById("delete-all-lidars-button");B&&B.addEventListener("click",()=>s.sceneManager.objects.removeLidars());const p=document.getElementById("add-dummy-button");p&&p.addEventListener("click",()=>s.sceneManager.objects.addDummy());const y=document.getElementById("delete-all-dummies-button");y&&y.addEventListener("click",()=>s.sceneManager.objects.removeDummies()),e=s.sceneManager;const A=document.getElementById("share-modal");document.getElementById("generate-link").addEventListener("click",()=>{t(e.objects.generateLink())}),document.getElementById("copy-scene-link").addEventListener("click",()=>{t(e.objects.generateLink())}),document.getElementById("close-share-modal").addEventListener("click",()=>A.classList.add("hidden")),window.addEventListener("click",()=>{event.target==A&&A.classList.add("hidden")}),document.getElementById("load-file-input").addEventListener("change",k=>r(k,e),!1),document.getElementById("download-scene-file").addEventListener("click",()=>i(s.sceneManager)),document.getElementById("input-scene-width-inspector").addEventListener("change",()=>e.updateAugmentaSceneBorder(parseFloat(document.getElementById("input-scene-width-inspector").value),parseFloat(document.getElementById("input-scene-length-inspector").value))),document.getElementById("input-scene-length-inspector").addEventListener("change",()=>e.updateAugmentaSceneBorder(parseFloat(document.getElementById("input-scene-width-inspector").value),parseFloat(document.getElementById("input-scene-length-inspector").value))),document.getElementById("input-wall-y-scene-width-inspector").addEventListener("change",()=>e.updateWallYAugmentaSceneBorder(parseFloat(document.getElementById("input-wall-y-scene-width-inspector").value),parseFloat(document.getElementById("input-wall-y-scene-height-inspector").value))),document.getElementById("input-wall-y-scene-height-inspector").addEventListener("change",()=>e.updateWallYAugmentaSceneBorder(parseFloat(document.getElementById("input-wall-y-scene-width-inspector").value),parseFloat(document.getElementById("input-wall-y-scene-height-inspector").value))),document.getElementById("open-wizard-button").addEventListener("click",()=>{e.augmentaSceneLoaded&&document.getElementById("popup").classList.add("is-visible")})};function n(){document.getElementById("scene-file-name-input").value="",document.getElementById("overlap-height-selection-inspector").value=G.DEFAULT_DETECTION_HEIGHT,document.getElementById("input-scene-width-inspector").value=G.DEFAULT_WIDTH,document.getElementById("input-scene-length-inspector").value=G.DEFAULT_LENGTH,document.getElementById("input-wall-y-scene-width-inspector").value=G.DEFAULT_WIDTH,document.getElementById("input-wall-y-scene-height-inspector").value=G.DEFAULT_LENGTH,document.getElementById("input-scene-sensor-height-inspector").value=ce.DEFAULT_NODE_HEIGHT,document.getElementById("scene-size-text-div").innerHTML='<h3 id="scene-size-text">Scene size: <span data-unit=1>'+G.DEFAULT_WIDTH+"</span>x<span data-unit=1>"+G.DEFAULT_LENGTH+'</span><span data-unittext="1">m</span> with a sensor height of <span data-unit="1">'+ce.DEFAULT_NODE_HEIGHT+'</span><span data-unittext="1">m</span></h3>'}function t(s){navigator.clipboard.writeText(s),document.getElementById("share-modal").classList.remove("hidden")}function i(s){const c=document.getElementById("scene-file-name-input");if(console.log("downloading..."),c&&c.value){console.log("file name ok");const g=["*",".",'"',"/","\\","[","]",":",";","|",",","?","<",">"],f=c.value.toString();for(let I=0;I<g.length;I++){const B=g[I];if(f.includes(B)){document.getElementById("warning-text-input-illegal-symbol").classList.remove("hidden"),document.getElementById("illegal-symbol-used").innerHTML=B;return}}console.log("file name ok ok");const T=s.objects.generateJson(),u=new Blob([T],{type:"application/json"});saveAs(u,f+".builder"),document.getElementById("warning-text-input-illegal-symbol").classList.add("hidden")}}function r(s,c){const g=s.target.files[0];if(!g)return;if(console.log(g),g.type!=="application/json"&&g.name.split(".")[1]!="builder"){alert('Invalid file. Your file must end with ".json"');return}const f=new FileReader;f.onload=function(T){const u=T.target.result;c.objects.removeSensors(),c.objects.parseJson(u)},f.readAsText(g)}this.changeTrackingMode=function(s){switch(document.getElementById("tracking-img").src="img/"+String(s)+".png",s){case"hand-tracking":document.getElementById("coverage-section").classList.remove("hidden"),document.getElementById("height-detection-text").classList.add("hidden"),document.getElementById("scene-size-text-div").innerHTML='<h3 id="scene-size-text">Scene size: <span data-unit=1>'+e.sceneWidth+"</span>x<span data-unit=1>"+e.sceneWidth+'</span><span data-unittext="1">m</span> with a sensor height of <span data-unit="1">'+e.sceneSensorHeight+'</span><span data-unittext="1">m</span></h3>';break;case"wall-tracking":document.getElementById("coverage-section").classList.add("hidden"),document.getElementById("height-detection-text").classList.add("hidden"),document.getElementById("scene-size-text-div").innerHTML='<h3 id="scene-size-text">Scene size: <span data-unit=1>'+e.sceneWidth+"</span>x<span data-unit=1>"+e.sceneLength+'</span><span data-unittext="1">m</span></h3>';break;case"human-tracking":document.getElementById("coverage-section").classList.remove("hidden"),document.getElementById("height-detection-text").classList.remove("hidden"),document.getElementById("scene-size-text-div").innerHTML='<h3 id="scene-size-text">Scene size: <span data-unit=1>'+e.sceneWidth+"</span>x<span data-unit=1>"+e.sceneWidth+'</span><span data-unittext="1">m</span> with a sensor height of <span data-unit="1">'+e.sceneSensorHeight+'</span><span data-unittext="1">m</span></h3>';break}switch(document.getElementById("tracking-mode-selection-inspector").value=s,s){case"hand-tracking":document.getElementById("overlap-height-inspector").classList.add("hidden"),document.getElementById("floor-scene-size-inspector").classList.remove("hidden"),document.getElementById("floor-scene-size-title-inspector").innerHTML="Table scene size",document.getElementById("wall-y-scene-size-inspector").classList.add("hidden"),document.getElementById("nodes-buttons").classList.remove("hidden"),document.getElementById("lidars-buttons").classList.add("hidden");const c=document.getElementById("info-table-height-inspector");c.innerHTML="<h3>The table is <span data-unit=1>"+G.TABLE_ELEVATION+"</span><span data-unittext=1>m</span> high</h3>",c.classList.remove("hidden");break;case"wall-tracking":document.getElementById("overlap-height-inspector").classList.add("hidden"),document.getElementById("wall-y-scene-size-inspector").classList.remove("hidden"),document.getElementById("floor-scene-size-inspector").classList.add("hidden"),document.getElementById("lidars-buttons").classList.remove("hidden"),document.getElementById("nodes-buttons").classList.add("hidden"),document.getElementById("info-table-height-inspector").classList.add("hidden");break;case"human-tracking":default:document.getElementById("overlap-height-inspector").classList.remove("hidden"),document.getElementById("overlap-height-selection-inspector").value=document.getElementById("default-height-detected").value,document.getElementById("floor-scene-size-inspector").classList.remove("hidden"),document.getElementById("floor-scene-size-title-inspector").innerHTML="Floor scene size",document.getElementById("wall-y-scene-size-inspector").classList.add("hidden"),document.getElementById("nodes-buttons").classList.remove("hidden"),document.getElementById("lidars-buttons").classList.add("hidden"),document.getElementById("info-table-height-inspector").classList.add("hidden");break}},this.changeHeightDetected=function(s){let c;switch(s){case 1.2:c="Target overlap height detection: Hips";break;case 1.6:c="Target overlap height detection: Shoulders";break;case 2:c="Target overlap height detection: Entire body";break;default:c="";break}document.getElementById("height-detection-text").innerText=c};function o(s){const c=s.objects.doesCoverArea(),g=document.getElementById("scene-fully-covered-icon");g.dataset.icon=c?"ion:checkmark-circle-sharp":"ion:close-circle",g.style=c?"color: #2b2;":"color: #b22;"}function a(s){document.getElementById("number-nodes-value").innerHTML=s.objects.getNbSensors()}this.update=function(s){o(s),a(s)}}}class _n{constructor(e=!1){this.uiManager=e?void 0:new Dn;const n=this.uiManager;this.sceneManager=new G(e,n);const i=this.sceneManager.viewportManager;r(),a();function r(){window.addEventListener("resize",()=>o(i)),n.bindEventListeners(i),i.bindEventListeners()}function o(s){s.onWindowResize()}function a(){requestAnimationFrame(a),i.render(),n&&n.update(i.sceneManager)}}}new _n;
